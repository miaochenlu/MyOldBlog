{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"themes/fluid/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/fluid/source/js/clipboard-use.js","path":"js/clipboard-use.js","modified":0,"renderable":1},{"_id":"themes/fluid/source/js/color-schema.js","path":"js/color-schema.js","modified":0,"renderable":1},{"_id":"themes/fluid/source/img/police_beian.png","path":"img/police_beian.png","modified":0,"renderable":1},{"_id":"themes/fluid/source/img/loading.gif","path":"img/loading.gif","modified":0,"renderable":1},{"_id":"themes/fluid/source/js/debouncer.js","path":"js/debouncer.js","modified":0,"renderable":1},{"_id":"themes/fluid/source/js/lazyload.js","path":"js/lazyload.js","modified":0,"renderable":1},{"_id":"themes/fluid/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/fluid/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/fluid/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/fluid/source/lib/hint/hint.min.css","path":"lib/hint/hint.min.css","modified":0,"renderable":1},{"_id":"themes/fluid/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/fluid/source/img/avatar.png","path":"img/avatar.png","modified":0,"renderable":1},{"_id":"themes/fluid/source/img/default.png","path":"img/default.png","modified":0,"renderable":1},{"_id":"source/img/image-20200805135526277.png","path":"img/image-20200805135526277.png","modified":0,"renderable":0},{"_id":"source/img/image-20200710192039991.png","path":"img/image-20200710192039991.png","modified":0,"renderable":0},{"_id":"themes/fluid/source/img/achive.png","path":"img/achive.png","modified":0,"renderable":1},{"_id":"source/img/image-20200807160507597.png","path":"img/image-20200807160507597.png","modified":0,"renderable":0},{"_id":"source/img/image-20200806160700160.png","path":"img/image-20200806160700160.png","modified":0,"renderable":0}],"Cache":[{"_id":"themes/fluid/.DS_Store","hash":"91c6b607755fab8411095080299d21c3b13800f1","modified":1596624512729},{"_id":"themes/fluid/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1595300800000},{"_id":"source/.DS_Store","hash":"32cf942864f7ca01a16890209325b4c65cf1e748","modified":1596701348709},{"_id":"themes/fluid/.gitignore","hash":"bd095eee271360a38772ee1a42d4f000fb722e5f","modified":1595300800000},{"_id":"themes/fluid/LICENSE","hash":"5b919c12e4f5f5cdebb7c17ded4f10f1ebe64811","modified":1595300800000},{"_id":"themes/fluid/README.md","hash":"0ff14201b4a4799d5e3b1387da8e06ead1681970","modified":1595300800000},{"_id":"themes/fluid/.editorconfig","hash":"33218fbd623feb43edf5f99f15965392cecc44a6","modified":1595300800000},{"_id":"themes/fluid/_config.yml","hash":"66f111c6895831381ec1e2ac4ee98bd2145caf89","modified":1596692941643},{"_id":"themes/fluid/_static_prefix.yml","hash":"dd94756c6967838bf656735a46047bb7b0031ca1","modified":1595300800000},{"_id":"themes/fluid/.eslintrc","hash":"4bc2b19ce2b8c4d242f97d4ccf2d741e68ab0097","modified":1595300800000},{"_id":"themes/fluid/README_en.md","hash":"99412f14c91c3bc188953eb5b347481a618facd3","modified":1595300800000},{"_id":"themes/fluid/gulpfile.js","hash":"dc82b6be72c786721a2f5e2acc10a2a94995c540","modified":1595300800000},{"_id":"themes/fluid/local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":1595300800000},{"_id":"themes/fluid/package.json","hash":"d37c2637ed470ed61dd63142ab1291233267abdb","modified":1595300800000},{"_id":"source/_data/fluid_config.yml","hash":"66f111c6895831381ec1e2ac4ee98bd2145caf89","modified":1596692938463},{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1595918910609},{"_id":"source/about/index.md","hash":"3aa868451111df13a4577348179d1a9113de0534","modified":1596616149238},{"_id":"source/_posts/img.md","hash":"45c63d3a6c19d05324933d64af209cd1a28e0c67","modified":1595920274558},{"_id":"themes/fluid/languages/en.yml","hash":"a85dcc5cc21f9cab50df31e5001b8818ee62d1e2","modified":1595300800000},{"_id":"themes/fluid/languages/ja.yml","hash":"91020031a847c0361a6fd7ab990c7be4bf17529b","modified":1595300800000},{"_id":"themes/fluid/languages/zh-CN.yml","hash":"21307b4137c3d9b04bb58243747e75af0abc5a71","modified":1595300800000},{"_id":"themes/fluid/layout/404.ejs","hash":"689d9f4efd2a7f5edfd9b24561a7ade69d46617c","modified":1595300800000},{"_id":"themes/fluid/layout/about.ejs","hash":"e967e102bab2b35b9083165c2b8e037db8e0a32d","modified":1595300800000},{"_id":"themes/fluid/layout/archive.ejs","hash":"094357be1c2c6b477269a3f4b725d3c5dd24ef8c","modified":1595300800000},{"_id":"themes/fluid/layout/categories.ejs","hash":"3b8589675338c7b3e1849104b7bb15ac477fce4e","modified":1595300800000},{"_id":"themes/fluid/layout/category.ejs","hash":"1cfe94f46f1492a411d431b02a8d09c99cab77d5","modified":1595300800000},{"_id":"themes/fluid/layout/index.ejs","hash":"9534043275df504d70232c07fec7e10503b85d32","modified":1595300800000},{"_id":"themes/fluid/layout/layout.ejs","hash":"7450c3db44b03c1b1c859f2770f6aa77dcebd379","modified":1595300800000},{"_id":"themes/fluid/layout/links.ejs","hash":"6abd180ff4dd1d5d22e4c70328e3c7f83d174d9c","modified":1595300800000},{"_id":"themes/fluid/layout/page.ejs","hash":"8cab50ead4cdb992d35710147a9a5308fb5df290","modified":1595300800000},{"_id":"themes/fluid/layout/post.ejs","hash":"59551ef5d9c0dee8c162ac39a18a96dafe5e1358","modified":1595300800000},{"_id":"themes/fluid/layout/tag.ejs","hash":"fd72ec9e6629facf63ce8122f0fa8d492669fa6a","modified":1595300800000},{"_id":"themes/fluid/layout/tags.ejs","hash":"1d06af34b6cf1d8a20d2eb565e309326ceba309f","modified":1595300800000},{"_id":"themes/fluid/source/.DS_Store","hash":"6c35dd70ce730b7ed5cf90cd1554e14b1d753bb1","modified":1596624512727},{"_id":"themes/fluid/.github/workflows/lint.yaml","hash":"628f8d7655fdba149f5a9b0232df5c3225eda9da","modified":1595300800000},{"_id":"themes/fluid/.github/workflows/limit.yaml","hash":"f8bd2edeb4424ee7a055b31583445d5d5dff91a4","modified":1595300800000},{"_id":"themes/fluid/.github/ISSUE_TEMPLATE/bug_report.md","hash":"867ed2bb90863934b72b7586ec7c31abf9863182","modified":1595300800000},{"_id":"themes/fluid/.github/ISSUE_TEMPLATE/bug_report_zh.md","hash":"5c5a5565bb13928bc92332d9b99b968673ea7dfb","modified":1595300800000},{"_id":"themes/fluid/.github/ISSUE_TEMPLATE/feature_request.md","hash":"d3a3204d9bb2b43a69c9cb0be59bada8cb91e412","modified":1595300800000},{"_id":"themes/fluid/.github/ISSUE_TEMPLATE/feature_request_zh.md","hash":"a413dc14e4737dbcaa8fb797d37f85121ede6551","modified":1595300800000},{"_id":"themes/fluid/.github/ISSUE_TEMPLATE/question.md","hash":"93cf5e1f1e0362adee0f63f4edcc7738cd4fc842","modified":1595300800000},{"_id":"themes/fluid/.github/ISSUE_TEMPLATE/question_zh.md","hash":"e24b470f7aa8044499a4f5e39634e5dc43899011","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/beian.ejs","hash":"4f3acc8dc822c85d0d778552a15875f71c0cd80a","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/css.ejs","hash":"21964c2e5c68ee3806ef80465ef5de92174cdc3a","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/footer.ejs","hash":"03defcd4409dce27447aa8dfe7ce41a2d47e373b","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/head.ejs","hash":"4359f8598a21b133d392f71772c3f9adb5de96a0","modified":1596637203959},{"_id":"themes/fluid/layout/_partial/nav.ejs","hash":"70490c67b7313ae305d39331238232fe62f094f1","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/paginator.ejs","hash":"783eee847562ce14db8f723b4ae742fb69aaf620","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/post-meta.ejs","hash":"afa8b2d53452609a5ee7cf32ad5f00d5a80de72e","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/scripts.ejs","hash":"0d818a43079d9a2da12d9c974426d675cc0b66ea","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/search.ejs","hash":"cdd7919fa01f6ef7ccc09938d662ff3d77f5d999","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/statistics.ejs","hash":"920bc618d357d48d2b96f8758f6ae8f9488fc4d8","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/toc.ejs","hash":"3cf1d9b9032919d6b936e1f2410911df3b325670","modified":1595300800000},{"_id":"themes/fluid/scripts/events/index.js","hash":"36b137b75c76ff08523016dc8eac702f397d771b","modified":1595300800000},{"_id":"themes/fluid/scripts/filters/post-filter.js","hash":"6665f19fa30cbbe0853d8140a0832f8638538f89","modified":1595300800000},{"_id":"themes/fluid/scripts/generators/local-search.js","hash":"bb90a128a999b276c10a822c44851fa27d6d64ae","modified":1595300800000},{"_id":"themes/fluid/scripts/generators/pages.js","hash":"f64d2121d99225e9f6d12ce646af618232f5f366","modified":1595300800000},{"_id":"themes/fluid/scripts/helpers/page.js","hash":"d45dce23532c17367c7eb86b94afa8c9e40d16c6","modified":1595300800000},{"_id":"themes/fluid/scripts/helpers/url.js","hash":"99ab4551dc9c035abcc3bf4da5def2f63449d7ec","modified":1595300800000},{"_id":"themes/fluid/scripts/helpers/utils.js","hash":"9045f47c7a71aab39f16cffb3e3847b752c2e0f1","modified":1595300800000},{"_id":"themes/fluid/scripts/helpers/wordcount.js","hash":"e58d422eddb44c1be893f65f79f4c7feecfe6d5f","modified":1595300800000},{"_id":"themes/fluid/scripts/tags/button.js","hash":"48e1b46b4c34b79a128dda7a0592b43be47cf955","modified":1595300800000},{"_id":"themes/fluid/scripts/tags/checkbox.js","hash":"c131fb22805cec89d647e643299508487fc72576","modified":1595300800000},{"_id":"themes/fluid/scripts/tags/group-image.js","hash":"4aeebb797026f1df25646a5d69f7fde79b1bcd26","modified":1595300800000},{"_id":"themes/fluid/scripts/tags/label.js","hash":"d50f5aeb1a95adbc88cea9cca4a07165d6725408","modified":1595300800000},{"_id":"themes/fluid/scripts/tags/note.js","hash":"0886cfe3f8589671a1d289495e359c20a9908080","modified":1595300800000},{"_id":"themes/fluid/scripts/utils/join-path.js","hash":"629e7deb3955f750c1cfa6fc773f412e020fcef4","modified":1595300800000},{"_id":"themes/fluid/scripts/utils/object.js","hash":"61e9555f99edcb23d55361c7154e23af33153ecb","modified":1595300800000},{"_id":"themes/fluid/source/css/main.styl","hash":"d5a8a59c8d1fd17d699a951e59c4ce9ae44c419d","modified":1595300800000},{"_id":"themes/fluid/source/img/.DS_Store","hash":"ebd69685697b17878a5f9c7542e29f595a189d47","modified":1596624521605},{"_id":"themes/fluid/source/js/clipboard-use.js","hash":"f0ffe3df1deeb3cc36adfee2ab839368fb28d1c9","modified":1595300800000},{"_id":"themes/fluid/source/js/color-schema.js","hash":"6ba340eef77b2daf14c8fbb6b4f7bda9becb2526","modified":1595300800000},{"_id":"themes/fluid/source/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1595300800000},{"_id":"themes/fluid/source/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1595300800000},{"_id":"themes/fluid/source/js/debouncer.js","hash":"045f324777bdfb99d4c17b1806169f029f897a65","modified":1595300800000},{"_id":"themes/fluid/source/js/lazyload.js","hash":"792deca48c12512d3e612f0de092ffcff3ca3e34","modified":1595300800000},{"_id":"themes/fluid/source/js/local-search.js","hash":"13d5ef2fe68c49bd6096781034dbb26c190b5176","modified":1595300800000},{"_id":"themes/fluid/source/js/main.js","hash":"a6def6368d288892088f78fd401e7170e3e81a13","modified":1595300800000},{"_id":"themes/fluid/source/js/utils.js","hash":"9b06e2e2a2bb92e27d15a700f28f880317c25cfa","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/comments/changyan.ejs","hash":"13c0b62854668fd83287dff3792997baeeb3a2c7","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/comments/livere.ejs","hash":"f1e5d89cc98e2f6e067e5cd3db728127ccff0105","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/comments/disqus.ejs","hash":"d27313450311ebadf4a92f71d269db367475c1a4","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/comments/gitalk.ejs","hash":"2c516fe751fccab093d16eccc4331251942caf0a","modified":1596609460079},{"_id":"themes/fluid/layout/_partial/comments/utterances.ejs","hash":"f151bc3453a67213cfdcb944c23764fb3a780722","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/comments/valine.ejs","hash":"37941b3c6f66f1f22aeff734802373657dfdfb99","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/analytics.ejs","hash":"0977e642c65e34d2ca2980a77b16d9ad2d3936fc","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/anchor.ejs","hash":"3738c2ef427b4b400225b92e638a17b7ab2125ed","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/aplayer.ejs","hash":"e843cdbe64af3dee9385eb1d763539d3ac10ed72","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/daovoice.ejs","hash":"cfc684ba48608abd25afd155ee373d9936bbe84e","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/fancybox.ejs","hash":"c447e35c93c61a70c1c2dfc34948615832989660","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/leancloud.ejs","hash":"7807e58722dcf992fba11bc879b0fac0e904dc76","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/local-search.ejs","hash":"03b024c7bab51b64e5187c9dbfac039d020f1e97","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/math.ejs","hash":"76c4e0608ae362a265ac5e9c0fc49f75c1bc568e","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/mermaid.ejs","hash":"10ed1f9a611449d37736e17c4e251127b38b3772","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/mouse-click.ejs","hash":"eb19991199c201ceb103a6ef025e4dfd1e7dbfb7","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/tocjs.ejs","hash":"2d35295dba2bb912d6ce2ec7747af06bfdc82edb","modified":1595300800000},{"_id":"themes/fluid/layout/_partial/plugins/typed.ejs","hash":"38334350425008d1f64323de221457ee0948af0e","modified":1595300800000},{"_id":"themes/fluid/scripts/events/lib/footnote.js","hash":"3b2abc5f5e3b681874637e98e047dc4969eb1983","modified":1595300800000},{"_id":"themes/fluid/scripts/events/lib/hello.js","hash":"da4c281a8b2d2ed813da1236950c9dff87334adc","modified":1595300800000},{"_id":"themes/fluid/scripts/events/lib/highlight.js","hash":"4adf895fa1157aaf5a194f8b760332b6215656ef","modified":1595300800000},{"_id":"themes/fluid/scripts/events/lib/lazyload.js","hash":"ee7dfef805af96195c11223cca53983deace8bda","modified":1595300800000},{"_id":"themes/fluid/scripts/events/lib/merge-configs.js","hash":"374583fd419ac6477dfca69e09756db543d7ec80","modified":1595300800000},{"_id":"themes/fluid/scripts/events/lib/version.js","hash":"5fed24e25662a1b08fd857fde2d770fdc6250475","modified":1595300800000},{"_id":"themes/fluid/source/css/_functions/base.styl","hash":"2e46f3f4e2c9fe34c1ff1c598738fc7349ae8188","modified":1595300800000},{"_id":"themes/fluid/source/css/_mixins/base.styl","hash":"542e306ee9494e8a78e44d6d7d409605d94caeb3","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/pages.styl","hash":"b8e887bc7fb3b765a1f8ec9448eff8603a41984f","modified":1595300800000},{"_id":"themes/fluid/source/css/_variables/base.styl","hash":"1678c5bbb1aa2e17681f8e88776ecb802bc85b69","modified":1595300800000},{"_id":"themes/fluid/source/lib/hint/hint.min.css","hash":"b38df228460ebfb4c0b6085336ee2878fe85aafe","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_category/category.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_tag/tag.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_about/about.styl","hash":"7e07e44fa0e77ddbdd3aa0c0abdb3be6822df2e0","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_archive/archive.styl","hash":"6e6f22b664199772370b59ce1678b0c148b5849f","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/base.styl","hash":"aa2528e71c290dc43b69dfbdcf4d8d6c258015a4","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/color-schema.styl","hash":"7231920523d634670344a452908f933b29a452be","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/inline.styl","hash":"fab8441a0b8d8f9db6c8370013659c035345ae79","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/keyframes.styl","hash":"94065ea50f5bef7566d184f2422f6ac20866ba22","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/rewrite.styl","hash":"439fce1b41bc1134399e7f2ce6ffe5aa64568acd","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_category/categories.styl","hash":"1ab7db37c2f7dc7ccdb994dcb41c16a4c8920397","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_index/index.styl","hash":"c443551deb389102e65cbb2441f60e8c20712ee8","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_links/links.styl","hash":"cd4ebb1426abed9fda93b797b02c6d5dd71dc2a1","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_post/post.styl","hash":"f8f5503443f26354dacd139606e245f19aceb4a0","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_post/tag_plugin.styl","hash":"cbb49a17fcc030029f0c2fbe1e056613109d1ecc","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_tag/tags.styl","hash":"65bfc01c76abc927fa1a23bf2422892b0d566c3f","modified":1595300800000},{"_id":"themes/fluid/source/img/favicon.png","hash":"676e864f7cc2219f7984de4c0f8dbf96fd663944","modified":1595923664734},{"_id":"themes/fluid/source/img/avatar.png","hash":"676e864f7cc2219f7984de4c0f8dbf96fd663944","modified":1595923664734},{"_id":"themes/fluid/source/css/_pages/_base/_widget/banner.styl","hash":"5f8738c43539c27ad2ce7635a53b2cac522f1c13","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/_widget/board.styl","hash":"32d90bcc8bf2fd5d8d78e86a567973d4b69bcfa1","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/_widget/copy-btn.styl","hash":"2c9e05a354d4be820646a1c99f814740f299ed37","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/_widget/footer.styl","hash":"6b8340a41afc6b6e5f30dc9e912a0e0265446963","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/_widget/footnote.styl","hash":"ae9289cc89649af2042907f8a003303b987f3404","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/_widget/header.styl","hash":"7c8170d0e2de47570fe8ed523f10ee1c33138a9f","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/_widget/qrcode.styl","hash":"fe74d031acef4403e1510d4cce5bc7accd641780","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/_widget/scroll-btn.styl","hash":"f1cd98a5b8d98535d707a99dba6a00f1f3978c81","modified":1595300800000},{"_id":"themes/fluid/source/css/_pages/_base/_widget/search.styl","hash":"10f7e91a91e681fb9fe46f9df7707b9ef78707c8","modified":1595300800000},{"_id":"themes/fluid/source/img/default.png","hash":"40217ddf4aa1f7598ed3c89d7d55775c47b34987","modified":1596611234977},{"_id":"public/local-search.xml","hash":"63b809619ba4210d804128a3df4bda96eb6f884e","modified":1596788050069},{"_id":"public/about/index.html","hash":"137160ed65ac31d624cce5acbefc83531ce11203","modified":1596636471113},{"_id":"public/2020/07/28/hello-world/index.html","hash":"926a0f4b1b7960a06b185ca5e8d76e15bbde8036","modified":1596610873762},{"_id":"public/archives/index.html","hash":"fd9f50487c7fb247323ddf87338abc4bb8bd270b","modified":1596788050069},{"_id":"public/archives/2020/index.html","hash":"fd9f50487c7fb247323ddf87338abc4bb8bd270b","modified":1596788050069},{"_id":"public/archives/2020/07/index.html","hash":"1596af30a4e3085c313d8af6e720eef7b38d6bdc","modified":1596610873762},{"_id":"public/index.html","hash":"9cc96902d28bec0299d7bed55ede970cbcaa9a34","modified":1596788050069},{"_id":"public/tags/image/index.html","hash":"1bd79742b32d1bd5882f0e33733b60fe8e0713a0","modified":1596610873762},{"_id":"public/404.html","hash":"0752fa97786e89e004212722686fc8e66c2f614f","modified":1596636471113},{"_id":"public/tags/index.html","hash":"5086d103d0756e58f8663392b23b2ca1af41bc89","modified":1596636471113},{"_id":"public/categories/index.html","hash":"8a6bfe7d04f7d62eff034ee403ff293749650f54","modified":1596788050069},{"_id":"public/links/index.html","hash":"767872d90cbafac9e0a8986d530f2d3461888dd9","modified":1596636471113},{"_id":"public/2020/07/28/img/index.html","hash":"f2da5d914def5a5778f444f14cc9215f807efef4","modified":1596610873762},{"_id":"public/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1595924104455},{"_id":"public/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1595924104455},{"_id":"public/js/clipboard-use.js","hash":"f0ffe3df1deeb3cc36adfee2ab839368fb28d1c9","modified":1595924104455},{"_id":"public/js/color-schema.js","hash":"6ba340eef77b2daf14c8fbb6b4f7bda9becb2526","modified":1595924104455},{"_id":"public/js/debouncer.js","hash":"045f324777bdfb99d4c17b1806169f029f897a65","modified":1595924104455},{"_id":"public/js/lazyload.js","hash":"792deca48c12512d3e612f0de092ffcff3ca3e34","modified":1595924104455},{"_id":"public/js/local-search.js","hash":"13d5ef2fe68c49bd6096781034dbb26c190b5176","modified":1595924104455},{"_id":"public/js/main.js","hash":"a6def6368d288892088f78fd401e7170e3e81a13","modified":1595924104455},{"_id":"public/js/utils.js","hash":"9b06e2e2a2bb92e27d15a700f28f880317c25cfa","modified":1595924104455},{"_id":"public/lib/hint/hint.min.css","hash":"b38df228460ebfb4c0b6085336ee2878fe85aafe","modified":1595924104455},{"_id":"public/css/main.css","hash":"65f7421b6952cfd77811c470b8f99f40feefe2d6","modified":1595924104455},{"_id":"public/img/favicon.png","hash":"676e864f7cc2219f7984de4c0f8dbf96fd663944","modified":1595924104455},{"_id":"public/img/avatar.png","hash":"676e864f7cc2219f7984de4c0f8dbf96fd663944","modified":1595924104455},{"_id":"public/img/default.png","hash":"40217ddf4aa1f7598ed3c89d7d55775c47b34987","modified":1596618326353},{"_id":"source/_posts/today-md.md","hash":"7663f737488173921d57668d5e56e730a71086b5","modified":1596612039671},{"_id":"public/2020/08/05/today-md/index.html","hash":"22cf84fb6976506b14b959b38a5c60b40141576e","modified":1596610873762},{"_id":"public/archives/2020/08/index.html","hash":"fd9f50487c7fb247323ddf87338abc4bb8bd270b","modified":1596788050069},{"_id":"themes/fluid/source/img/未确认 672818.crdownload","hash":"708fdf7f654b1cf047adbf7e400b21b99a4d236b","modified":1596611047459},{"_id":"themes/fluid/source/img/default","hash":"708fdf7f654b1cf047adbf7e400b21b99a4d236b","modified":1596611047459},{"_id":"themes/fluid/source/img/73twhs.webp","hash":"708fdf7f654b1cf047adbf7e400b21b99a4d236b","modified":1596611166085},{"_id":"themes/fluid/source/img/截屏2020-08-05 下午3.07.03.png","hash":"40217ddf4aa1f7598ed3c89d7d55775c47b34987","modified":1596611234977},{"_id":"themes/fluid/source/img/1.png","hash":"7bcf6b4d00be4be44026e096abf3cc76f7e12b67","modified":1575734892788},{"_id":"public/img/73twhs.webp","hash":"708fdf7f654b1cf047adbf7e400b21b99a4d236b","modified":1596611265473},{"_id":"public/img/default","hash":"708fdf7f654b1cf047adbf7e400b21b99a4d236b","modified":1596611265473},{"_id":"public/img/1.png","hash":"7bcf6b4d00be4be44026e096abf3cc76f7e12b67","modified":1596611265473},{"_id":"source/_posts/StrategyMethod.md","hash":"b79856e8b030056353bd17ee4a6b537a16475600","modified":1596614897218},{"_id":"source/img/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"public/tags/DesignPatterns/index.html","hash":"746697a60ab343f65ff471184be51c77eb95b09b","modified":1596612564760},{"_id":"public/2020/08/05/StrategyMethod/index.html","hash":"d2f11ae9bb736bd45dccb115000b349f6ac7c034","modified":1596615152270},{"_id":"public/img/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596612564760},{"_id":"themes/fluid/source/img/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"source/_posts/.DS_Store","hash":"08b7ae090af6c6b72e17e644eede982f872c58c0","modified":1596787524697},{"_id":"source/_posts/img/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"source/_posts/img/.DS_Store","hash":"d74aec70bb334da3b15a0bba2b3d96aea14d074d","modified":1596612971432},{"_id":"source/img/image-20200805135526277 下午3.38.10.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"source/img/.DS_Store","hash":"f0367f4f3e43244bac8440ba31123418b5eb6e47","modified":1596615392841},{"_id":"source/img/image-20200805135526277png.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"source/_posts/today.md","hash":"f6a648ae9afc361a1d38e91bd174932b790d6ed1","modified":1596614010727},{"_id":"source/_posts/today/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"public/2020/08/05/today/index.html","hash":"edffba3fc2995b34a49fe06b1223c5457c66e468","modified":1596613570034},{"_id":"public/2020/08/05/today/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596613570034},{"_id":"source/img/image-20200805135526277-6613948.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"public/img/image-20200805135526277-6613948.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596614064725},{"_id":"source/_posts/StrategyMethod/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"source/_posts/StrategyMethod/.DS_Store","hash":"7a5178989e10029d0bc2b5b00920419850839cf4","modified":1596614110447},{"_id":"public/2020/08/05/StrategyMethod/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596614303295},{"_id":"source/_posts/TemplateMethod.md","hash":"6a95006349bd988ee55963be87ba0ebc42ef83ae","modified":1596615457730},{"_id":"source/_posts/TemplateMethod/image-20200710191024075.png","hash":"c9d9cdda10734b608de035e0ed41410a9ed12f2a","modified":1594379424077},{"_id":"source/_posts/TemplateMethod/image-20200710191917988.png","hash":"054cb9629b796fbdce6291f07c028c2e97fb520a","modified":1594379957990},{"_id":"source/_posts/TemplateMethod/image-20200710192039991.png","hash":"a8fb26639be616e19d2b84031a1439124e470545","modified":1594380039993},{"_id":"source/_posts/TemplateMethod/image-20200710191212499.png","hash":"e9b999198d97d912f860c32db4ed5f8d9afc9142","modified":1594379532501},{"_id":"public/tags/Design-Patterns/index.html","hash":"7c66ab91fe343b71e25c93d143544c3e25f6f62c","modified":1596788050069},{"_id":"public/2020/08/05/TemplateMethod/index.html","hash":"45d6e775bcbcd766dc56e084e24cda7ceab91305","modified":1596615310635},{"_id":"public/2020/08/05/TemplateMethod/image-20200710191024075.png","hash":"c9d9cdda10734b608de035e0ed41410a9ed12f2a","modified":1596615152270},{"_id":"public/2020/08/05/TemplateMethod/image-20200710192039991.png","hash":"a8fb26639be616e19d2b84031a1439124e470545","modified":1596615152270},{"_id":"public/2020/08/05/TemplateMethod/image-20200710191212499.png","hash":"e9b999198d97d912f860c32db4ed5f8d9afc9142","modified":1596615152270},{"_id":"public/2020/08/05/TemplateMethod/image-20200710191917988.png","hash":"054cb9629b796fbdce6291f07c028c2e97fb520a","modified":1596615152270},{"_id":"source/img/image-20200710191917988.png","hash":"054cb9629b796fbdce6291f07c028c2e97fb520a","modified":1594379957990},{"_id":"public/img/image-20200710191917988.png","hash":"054cb9629b796fbdce6291f07c028c2e97fb520a","modified":1596615310635},{"_id":"source/img/image-20200710192039991.png","hash":"a8fb26639be616e19d2b84031a1439124e470545","modified":1594380039993},{"_id":"source/_posts/Untitled.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1596615471727},{"_id":"source/_posts/DesignPatterns/TemplateMethod/image-20200710191917988.png","hash":"054cb9629b796fbdce6291f07c028c2e97fb520a","modified":1594379957990},{"_id":"source/_posts/DesignPatterns/TemplateMethod/image-20200710191024075.png","hash":"c9d9cdda10734b608de035e0ed41410a9ed12f2a","modified":1594379424077},{"_id":"source/_posts/DesignPatterns/TemplateMethod/image-20200710191212499.png","hash":"e9b999198d97d912f860c32db4ed5f8d9afc9142","modified":1594379532501},{"_id":"source/_posts/DesignPatterns/TemplateMethod/image-20200710192039991.png","hash":"a8fb26639be616e19d2b84031a1439124e470545","modified":1594380039993},{"_id":"source/_posts/DesignPatterns/TemplateMethod/StrategyMethod/.DS_Store","hash":"7a5178989e10029d0bc2b5b00920419850839cf4","modified":1596614110447},{"_id":"source/_posts/DesignPatterns/TemplateMethod/StrategyMethod/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"source/_posts/DesignPatterns/StrategyMethod.md","hash":"93a7ad6a9dd9c2f10ca3a1d1d056861bcac6aabd","modified":1596702643543},{"_id":"source/_posts/DesignPatterns/StrategyMethod/.DS_Store","hash":"7a5178989e10029d0bc2b5b00920419850839cf4","modified":1596614110447},{"_id":"source/_posts/DesignPatterns/StrategyMethod/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596607010927},{"_id":"source/_posts/DesignPatterns/TemplateMethod.md","hash":"d683a3786ad55f0164f4b68c1cc3c61ae176b600","modified":1596702627487},{"_id":"public/2020/08/05/DesignPatterns/TemplateMethod/index.html","hash":"f4d39ae9d40c0b748ff11ea217fda7e50fb7206d","modified":1596788050069},{"_id":"public/2020/08/05/DesignPatterns/StrategyMethod/index.html","hash":"8f28203144501443d35005d5567b4d9ac23a7a24","modified":1596788050069},{"_id":"public/2020/08/05/DesignPatterns/TemplateMethod/image-20200710191024075.png","hash":"c9d9cdda10734b608de035e0ed41410a9ed12f2a","modified":1596615544736},{"_id":"public/img/image-20200710192039991.png","hash":"a8fb26639be616e19d2b84031a1439124e470545","modified":1596615544736},{"_id":"public/2020/08/05/DesignPatterns/TemplateMethod/image-20200710191917988.png","hash":"054cb9629b796fbdce6291f07c028c2e97fb520a","modified":1596615544736},{"_id":"public/2020/08/05/DesignPatterns/TemplateMethod/image-20200710192039991.png","hash":"a8fb26639be616e19d2b84031a1439124e470545","modified":1596615544736},{"_id":"public/2020/08/05/DesignPatterns/TemplateMethod/image-20200710191212499.png","hash":"e9b999198d97d912f860c32db4ed5f8d9afc9142","modified":1596615544736},{"_id":"public/2020/08/05/DesignPatterns/StrategyMethod/image-20200805135526277.png","hash":"3fb2915a905f9c18fe8663e982e32baf067a1c54","modified":1596615544736},{"_id":"themes/fluid/source/img/achive.png","hash":"bfdf73f8656f6c2559587659051d801aae61e49d","modified":1596624121939},{"_id":"public/img/achive.png","hash":"bfdf73f8656f6c2559587659051d801aae61e49d","modified":1596624540123},{"_id":"source/_posts/Principle.md","hash":"24d29b9f97e9aad659a7ae4dc32c753889c4825c","modified":1596698815389},{"_id":"source/_posts/Observer.md","hash":"c7431786622090b484e1f5c8b48e9d4753f949ab","modified":1596696282404},{"_id":"source/_posts/Decorator.md","hash":"6570321756604b4f8ef3010b7c1af043332edba2","modified":1596788038950},{"_id":"source/_posts/DesignPatterns/Observer.md","hash":"d565052ca68515927994d08ff65a1a7235e098b0","modified":1596702594267},{"_id":"source/img/image-20200807160507597.png","hash":"490eb5b5be3655c41cbc8f0578689c0240799edc","modified":1596787768905},{"_id":"source/img/image-20200806160700160.png","hash":"cb4ed64f80eefb8d68cc969a59d3548eab709298","modified":1596701220162},{"_id":"source/_posts/Decorator/image-20200807160507597.png","hash":"490eb5b5be3655c41cbc8f0578689c0240799edc","modified":1596787768905},{"_id":"source/_posts/Decorator/image-20200807143823919.png","hash":"aac6a9f03eb640439d5b69f787bbb683a488861d","modified":1596782303920},{"_id":"source/_posts/Decorator/image-20200807142228605.png","hash":"87bd7e6b236c68eb219b9f4d9bc92419c8af101a","modified":1596781348610},{"_id":"source/_posts/Decorator/image-20200807143722316.png","hash":"96d4c261eb9048de61457b91b094f3591cf8a226","modified":1596782242319},{"_id":"source/_posts/DesignPatterns/Observer/image-20200806160700160.png","hash":"b6abb80ce592d70dcdd4087f4833aa8f489b8b97","modified":1596701745439},{"_id":"public/2020/08/06/Principle/index.html","hash":"63eb07b573dc1e0e6c545fc51137a6ae87dd0ff2","modified":1596788050069},{"_id":"public/categories/Design-Patterns/index.html","hash":"4a98511d5d79d19bf8d51ccc5dd110bab4dd999a","modified":1596788050069},{"_id":"public/2020/08/07/Decorator/index.html","hash":"37adb625c4200c89618dde6a0091fcdf3361e8c5","modified":1596788050069},{"_id":"public/2020/08/06/DesignPatterns/Observer/index.html","hash":"aec54870cc557b884de7a12173fbad417dc44a5b","modified":1596788050069},{"_id":"public/img/image-20200807160507597.png","hash":"490eb5b5be3655c41cbc8f0578689c0240799edc","modified":1596788050069},{"_id":"public/2020/08/07/Decorator/image-20200807160507597.png","hash":"490eb5b5be3655c41cbc8f0578689c0240799edc","modified":1596788050069},{"_id":"public/img/image-20200806160700160.png","hash":"cb4ed64f80eefb8d68cc969a59d3548eab709298","modified":1596788050069},{"_id":"public/2020/08/07/Decorator/image-20200807143823919.png","hash":"aac6a9f03eb640439d5b69f787bbb683a488861d","modified":1596788050069},{"_id":"public/2020/08/06/DesignPatterns/Observer/image-20200806160700160.png","hash":"b6abb80ce592d70dcdd4087f4833aa8f489b8b97","modified":1596788050069},{"_id":"public/2020/08/07/Decorator/image-20200807142228605.png","hash":"87bd7e6b236c68eb219b9f4d9bc92419c8af101a","modified":1596788050069},{"_id":"public/2020/08/07/Decorator/image-20200807143722316.png","hash":"96d4c261eb9048de61457b91b094f3591cf8a226","modified":1596788050069}],"Category":[{"name":"Design Patterns","_id":"ckdjycnu00001iuuf2yqza5sa"}],"Data":[{"_id":"fluid_config","data":{"favicon":"/img/favicon.png","apple_touch_icon":"/img/favicon.png","title_join_string":" - ","force_https":false,"highlight":{"enable":true,"style":"Atom One Dark","bg_color":true,"copy_btn":true},"fun_features":{"typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"mouse_click":{"enable":false,"style":"values"}},"color":{"body_bg_color":"#eee","navbar_bg_color":"black","navbar_text_color":"white","text_color":"#3c4858","sec_text_color":"#718096","post_text_color":"#2c3e50","post_heading_color":"#1a202c","link_color":"#3c4858","link_hover_color":"#1abc9c","link_hover_bg_color":"#f8f9fa","board_color":"#fff"},"font":{"font_size":"16px","font_family":null,"code_font_size":"85%"},"custom_js":null,"custom_css":null,"custom_html":"","web_analytics":{"enable":false,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"tajs":null,"woyaola":null,"cnzz":null,"leancloud":{"app_id":"6ojk1lVz9eq7GQnBo6Q8zR5d-gzGzoHsz","app_key":"bOrBPlujAz77Ma6N5tY9wWJN","server_url":null}},"lazyload":{"enable":true,"onlypost":false},"daovoice":{"enable":false,"appid":""},"aplayer":{"enable":false,"autoplay":false,"loop":"all","order":"random","theme":"#b7daff","songs":[{"name":"name","artist":"artist","url":"/songs/test.mp3","cover":"/img/cover.jpg"},{"name":"name","artist":"artist","url":"https://...url.mp3","cover":"https://...cover.jpg"}]},"version":{"check":false},"navbar":{"blog_title":"Explorer","ground_glass":{"enable":false,"px":3,"alpha":0.7},"menu":[{"key":"home","link":"/","icon":"iconfont icon-home-fill"},{"key":"archive","link":"/archives/","icon":"iconfont icon-archive-fill"},{"key":"category","link":"/categories/","icon":"iconfont icon-category-fill"},{"key":"tag","link":"/tags/","icon":"iconfont icon-tags-fill"},{"key":"about","link":"/about/","icon":"iconfont icon-user-fill"}]},"search":{"enable":true,"path":"/local-search.xml","generate_path":"/local-search.xml","field":"post","content":true},"scroll_down_arrow":{"enable":true,"banner_height_limit":90,"scroll_after_turning_page":true},"banner_parallax":true,"footer":{"statistics":{"enable":false,"source":"busuanzi","pv_format":"总访问量 {} 次","uv_format":"总访客数 {} 人"},"beian":{"enable":false,"icp_text":"京ICP证123456号","police_text":"京公网安备12345678号","police_code":12345678,"police_icon":"/img/police_beian.png"}},"scroll_top_arrow":{"enable":true},"index":{"banner_img":"/img/default.png","banner_img_height":100,"banner_mask_alpha":0.3,"post_default_img":"","slogan":{"enable":true,"text":"It&apos; s Us Make The World Different"},"auto_excerpt":{"enable":true},"post_url_target":"_self","post_meta":{"date":true,"category":true,"tag":true}},"page":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3},"post":{"banner_img":"/img/default.png","banner_img_height":70,"banner_mask_alpha":0.3,"meta":{"date":{"enable":true,"format":"LL a"},"wordcount":{"enable":true,"format":"{} 字"},"min2read":{"enable":true,"format":"{} 分钟","words":100},"views":{"enable":true,"source":"busuanzi","format":"{} 次"}},"updated":{"enable":false,"content":"本文最后更新于：","relative":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"copyright":{"enable":true,"content":"本博客所有文章除特别声明外，均采用 <a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.zh\" rel=\"nofollow noopener\">CC BY-SA 4.0 协议</a> ，转载请注明出处！"},"prev_next":{"enable":true},"custom":{"enable":false,"content":"<img src=\"https://octodex.github.com/images/jetpacktocat.png\" class=\"rounded mx-auto d-block mt-5\" style=\"width:150px; height:150px;\">"},"image_zoom":{"enable":true},"footnote":{"enable":true,"header":""},"math":{"enable":true,"specific":false,"engine":"mathjax"},"mermaid":{"enable":true,"specific":false,"options":{"theme":"default"}},"comments":{"enable":false,"type":"gitalk"}},"utterances":{"repo":null,"issue_term":null,"label":"utterances","theme":"github-light","crossorigin":"anonymous"},"disqus":{"shortname":null,"disqusjs":false,"apikey":null},"gitalk":{"clientID":"cde2629d6201340c948b","clientSecret":"621727333cc595103f634cf6deaba53bd8784fe6","repo":"blog-comments","owner":"miaochenlu","admin":null,"id":"location.pathname","language":"zh-CN","labels":"['Gitalk']","perPage":15,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true},"valine":{"appid":null,"appkey":null,"placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":null},"changyan":{"appid":"","appkey":""},"livere":{"uid":""},"archive":{"banner_img":"/img/achive.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null},"category":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"post_limit":10,"order_by":"-length"},"tag":{"banner_img":"/img/default.png","banner_img_height":80,"banner_mask_alpha":0.3,"subtitle":null,"tagcloud":{"min_font":15,"max_font":30,"unit":"px","start_color":"#BBBBEE","end_color":"#337ab7"}},"about":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"avatar":"/img/avatar.png","name":"Chenlu Miao","introduce":"李德胜永远滴神","icons":[{"class":"iconfont icon-github-fill","link":"https://github.com/miaochenlu","tip":"GitHub"},{"class":"iconfont icon-mail","link":"mailto:clmiao@zju.edu.cn","tip":"邮箱"}]},"page404":{"banner_img":"/img/default.png","banner_img_height":85,"banner_mask_alpha":0.3,"subtitle":"Page not found"},"links":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"items":[{"title":"Fluid Docs","intro":"主题使用指南","link":"https://hexo.fluid-dev.com/docs/","image":"/img/favicon.png"},{"title":"Fluid Repo","intro":"主题 GitHub 仓库","link":"https://github.com/fluid-dev/hexo-theme-fluid","image":"/img/favicon.png"},{"title":"Fluid Example","intro":"主题操作示例","link":"https://hexo.fluid-dev.com/docs/example/","image":"/img/favicon.png"}]}}}],"Page":[{"title":"about","date":"2020-07-28T06:51:36.000Z","layout":"about","_content":"\n<header >\n</header>\n<main class=\"mdl-color--blue-grey-50\">\n    <section class=\"mdl-color--white mdl-shadow--2dp\">\n        <h2 class=\"mdl-typography--display-1\">&emsp;Education</h2>\n        <section>\n            <h3 class=\"mdl-typography--title mdl-typography--title mdl-color-text--indigo-500\">&emsp;Zhejiang University</h3>\n            <p class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">&emsp;Bachelor of Engineering, Computer Science and Technology</p>\n            <p class=\"mdl-typography--body-1 mdl-typography--body-1-color-contrast\">\n                &emsp;August 2017 – Present, Hangzhou, China\n            </p>\n            <ul class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">\n              \t<li>Member of Pursuit Science Class (Computer Science), Chu Kochen Honors College</li>\n              <li>Overall GPA: 3.98/4, 4.58/5, 91.5/100</li>\n              <ul class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">\n                SELECTED COURSES(4.0/4.0 in all of them)\n                <li>Systems: Digital Logic Design, Computer Organization, Computer Architecture, Computer Networks, Operating System, Compiler Principles</li>\n                <li>Math: Mathematical Analysis, Linear Algebra, Stochastic Process, Probability and Mathematical Statistics, Applied Operation Research, Numerical Analysis</li>\n              </ul>\n              <li>RESEARCH INTEREST: Computer Architecture and Hardware Security, recent projects focused on hardware transactional memory.</li>\n            </ul>\n            <br>\n        </section>\n    </section>","source":"about/index.md","raw":"---\ntitle: about\ndate: 2020-07-28 14:51:36\nlayout: about\n---\n\n<header >\n</header>\n<main class=\"mdl-color--blue-grey-50\">\n    <section class=\"mdl-color--white mdl-shadow--2dp\">\n        <h2 class=\"mdl-typography--display-1\">&emsp;Education</h2>\n        <section>\n            <h3 class=\"mdl-typography--title mdl-typography--title mdl-color-text--indigo-500\">&emsp;Zhejiang University</h3>\n            <p class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">&emsp;Bachelor of Engineering, Computer Science and Technology</p>\n            <p class=\"mdl-typography--body-1 mdl-typography--body-1-color-contrast\">\n                &emsp;August 2017 – Present, Hangzhou, China\n            </p>\n            <ul class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">\n              \t<li>Member of Pursuit Science Class (Computer Science), Chu Kochen Honors College</li>\n              <li>Overall GPA: 3.98/4, 4.58/5, 91.5/100</li>\n              <ul class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">\n                SELECTED COURSES(4.0/4.0 in all of them)\n                <li>Systems: Digital Logic Design, Computer Organization, Computer Architecture, Computer Networks, Operating System, Compiler Principles</li>\n                <li>Math: Mathematical Analysis, Linear Algebra, Stochastic Process, Probability and Mathematical Statistics, Applied Operation Research, Numerical Analysis</li>\n              </ul>\n              <li>RESEARCH INTEREST: Computer Architecture and Hardware Security, recent projects focused on hardware transactional memory.</li>\n            </ul>\n            <br>\n        </section>\n    </section>","updated":"2020-08-05T08:29:09.238Z","path":"about/index.html","_id":"ckd5o08k40001g5ufagrtauom","comments":1,"content":"<header >\n</header>\n<main class=\"mdl-color--blue-grey-50\">\n    <section class=\"mdl-color--white mdl-shadow--2dp\">\n        <h2 class=\"mdl-typography--display-1\">&emsp;Education</h2>\n        <section>\n            <h3 class=\"mdl-typography--title mdl-typography--title mdl-color-text--indigo-500\">&emsp;Zhejiang University</h3>\n            <p class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">&emsp;Bachelor of Engineering, Computer Science and Technology</p>\n            <p class=\"mdl-typography--body-1 mdl-typography--body-1-color-contrast\">\n                &emsp;August 2017 – Present, Hangzhou, China\n            </p>\n            <ul class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">\n                  <li>Member of Pursuit Science Class (Computer Science), Chu Kochen Honors College</li>\n              <li>Overall GPA: 3.98/4, 4.58/5, 91.5/100</li>\n              <ul class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">\n                SELECTED COURSES(4.0/4.0 in all of them)\n                <li>Systems: Digital Logic Design, Computer Organization, Computer Architecture, Computer Networks, Operating System, Compiler Principles</li>\n                <li>Math: Mathematical Analysis, Linear Algebra, Stochastic Process, Probability and Mathematical Statistics, Applied Operation Research, Numerical Analysis</li>\n              </ul>\n              <li>RESEARCH INTEREST: Computer Architecture and Hardware Security, recent projects focused on hardware transactional memory.</li>\n            </ul>\n            <br>\n        </section>\n    </section>","site":{"data":{"fluid_config":{"favicon":"/img/favicon.png","apple_touch_icon":"/img/favicon.png","title_join_string":" - ","force_https":false,"highlight":{"enable":true,"style":"Atom One Dark","bg_color":true,"copy_btn":true},"fun_features":{"typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"mouse_click":{"enable":false,"style":"values"}},"color":{"body_bg_color":"#eee","navbar_bg_color":"#ffffff","navbar_text_color":"white","text_color":"#3c4858","sec_text_color":"#718096","post_text_color":"#2c3e50","post_heading_color":"#1a202c","link_color":"#3c4858","link_hover_color":"#1abc9c","link_hover_bg_color":"#f8f9fa","board_color":"#fff"},"font":{"font_size":"20px","font_family":null,"code_font_size":"85%"},"custom_js":null,"custom_css":null,"custom_html":"","web_analytics":{"enable":false,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"tajs":null,"woyaola":null,"cnzz":null,"leancloud":{"app_id":"6ojk1lVz9eq7GQnBo6Q8zR5d-gzGzoHsz","app_key":"bOrBPlujAz77Ma6N5tY9wWJN","server_url":null}},"lazyload":{"enable":true,"onlypost":false},"daovoice":{"enable":false,"appid":""},"aplayer":{"enable":false,"autoplay":false,"loop":"all","order":"random","theme":"#b7daff","songs":[{"name":"name","artist":"artist","url":"/songs/test.mp3","cover":"/img/cover.jpg"},{"name":"name","artist":"artist","url":"https://...url.mp3","cover":"https://...cover.jpg"}]},"version":{"check":false},"navbar":{"blog_title":"Explorer","ground_glass":{"enable":false,"px":3,"alpha":0.7},"menu":[{"key":"home","link":"/","icon":"iconfont icon-home-fill"},{"key":"archive","link":"/archives/","icon":"iconfont icon-archive-fill"},{"key":"category","link":"/categories/","icon":"iconfont icon-category-fill"},{"key":"tag","link":"/tags/","icon":"iconfont icon-tags-fill"},{"key":"about","link":"/about/","icon":"iconfont icon-user-fill"}]},"search":{"enable":true,"path":"/local-search.xml","generate_path":"/local-search.xml","field":"post","content":true},"scroll_down_arrow":{"enable":true,"banner_height_limit":90,"scroll_after_turning_page":true},"banner_parallax":true,"footer":{"statistics":{"enable":false,"source":"busuanzi","pv_format":"总访问量 {} 次","uv_format":"总访客数 {} 人"},"beian":{"enable":false,"icp_text":"京ICP证123456号","police_text":"京公网安备12345678号","police_code":12345678,"police_icon":"/img/police_beian.png"}},"scroll_top_arrow":{"enable":true},"index":{"banner_img":"/img/default.png","banner_img_height":100,"banner_mask_alpha":0.3,"post_default_img":"","slogan":{"enable":true,"text":"It&acute; s Us Make The World Different"},"auto_excerpt":{"enable":true},"post_url_target":"_self","post_meta":{"date":true,"category":true,"tag":true}},"page":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3},"post":{"banner_img":"/img/default.png","banner_img_height":70,"banner_mask_alpha":0.3,"meta":{"date":{"enable":true,"format":"LL a"},"wordcount":{"enable":true,"format":"{} 字"},"min2read":{"enable":true,"format":"{} 分钟","words":100},"views":{"enable":true,"source":"busuanzi","format":"{} 次"}},"updated":{"enable":false,"content":"本文最后更新于：","relative":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"copyright":{"enable":true,"content":"本博客所有文章除特别声明外，均采用 <a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.zh\" rel=\"nofollow noopener\">CC BY-SA 4.0 协议</a> ，转载请注明出处！"},"prev_next":{"enable":true},"custom":{"enable":false,"content":"<img src=\"https://octodex.github.com/images/jetpacktocat.png\" class=\"rounded mx-auto d-block mt-5\" style=\"width:150px; height:150px;\">"},"image_zoom":{"enable":true},"footnote":{"enable":true,"header":""},"math":{"enable":true,"specific":false,"engine":"mathjax"},"mermaid":{"enable":true,"specific":false,"options":{"theme":"default"}},"comments":{"enable":true,"type":"gitalk"}},"utterances":{"repo":null,"issue_term":null,"label":"utterances","theme":"github-light","crossorigin":"anonymous"},"disqus":{"shortname":null,"disqusjs":false,"apikey":null},"gitalk":{"clientID":"cde2629d6201340c948b","clientSecret":"621727333cc595103f634cf6deaba53bd8784fe6","repo":"blog-comments","owner":"miaochenlu","admin":null,"id":"location.pathname","language":"zh-CN","labels":"['Gitalk']","perPage":15,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true},"valine":{"appid":null,"appkey":null,"placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":null},"changyan":{"appid":"","appkey":""},"livere":{"uid":""},"archive":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null},"category":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"post_limit":10,"order_by":"-length"},"tag":{"banner_img":"/img/default.png","banner_img_height":80,"banner_mask_alpha":0.3,"subtitle":null,"tagcloud":{"min_font":15,"max_font":30,"unit":"px","start_color":"#BBBBEE","end_color":"#337ab7"}},"about":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"avatar":"/img/avatar.png","name":"Chenlu Miao","introduce":"李德胜永远滴神","icons":[{"class":"iconfont icon-github-fill","link":"https://github.com/miaochenlu","tip":"GitHub"},{"class":"iconfont icon-mail","link":"mailto:clmiao@zju.edu.cn","tip":"邮箱"}]},"page404":{"banner_img":"/img/default.png","banner_img_height":85,"banner_mask_alpha":0.3,"subtitle":"Page not found"},"links":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"items":[{"title":"Fluid Docs","intro":"主题使用指南","link":"https://hexo.fluid-dev.com/docs/","image":"/img/favicon.png"},{"title":"Fluid Repo","intro":"主题 GitHub 仓库","link":"https://github.com/fluid-dev/hexo-theme-fluid","image":"/img/favicon.png"},{"title":"Fluid Example","intro":"主题操作示例","link":"https://hexo.fluid-dev.com/docs/example/","image":"/img/favicon.png"}]}}}},"excerpt":"","more":"<header >\n</header>\n<main class=\"mdl-color--blue-grey-50\">\n    <section class=\"mdl-color--white mdl-shadow--2dp\">\n        <h2 class=\"mdl-typography--display-1\">&emsp;Education</h2>\n        <section>\n            <h3 class=\"mdl-typography--title mdl-typography--title mdl-color-text--indigo-500\">&emsp;Zhejiang University</h3>\n            <p class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">&emsp;Bachelor of Engineering, Computer Science and Technology</p>\n            <p class=\"mdl-typography--body-1 mdl-typography--body-1-color-contrast\">\n                &emsp;August 2017 – Present, Hangzhou, China\n            </p>\n            <ul class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">\n                  <li>Member of Pursuit Science Class (Computer Science), Chu Kochen Honors College</li>\n              <li>Overall GPA: 3.98/4, 4.58/5, 91.5/100</li>\n              <ul class=\"mdl-typography--subhead mdl-typography--subhead-color-contrast\">\n                SELECTED COURSES(4.0/4.0 in all of them)\n                <li>Systems: Digital Logic Design, Computer Organization, Computer Architecture, Computer Networks, Operating System, Compiler Principles</li>\n                <li>Math: Mathematical Analysis, Linear Algebra, Stochastic Process, Probability and Mathematical Statistics, Applied Operation Research, Numerical Analysis</li>\n              </ul>\n              <li>RESEARCH INTEREST: Computer Architecture and Hardware Security, recent projects focused on hardware transactional memory.</li>\n            </ul>\n            <br>\n        </section>\n    </section>"}],"Post":[{"title":"Strategy Method","date":"2020-08-05T07:53:57.000Z","index_img":"/img/image-20200805135526277.png","_content":"\n## 动机\n\n在软件构建过程中，某些对象使用的算法可能多种多样，经常改变，如果将这些算法都编码到对象中，将会使对象变得异常复杂； 而且有时候支持不使用的算法也是一个性能负担\n\n如何在运行时根据需要透明地更改对象的算法？将算法与对象本身解耦，从而避免上述问题？\n\n\n\n## Strategy Method定义\n\n定义一系列算法，把它们一个个封装起来，并且使它们可互 相替换（变化）。该模式使得算法可独立于使用它的客户程 序(稳定)而变化（扩展，子类化）。\n\n\n\n## 代码示例\n\n考虑一下计算税的例子\n\n* 第一种实现方式\n\n```cpp\nenum TaxBase {\n    CN_Tax,\n    US_Tax,\n    DE_Tax\n};\n\nclass SalesOrder {\n    TaxBase tax;\npublic:\n    double CalculateTax() {\n        //...\n        \n        if(tax == CN_Tax) {\n            //CN*****\n        } else if(tax == US_Tax) {\n            //US*****\n        } else if(tax == DE_Tax) {\n            //DE*****\n        }\n        //***\n    }\n}\n```\n\n有些时候，静态地去观察是看不出来的，加入时间轴，考虑到未来的动态变化，问题就会暴露出来。考虑上述例子，如果要加入一个国家，比如法国，那么我们不仅要在`TaxBase`中中增加一个`FR_Tax`, 还需要在`SalesOrder`中增加判断语句。这样的更改违背了开闭原则： 对扩展开放，对修改封闭 (避免去修改源代码\n\n```cpp\nenum TaxBase {\n    CN_Tax,\n    US_Tax,\n    DE_Tax,\n    /***加入France***/\n    FR_Tax,\n};\n\nclass SalesOrder {\n    TaxBase tax;\npublic:\n    double CalculateTax() {\n        //...\n        \n        if(tax == CN_Tax) {\n            //CN*****\n        } else if(tax == US_Tax) {\n            //US*****\n        } else if(tax == DE_Tax) {\n            //DE*****\n        }\n        /***加入France***/\n        else if(tax == FR_Tax) {\n          \n        }\n        //***\n    }\n}\n```\n\n\n\n* 考虑另一种实现方式\n\n```cpp\nclass TaxStrategy {\npublic:\n    virtual double Calculate(const Context& context) = 0;\n    virtual ~TaxStrategy() {}\n};\n\nclass CNTax: public TaxStrategy {\npublic:\n    virtual double Calculate(const Context& context) {\n        //...\n    }\n};\n\nclass USTax: public TaxStrategy {\n    virtual double Calculate(const Context& context) {\n        //...\n    }\n}\nclass DETax: public TaxStrategy {\npublic:\n    virtual double Calculate(const Context& context) {\n        //...\n    }\n}\n```\n\n```cpp\nclass SalesOrder {\nprivate:\n    TaxStrategy* strategy;\npublic:\n    SalesOrder(StrategyFactory* strategyFactory) {\n        this->strategy = strategyFactory->NewStrategy();\n    }\n    \n    ~SalesOrder() {\n        delete this->strategy;\n    }\n    \n    public double CalculateTax() {\n        //...\n        Context context();\n        \n        double val = \n            \tsrtategy->Calculate(context);//多态调用\n    }\n}\n```\n\n如果要增加法国，只需增加一个`FRTax`类\n\n```cpp\nclass FRTax: public TaxStrategy {\npublic:\n    virtual doubel Calculate(const Context& context) {\n        //...\n    }\n}\n```\n\n这是一种扩展的做法，在这里只需要增加一个FRTax类，不需要更改SalesOrder。\n\n复用性一般是指二进制层面下的复用性，如果使用第一种方法，那么整个系统需要重新编译，重新测试。虽然修改后保留了一部分原来的代码，但是这个并不是复用。而策略方法不\u0010需要重新编译之前编译好的文件，只需要重新编译FRTax这个文件\n\n\n\n## 结构\n\n\n\n![image-20200805135526277](image-20200805135526277.png) \n\n\n\n## 总结\n\n* Strategy及其子类为组件提供了一系列可重用的算法，从而可以使 得类型在运行时方便地根据需要在各个算法之间进行切换。\n\n* Strategy模式提供了用条件判断语句以外的另一种选择，消除条件 判断语句，就是在解耦合。含有许多条件判断语句的代码通常都需 要Strategy模式。\n\n* 如果Strategy对象没有实例变量，那么各个上下文可以共享同一个 Strategy对象，从而节省对象开销\n\n\n\n\n\n","source":"_posts/DesignPatterns/StrategyMethod.md","raw":"---\ntitle: Strategy Method\ndate: 2020-08-05 15:53:57\nindex_img: /img/image-20200805135526277.png\ntags: Design Patterns\ncategories: Design Patterns\n---\n\n## 动机\n\n在软件构建过程中，某些对象使用的算法可能多种多样，经常改变，如果将这些算法都编码到对象中，将会使对象变得异常复杂； 而且有时候支持不使用的算法也是一个性能负担\n\n如何在运行时根据需要透明地更改对象的算法？将算法与对象本身解耦，从而避免上述问题？\n\n\n\n## Strategy Method定义\n\n定义一系列算法，把它们一个个封装起来，并且使它们可互 相替换（变化）。该模式使得算法可独立于使用它的客户程 序(稳定)而变化（扩展，子类化）。\n\n\n\n## 代码示例\n\n考虑一下计算税的例子\n\n* 第一种实现方式\n\n```cpp\nenum TaxBase {\n    CN_Tax,\n    US_Tax,\n    DE_Tax\n};\n\nclass SalesOrder {\n    TaxBase tax;\npublic:\n    double CalculateTax() {\n        //...\n        \n        if(tax == CN_Tax) {\n            //CN*****\n        } else if(tax == US_Tax) {\n            //US*****\n        } else if(tax == DE_Tax) {\n            //DE*****\n        }\n        //***\n    }\n}\n```\n\n有些时候，静态地去观察是看不出来的，加入时间轴，考虑到未来的动态变化，问题就会暴露出来。考虑上述例子，如果要加入一个国家，比如法国，那么我们不仅要在`TaxBase`中中增加一个`FR_Tax`, 还需要在`SalesOrder`中增加判断语句。这样的更改违背了开闭原则： 对扩展开放，对修改封闭 (避免去修改源代码\n\n```cpp\nenum TaxBase {\n    CN_Tax,\n    US_Tax,\n    DE_Tax,\n    /***加入France***/\n    FR_Tax,\n};\n\nclass SalesOrder {\n    TaxBase tax;\npublic:\n    double CalculateTax() {\n        //...\n        \n        if(tax == CN_Tax) {\n            //CN*****\n        } else if(tax == US_Tax) {\n            //US*****\n        } else if(tax == DE_Tax) {\n            //DE*****\n        }\n        /***加入France***/\n        else if(tax == FR_Tax) {\n          \n        }\n        //***\n    }\n}\n```\n\n\n\n* 考虑另一种实现方式\n\n```cpp\nclass TaxStrategy {\npublic:\n    virtual double Calculate(const Context& context) = 0;\n    virtual ~TaxStrategy() {}\n};\n\nclass CNTax: public TaxStrategy {\npublic:\n    virtual double Calculate(const Context& context) {\n        //...\n    }\n};\n\nclass USTax: public TaxStrategy {\n    virtual double Calculate(const Context& context) {\n        //...\n    }\n}\nclass DETax: public TaxStrategy {\npublic:\n    virtual double Calculate(const Context& context) {\n        //...\n    }\n}\n```\n\n```cpp\nclass SalesOrder {\nprivate:\n    TaxStrategy* strategy;\npublic:\n    SalesOrder(StrategyFactory* strategyFactory) {\n        this->strategy = strategyFactory->NewStrategy();\n    }\n    \n    ~SalesOrder() {\n        delete this->strategy;\n    }\n    \n    public double CalculateTax() {\n        //...\n        Context context();\n        \n        double val = \n            \tsrtategy->Calculate(context);//多态调用\n    }\n}\n```\n\n如果要增加法国，只需增加一个`FRTax`类\n\n```cpp\nclass FRTax: public TaxStrategy {\npublic:\n    virtual doubel Calculate(const Context& context) {\n        //...\n    }\n}\n```\n\n这是一种扩展的做法，在这里只需要增加一个FRTax类，不需要更改SalesOrder。\n\n复用性一般是指二进制层面下的复用性，如果使用第一种方法，那么整个系统需要重新编译，重新测试。虽然修改后保留了一部分原来的代码，但是这个并不是复用。而策略方法不\u0010需要重新编译之前编译好的文件，只需要重新编译FRTax这个文件\n\n\n\n## 结构\n\n\n\n![image-20200805135526277](image-20200805135526277.png) \n\n\n\n## 总结\n\n* Strategy及其子类为组件提供了一系列可重用的算法，从而可以使 得类型在运行时方便地根据需要在各个算法之间进行切换。\n\n* Strategy模式提供了用条件判断语句以外的另一种选择，消除条件 判断语句，就是在解耦合。含有许多条件判断语句的代码通常都需 要Strategy模式。\n\n* 如果Strategy对象没有实例变量，那么各个上下文可以共享同一个 Strategy对象，从而节省对象开销\n\n\n\n\n\n","slug":"DesignPatterns/StrategyMethod","published":1,"updated":"2020-08-06T08:30:43.543Z","_id":"ckdh3nd2c00026xufglbcalag","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><p>在软件构建过程中，某些对象使用的算法可能多种多样，经常改变，如果将这些算法都编码到对象中，将会使对象变得异常复杂； 而且有时候支持不使用的算法也是一个性能负担</p>\n<p>如何在运行时根据需要透明地更改对象的算法？将算法与对象本身解耦，从而避免上述问题？</p>\n<h2 id=\"Strategy-Method定义\"><a href=\"#Strategy-Method定义\" class=\"headerlink\" title=\"Strategy Method定义\"></a>Strategy Method定义</h2><p>定义一系列算法，把它们一个个封装起来，并且使它们可互 相替换（变化）。该模式使得算法可独立于使用它的客户程 序(稳定)而变化（扩展，子类化）。</p>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>考虑一下计算税的例子</p>\n<ul>\n<li>第一种实现方式</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-keyword\">enum</span> TaxBase &#123;\n    CN_Tax,\n    US_Tax,\n    DE_Tax\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SalesOrder</span> &#123;</span>\n    TaxBase tax;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">CalculateTax</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n        \n        <span class=\"hljs-keyword\">if</span>(tax == CN_Tax) &#123;\n            <span class=\"hljs-comment\">//CN*****</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == US_Tax) &#123;\n            <span class=\"hljs-comment\">//US*****</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == DE_Tax) &#123;\n            <span class=\"hljs-comment\">//DE*****</span>\n        &#125;\n        <span class=\"hljs-comment\">//***</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>有些时候，静态地去观察是看不出来的，加入时间轴，考虑到未来的动态变化，问题就会暴露出来。考虑上述例子，如果要加入一个国家，比如法国，那么我们不仅要在<code>TaxBase</code>中中增加一个<code>FR_Tax</code>, 还需要在<code>SalesOrder</code>中增加判断语句。这样的更改违背了开闭原则： 对扩展开放，对修改封闭 (避免去修改源代码</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-keyword\">enum</span> TaxBase &#123;\n    CN_Tax,\n    US_Tax,\n    DE_Tax,\n    <span class=\"hljs-comment\">/***加入France***/</span>\n    FR_Tax,\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SalesOrder</span> &#123;</span>\n    TaxBase tax;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">CalculateTax</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n        \n        <span class=\"hljs-keyword\">if</span>(tax == CN_Tax) &#123;\n            <span class=\"hljs-comment\">//CN*****</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == US_Tax) &#123;\n            <span class=\"hljs-comment\">//US*****</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == DE_Tax) &#123;\n            <span class=\"hljs-comment\">//DE*****</span>\n        &#125;\n        <span class=\"hljs-comment\">/***加入France***/</span>\n        <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == FR_Tax) &#123;\n          \n        &#125;\n        <span class=\"hljs-comment\">//***</span>\n    &#125;\n&#125;</code></pre></div>\n\n\n\n<ul>\n<li>考虑另一种实现方式</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TaxStrategy</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">virtual</span> ~TaxStrategy() &#123;&#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CNTax</span>:</span> <span class=\"hljs-keyword\">public</span> TaxStrategy &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">USTax</span>:</span> <span class=\"hljs-keyword\">public</span> TaxStrategy &#123;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DETax</span>:</span> <span class=\"hljs-keyword\">public</span> TaxStrategy &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SalesOrder</span> &#123;</span>\n<span class=\"hljs-keyword\">private</span>:\n    TaxStrategy* strategy;\n<span class=\"hljs-keyword\">public</span>:\n    SalesOrder(StrategyFactory* strategyFactory) &#123;\n        <span class=\"hljs-keyword\">this</span>-&gt;strategy = strategyFactory-&gt;NewStrategy();\n    &#125;\n    \n    ~SalesOrder() &#123;\n        <span class=\"hljs-keyword\">delete</span> <span class=\"hljs-keyword\">this</span>-&gt;strategy;\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">CalculateTax</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n        <span class=\"hljs-function\">Context <span class=\"hljs-title\">context</span><span class=\"hljs-params\">()</span></span>;\n        \n        <span class=\"hljs-keyword\">double</span> val = \n            \tsrtategy-&gt;Calculate(context);<span class=\"hljs-comment\">//多态调用</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>如果要增加法国，只需增加一个<code>FRTax</code>类</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FRTax</span>:</span> <span class=\"hljs-keyword\">public</span> TaxStrategy &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> doubel <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>这是一种扩展的做法，在这里只需要增加一个FRTax类，不需要更改SalesOrder。</p>\n<p>复用性一般是指二进制层面下的复用性，如果使用第一种方法，那么整个系统需要重新编译，重新测试。虽然修改后保留了一部分原来的代码，但是这个并不是复用。而策略方法不\u0010需要重新编译之前编译好的文件，只需要重新编译FRTax这个文件</p>\n<h2 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h2><p><img src=\"image-20200805135526277.png\" srcset=\"/img/loading.gif\" alt=\"image-20200805135526277\"> </p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li><p>Strategy及其子类为组件提供了一系列可重用的算法，从而可以使 得类型在运行时方便地根据需要在各个算法之间进行切换。</p>\n</li>\n<li><p>Strategy模式提供了用条件判断语句以外的另一种选择，消除条件 判断语句，就是在解耦合。含有许多条件判断语句的代码通常都需 要Strategy模式。</p>\n</li>\n<li><p>如果Strategy对象没有实例变量，那么各个上下文可以共享同一个 Strategy对象，从而节省对象开销</p>\n</li>\n</ul>\n","site":{"data":{"fluid_config":{"favicon":"/img/favicon.png","apple_touch_icon":"/img/favicon.png","title_join_string":" - ","force_https":false,"highlight":{"enable":true,"style":"Atom One Dark","bg_color":true,"copy_btn":true},"fun_features":{"typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"mouse_click":{"enable":false,"style":"values"}},"color":{"body_bg_color":"#eee","navbar_bg_color":"black","navbar_text_color":"white","text_color":"#3c4858","sec_text_color":"#718096","post_text_color":"#2c3e50","post_heading_color":"#1a202c","link_color":"#3c4858","link_hover_color":"#1abc9c","link_hover_bg_color":"#f8f9fa","board_color":"#fff"},"font":{"font_size":"16px","font_family":null,"code_font_size":"85%"},"custom_js":null,"custom_css":null,"custom_html":"","web_analytics":{"enable":false,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"tajs":null,"woyaola":null,"cnzz":null,"leancloud":{"app_id":"6ojk1lVz9eq7GQnBo6Q8zR5d-gzGzoHsz","app_key":"bOrBPlujAz77Ma6N5tY9wWJN","server_url":null}},"lazyload":{"enable":true,"onlypost":false},"daovoice":{"enable":false,"appid":""},"aplayer":{"enable":false,"autoplay":false,"loop":"all","order":"random","theme":"#b7daff","songs":[{"name":"name","artist":"artist","url":"/songs/test.mp3","cover":"/img/cover.jpg"},{"name":"name","artist":"artist","url":"https://...url.mp3","cover":"https://...cover.jpg"}]},"version":{"check":false},"navbar":{"blog_title":"Explorer","ground_glass":{"enable":false,"px":3,"alpha":0.7},"menu":[{"key":"home","link":"/","icon":"iconfont icon-home-fill"},{"key":"archive","link":"/archives/","icon":"iconfont icon-archive-fill"},{"key":"category","link":"/categories/","icon":"iconfont icon-category-fill"},{"key":"tag","link":"/tags/","icon":"iconfont icon-tags-fill"},{"key":"about","link":"/about/","icon":"iconfont icon-user-fill"}]},"search":{"enable":true,"path":"/local-search.xml","generate_path":"/local-search.xml","field":"post","content":true},"scroll_down_arrow":{"enable":true,"banner_height_limit":90,"scroll_after_turning_page":true},"banner_parallax":true,"footer":{"statistics":{"enable":false,"source":"busuanzi","pv_format":"总访问量 {} 次","uv_format":"总访客数 {} 人"},"beian":{"enable":false,"icp_text":"京ICP证123456号","police_text":"京公网安备12345678号","police_code":12345678,"police_icon":"/img/police_beian.png"}},"scroll_top_arrow":{"enable":true},"index":{"banner_img":"/img/default.png","banner_img_height":100,"banner_mask_alpha":0.3,"post_default_img":"","slogan":{"enable":true,"text":"It&apos; s Us Make The World Different"},"auto_excerpt":{"enable":true},"post_url_target":"_self","post_meta":{"date":true,"category":true,"tag":true}},"page":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3},"post":{"banner_img":"/img/default.png","banner_img_height":70,"banner_mask_alpha":0.3,"meta":{"date":{"enable":true,"format":"LL a"},"wordcount":{"enable":true,"format":"{} 字"},"min2read":{"enable":true,"format":"{} 分钟","words":100},"views":{"enable":true,"source":"busuanzi","format":"{} 次"}},"updated":{"enable":false,"content":"本文最后更新于：","relative":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"copyright":{"enable":true,"content":"本博客所有文章除特别声明外，均采用 <a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.zh\" rel=\"nofollow noopener\">CC BY-SA 4.0 协议</a> ，转载请注明出处！"},"prev_next":{"enable":true},"custom":{"enable":false,"content":"<img src=\"https://octodex.github.com/images/jetpacktocat.png\" class=\"rounded mx-auto d-block mt-5\" style=\"width:150px; height:150px;\">"},"image_zoom":{"enable":true},"footnote":{"enable":true,"header":""},"math":{"enable":true,"specific":false,"engine":"mathjax"},"mermaid":{"enable":true,"specific":false,"options":{"theme":"default"}},"comments":{"enable":false,"type":"gitalk"}},"utterances":{"repo":null,"issue_term":null,"label":"utterances","theme":"github-light","crossorigin":"anonymous"},"disqus":{"shortname":null,"disqusjs":false,"apikey":null},"gitalk":{"clientID":"cde2629d6201340c948b","clientSecret":"621727333cc595103f634cf6deaba53bd8784fe6","repo":"blog-comments","owner":"miaochenlu","admin":null,"id":"location.pathname","language":"zh-CN","labels":"['Gitalk']","perPage":15,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true},"valine":{"appid":null,"appkey":null,"placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":null},"changyan":{"appid":"","appkey":""},"livere":{"uid":""},"archive":{"banner_img":"/img/achive.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null},"category":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"post_limit":10,"order_by":"-length"},"tag":{"banner_img":"/img/default.png","banner_img_height":80,"banner_mask_alpha":0.3,"subtitle":null,"tagcloud":{"min_font":15,"max_font":30,"unit":"px","start_color":"#BBBBEE","end_color":"#337ab7"}},"about":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"avatar":"/img/avatar.png","name":"Chenlu Miao","introduce":"李德胜永远滴神","icons":[{"class":"iconfont icon-github-fill","link":"https://github.com/miaochenlu","tip":"GitHub"},{"class":"iconfont icon-mail","link":"mailto:clmiao@zju.edu.cn","tip":"邮箱"}]},"page404":{"banner_img":"/img/default.png","banner_img_height":85,"banner_mask_alpha":0.3,"subtitle":"Page not found"},"links":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"items":[{"title":"Fluid Docs","intro":"主题使用指南","link":"https://hexo.fluid-dev.com/docs/","image":"/img/favicon.png"},{"title":"Fluid Repo","intro":"主题 GitHub 仓库","link":"https://github.com/fluid-dev/hexo-theme-fluid","image":"/img/favicon.png"},{"title":"Fluid Example","intro":"主题操作示例","link":"https://hexo.fluid-dev.com/docs/example/","image":"/img/favicon.png"}]}}}},"excerpt":"","more":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><p>在软件构建过程中，某些对象使用的算法可能多种多样，经常改变，如果将这些算法都编码到对象中，将会使对象变得异常复杂； 而且有时候支持不使用的算法也是一个性能负担</p>\n<p>如何在运行时根据需要透明地更改对象的算法？将算法与对象本身解耦，从而避免上述问题？</p>\n<h2 id=\"Strategy-Method定义\"><a href=\"#Strategy-Method定义\" class=\"headerlink\" title=\"Strategy Method定义\"></a>Strategy Method定义</h2><p>定义一系列算法，把它们一个个封装起来，并且使它们可互 相替换（变化）。该模式使得算法可独立于使用它的客户程 序(稳定)而变化（扩展，子类化）。</p>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>考虑一下计算税的例子</p>\n<ul>\n<li>第一种实现方式</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-keyword\">enum</span> TaxBase &#123;\n    CN_Tax,\n    US_Tax,\n    DE_Tax\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SalesOrder</span> &#123;</span>\n    TaxBase tax;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">CalculateTax</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n        \n        <span class=\"hljs-keyword\">if</span>(tax == CN_Tax) &#123;\n            <span class=\"hljs-comment\">//CN*****</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == US_Tax) &#123;\n            <span class=\"hljs-comment\">//US*****</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == DE_Tax) &#123;\n            <span class=\"hljs-comment\">//DE*****</span>\n        &#125;\n        <span class=\"hljs-comment\">//***</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>有些时候，静态地去观察是看不出来的，加入时间轴，考虑到未来的动态变化，问题就会暴露出来。考虑上述例子，如果要加入一个国家，比如法国，那么我们不仅要在<code>TaxBase</code>中中增加一个<code>FR_Tax</code>, 还需要在<code>SalesOrder</code>中增加判断语句。这样的更改违背了开闭原则： 对扩展开放，对修改封闭 (避免去修改源代码</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-keyword\">enum</span> TaxBase &#123;\n    CN_Tax,\n    US_Tax,\n    DE_Tax,\n    <span class=\"hljs-comment\">/***加入France***/</span>\n    FR_Tax,\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SalesOrder</span> &#123;</span>\n    TaxBase tax;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">CalculateTax</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n        \n        <span class=\"hljs-keyword\">if</span>(tax == CN_Tax) &#123;\n            <span class=\"hljs-comment\">//CN*****</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == US_Tax) &#123;\n            <span class=\"hljs-comment\">//US*****</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == DE_Tax) &#123;\n            <span class=\"hljs-comment\">//DE*****</span>\n        &#125;\n        <span class=\"hljs-comment\">/***加入France***/</span>\n        <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(tax == FR_Tax) &#123;\n          \n        &#125;\n        <span class=\"hljs-comment\">//***</span>\n    &#125;\n&#125;</code></pre></div>\n\n\n\n<ul>\n<li>考虑另一种实现方式</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TaxStrategy</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">virtual</span> ~TaxStrategy() &#123;&#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CNTax</span>:</span> <span class=\"hljs-keyword\">public</span> TaxStrategy &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">USTax</span>:</span> <span class=\"hljs-keyword\">public</span> TaxStrategy &#123;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DETax</span>:</span> <span class=\"hljs-keyword\">public</span> TaxStrategy &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SalesOrder</span> &#123;</span>\n<span class=\"hljs-keyword\">private</span>:\n    TaxStrategy* strategy;\n<span class=\"hljs-keyword\">public</span>:\n    SalesOrder(StrategyFactory* strategyFactory) &#123;\n        <span class=\"hljs-keyword\">this</span>-&gt;strategy = strategyFactory-&gt;NewStrategy();\n    &#125;\n    \n    ~SalesOrder() &#123;\n        <span class=\"hljs-keyword\">delete</span> <span class=\"hljs-keyword\">this</span>-&gt;strategy;\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">CalculateTax</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n        <span class=\"hljs-function\">Context <span class=\"hljs-title\">context</span><span class=\"hljs-params\">()</span></span>;\n        \n        <span class=\"hljs-keyword\">double</span> val = \n            \tsrtategy-&gt;Calculate(context);<span class=\"hljs-comment\">//多态调用</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>如果要增加法国，只需增加一个<code>FRTax</code>类</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FRTax</span>:</span> <span class=\"hljs-keyword\">public</span> TaxStrategy &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> doubel <span class=\"hljs-title\">Calculate</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> Context&amp; context)</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>这是一种扩展的做法，在这里只需要增加一个FRTax类，不需要更改SalesOrder。</p>\n<p>复用性一般是指二进制层面下的复用性，如果使用第一种方法，那么整个系统需要重新编译，重新测试。虽然修改后保留了一部分原来的代码，但是这个并不是复用。而策略方法不\u0010需要重新编译之前编译好的文件，只需要重新编译FRTax这个文件</p>\n<h2 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h2><p><img src=\"image-20200805135526277.png\" srcset=\"/img/loading.gif\" alt=\"image-20200805135526277\"> </p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li><p>Strategy及其子类为组件提供了一系列可重用的算法，从而可以使 得类型在运行时方便地根据需要在各个算法之间进行切换。</p>\n</li>\n<li><p>Strategy模式提供了用条件判断语句以外的另一种选择，消除条件 判断语句，就是在解耦合。含有许多条件判断语句的代码通常都需 要Strategy模式。</p>\n</li>\n<li><p>如果Strategy对象没有实例变量，那么各个上下文可以共享同一个 Strategy对象，从而节省对象开销</p>\n</li>\n</ul>\n"},{"title":"Template Method","date":"2020-08-05T08:10:25.000Z","index_img":"/img/image-20200710192039991.png","_content":"\n## 动机\n\n在软件构建过程中，对于某一项任务，它常常有稳定的整体操作结构，但各个子步骤却有很多改变的需求，或者由于固有的原因 （比如框架与应用之间的关系）而无法和任务的整体结构同时实现。\n\n核心在于在稳定与变化之间求得一个平衡，如果全部稳定或者全部变化都是不需要设计模式的。\n\n如何在确定**稳定操作结构**的前提下，来灵活应对**各个子步骤的变化**或者**晚期实现需求**？\n\n假设整个代码的操作结构如下图所示，其中红色是Library开发人员完成的，蓝色部分是Application开发人员完成的\n\n<img src=\"image-20200710191024075.png\" alt=\"image-20200710191024075\" style=\"zoom:33%;\" />\n\n\n\n## 结构化软件流程设计\n\n<img src=\"image-20200710191212499.png\" alt=\"image-20200710191212499\" style=\"zoom:50%;\" />\n\nlib.cpp\n\n```cpp\nclass Library {\npublic:\n    void Step1() {\n        //...\n    }\n    void Step3() {\n        //...\n    }\n    void Step5() {\n        //...\n    }\n}\n```\n\napp.cpp\n\n```cpp\n//应用程序开发人员\nclass Application {\npublic:\n    bool Step2() {\n        //...\n    }\n    void Step4() {\n        //...\n    }\n}\n```\n\n主程序\n\n```cpp\nint main() {\n    Library lib();\n    Application app();\n    \n    lib.Step1();\n    \n    if(app.Step2()) {\n        lib.Step3();\n    }\n    for(int i = 0; i < 4; i++) {\n        app.Step4();\n    }\n    lib.Step5();\n}\n```\n\n\n\n## 用模板方法的代码重构为\n\n<img src=\"image-20200710191917988.png\" alt=\"image-20200710191917988\" style=\"zoom:50%;\" />\n\nlib.cpp\n\n```cpp\nclass Library {\npublic:\n    void Run() {\n        Step1();\n        if(Step2()) {\n            Step3();\n        }\n        for(int i = 0; i < 4; i++) {\n            Step4();\n        }\n        Step5();\n    }\n    \n    virtual ~Library() {}\nprotected:\n    void Step1() { //稳定\n        //...\n    }\n    void Step3() { //稳定\n        //...\n    }\n    void Step5() { //稳定\n        //...\n    }\n    \n    virtual bool Step2() = 0; //变化\n    virtual void Step4() = 0; //变化\n}\n```\n\napp.cpp\n\n```cpp\n//应用程序开发人员\nclass Application: public Library {\nprotected:\n    virtual bool Step2() {\n        //...\n    }\n    virtual void Step4() {\n        //...\n    }\n};\n```\n\n主程序\n\n```cpp\nint main() {\n    Library* pLib = new Application();\n    lib.Run();\n    delete pLib;\n}\n```\n\n\n\n## 总结\n\n这两者的区别在于早绑定和晚绑定。前者属于早绑定，而template method属于晚绑定\n\n<img src=\"image-20200710192039991.png\" alt=\"image-20200710192039991\" style=\"zoom:50%;\" />\n\n定义一个操作中的算法的骨架 (稳定)，而将一些步骤延迟 (变化)到子类中。Template Method使得子类可以不改变 (复用)一个算法的结构即可重定义(override 重写)该算法的某些特定步骤。\n\n","source":"_posts/DesignPatterns/TemplateMethod.md","raw":"---\ntitle: Template Method\ndate: 2020-08-05 16:10:25\nindex_img: /img/image-20200710192039991.png\ntags: Design Patterns\ncategories: Design Patterns\n---\n\n## 动机\n\n在软件构建过程中，对于某一项任务，它常常有稳定的整体操作结构，但各个子步骤却有很多改变的需求，或者由于固有的原因 （比如框架与应用之间的关系）而无法和任务的整体结构同时实现。\n\n核心在于在稳定与变化之间求得一个平衡，如果全部稳定或者全部变化都是不需要设计模式的。\n\n如何在确定**稳定操作结构**的前提下，来灵活应对**各个子步骤的变化**或者**晚期实现需求**？\n\n假设整个代码的操作结构如下图所示，其中红色是Library开发人员完成的，蓝色部分是Application开发人员完成的\n\n<img src=\"image-20200710191024075.png\" alt=\"image-20200710191024075\" style=\"zoom:33%;\" />\n\n\n\n## 结构化软件流程设计\n\n<img src=\"image-20200710191212499.png\" alt=\"image-20200710191212499\" style=\"zoom:50%;\" />\n\nlib.cpp\n\n```cpp\nclass Library {\npublic:\n    void Step1() {\n        //...\n    }\n    void Step3() {\n        //...\n    }\n    void Step5() {\n        //...\n    }\n}\n```\n\napp.cpp\n\n```cpp\n//应用程序开发人员\nclass Application {\npublic:\n    bool Step2() {\n        //...\n    }\n    void Step4() {\n        //...\n    }\n}\n```\n\n主程序\n\n```cpp\nint main() {\n    Library lib();\n    Application app();\n    \n    lib.Step1();\n    \n    if(app.Step2()) {\n        lib.Step3();\n    }\n    for(int i = 0; i < 4; i++) {\n        app.Step4();\n    }\n    lib.Step5();\n}\n```\n\n\n\n## 用模板方法的代码重构为\n\n<img src=\"image-20200710191917988.png\" alt=\"image-20200710191917988\" style=\"zoom:50%;\" />\n\nlib.cpp\n\n```cpp\nclass Library {\npublic:\n    void Run() {\n        Step1();\n        if(Step2()) {\n            Step3();\n        }\n        for(int i = 0; i < 4; i++) {\n            Step4();\n        }\n        Step5();\n    }\n    \n    virtual ~Library() {}\nprotected:\n    void Step1() { //稳定\n        //...\n    }\n    void Step3() { //稳定\n        //...\n    }\n    void Step5() { //稳定\n        //...\n    }\n    \n    virtual bool Step2() = 0; //变化\n    virtual void Step4() = 0; //变化\n}\n```\n\napp.cpp\n\n```cpp\n//应用程序开发人员\nclass Application: public Library {\nprotected:\n    virtual bool Step2() {\n        //...\n    }\n    virtual void Step4() {\n        //...\n    }\n};\n```\n\n主程序\n\n```cpp\nint main() {\n    Library* pLib = new Application();\n    lib.Run();\n    delete pLib;\n}\n```\n\n\n\n## 总结\n\n这两者的区别在于早绑定和晚绑定。前者属于早绑定，而template method属于晚绑定\n\n<img src=\"image-20200710192039991.png\" alt=\"image-20200710192039991\" style=\"zoom:50%;\" />\n\n定义一个操作中的算法的骨架 (稳定)，而将一些步骤延迟 (变化)到子类中。Template Method使得子类可以不改变 (复用)一个算法的结构即可重定义(override 重写)该算法的某些特定步骤。\n\n","slug":"DesignPatterns/TemplateMethod","published":1,"updated":"2020-08-06T08:30:27.487Z","_id":"ckdh3nmky00046xufa4pw5hqd","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><p>在软件构建过程中，对于某一项任务，它常常有稳定的整体操作结构，但各个子步骤却有很多改变的需求，或者由于固有的原因 （比如框架与应用之间的关系）而无法和任务的整体结构同时实现。</p>\n<p>核心在于在稳定与变化之间求得一个平衡，如果全部稳定或者全部变化都是不需要设计模式的。</p>\n<p>如何在确定<strong>稳定操作结构</strong>的前提下，来灵活应对<strong>各个子步骤的变化</strong>或者<strong>晚期实现需求</strong>？</p>\n<p>假设整个代码的操作结构如下图所示，其中红色是Library开发人员完成的，蓝色部分是Application开发人员完成的</p>\n<img src=\"image-20200710191024075.png\" srcset=\"/img/loading.gif\" alt=\"image-20200710191024075\" style=\"zoom:33%;\" />\n\n\n\n<h2 id=\"结构化软件流程设计\"><a href=\"#结构化软件流程设计\" class=\"headerlink\" title=\"结构化软件流程设计\"></a>结构化软件流程设计</h2><img src=\"image-20200710191212499.png\" srcset=\"/img/loading.gif\" alt=\"image-20200710191212499\" style=\"zoom:50%;\" />\n\n<p>lib.cpp</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Library</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step1</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step3</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step5</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>app.cpp</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//应用程序开发人员</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Application</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">Step2</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step4</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>主程序</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;\n    <span class=\"hljs-function\">Library <span class=\"hljs-title\">lib</span><span class=\"hljs-params\">()</span></span>;\n    <span class=\"hljs-function\">Application <span class=\"hljs-title\">app</span><span class=\"hljs-params\">()</span></span>;\n    \n    lib.Step1();\n    \n    <span class=\"hljs-keyword\">if</span>(app.Step2()) &#123;\n        lib.Step3();\n    &#125;\n    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">4</span>; i++) &#123;\n        app.Step4();\n    &#125;\n    lib.Step5();\n&#125;</code></pre></div>\n\n\n\n<h2 id=\"用模板方法的代码重构为\"><a href=\"#用模板方法的代码重构为\" class=\"headerlink\" title=\"用模板方法的代码重构为\"></a>用模板方法的代码重构为</h2><img src=\"image-20200710191917988.png\" srcset=\"/img/loading.gif\" alt=\"image-20200710191917988\" style=\"zoom:50%;\" />\n\n<p>lib.cpp</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Library</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Run</span><span class=\"hljs-params\">()</span> </span>&#123;\n        Step1();\n        <span class=\"hljs-keyword\">if</span>(Step2()) &#123;\n            Step3();\n        &#125;\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">4</span>; i++) &#123;\n            Step4();\n        &#125;\n        Step5();\n    &#125;\n    \n    <span class=\"hljs-keyword\">virtual</span> ~Library() &#123;&#125;\n<span class=\"hljs-keyword\">protected</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step1</span><span class=\"hljs-params\">()</span> </span>&#123; <span class=\"hljs-comment\">//稳定</span>\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step3</span><span class=\"hljs-params\">()</span> </span>&#123; <span class=\"hljs-comment\">//稳定</span>\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step5</span><span class=\"hljs-params\">()</span> </span>&#123; <span class=\"hljs-comment\">//稳定</span>\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">Step2</span><span class=\"hljs-params\">()</span> </span>= <span class=\"hljs-number\">0</span>; <span class=\"hljs-comment\">//变化</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step4</span><span class=\"hljs-params\">()</span> </span>= <span class=\"hljs-number\">0</span>; <span class=\"hljs-comment\">//变化</span>\n&#125;</code></pre></div>\n\n<p>app.cpp</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//应用程序开发人员</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Application</span>:</span> <span class=\"hljs-keyword\">public</span> Library &#123;\n<span class=\"hljs-keyword\">protected</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">Step2</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step4</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;;</code></pre></div>\n\n<p>主程序</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;\n    Library* pLib = <span class=\"hljs-keyword\">new</span> Application();\n    lib.Run();\n    <span class=\"hljs-keyword\">delete</span> pLib;\n&#125;</code></pre></div>\n\n\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这两者的区别在于早绑定和晚绑定。前者属于早绑定，而template method属于晚绑定</p>\n<img src=\"image-20200710192039991.png\" srcset=\"/img/loading.gif\" alt=\"image-20200710192039991\" style=\"zoom:50%;\" />\n\n<p>定义一个操作中的算法的骨架 (稳定)，而将一些步骤延迟 (变化)到子类中。Template Method使得子类可以不改变 (复用)一个算法的结构即可重定义(override 重写)该算法的某些特定步骤。</p>\n","site":{"data":{"fluid_config":{"favicon":"/img/favicon.png","apple_touch_icon":"/img/favicon.png","title_join_string":" - ","force_https":false,"highlight":{"enable":true,"style":"Atom One Dark","bg_color":true,"copy_btn":true},"fun_features":{"typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"mouse_click":{"enable":false,"style":"values"}},"color":{"body_bg_color":"#eee","navbar_bg_color":"black","navbar_text_color":"white","text_color":"#3c4858","sec_text_color":"#718096","post_text_color":"#2c3e50","post_heading_color":"#1a202c","link_color":"#3c4858","link_hover_color":"#1abc9c","link_hover_bg_color":"#f8f9fa","board_color":"#fff"},"font":{"font_size":"16px","font_family":null,"code_font_size":"85%"},"custom_js":null,"custom_css":null,"custom_html":"","web_analytics":{"enable":false,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"tajs":null,"woyaola":null,"cnzz":null,"leancloud":{"app_id":"6ojk1lVz9eq7GQnBo6Q8zR5d-gzGzoHsz","app_key":"bOrBPlujAz77Ma6N5tY9wWJN","server_url":null}},"lazyload":{"enable":true,"onlypost":false},"daovoice":{"enable":false,"appid":""},"aplayer":{"enable":false,"autoplay":false,"loop":"all","order":"random","theme":"#b7daff","songs":[{"name":"name","artist":"artist","url":"/songs/test.mp3","cover":"/img/cover.jpg"},{"name":"name","artist":"artist","url":"https://...url.mp3","cover":"https://...cover.jpg"}]},"version":{"check":false},"navbar":{"blog_title":"Explorer","ground_glass":{"enable":false,"px":3,"alpha":0.7},"menu":[{"key":"home","link":"/","icon":"iconfont icon-home-fill"},{"key":"archive","link":"/archives/","icon":"iconfont icon-archive-fill"},{"key":"category","link":"/categories/","icon":"iconfont icon-category-fill"},{"key":"tag","link":"/tags/","icon":"iconfont icon-tags-fill"},{"key":"about","link":"/about/","icon":"iconfont icon-user-fill"}]},"search":{"enable":true,"path":"/local-search.xml","generate_path":"/local-search.xml","field":"post","content":true},"scroll_down_arrow":{"enable":true,"banner_height_limit":90,"scroll_after_turning_page":true},"banner_parallax":true,"footer":{"statistics":{"enable":false,"source":"busuanzi","pv_format":"总访问量 {} 次","uv_format":"总访客数 {} 人"},"beian":{"enable":false,"icp_text":"京ICP证123456号","police_text":"京公网安备12345678号","police_code":12345678,"police_icon":"/img/police_beian.png"}},"scroll_top_arrow":{"enable":true},"index":{"banner_img":"/img/default.png","banner_img_height":100,"banner_mask_alpha":0.3,"post_default_img":"","slogan":{"enable":true,"text":"It&apos; s Us Make The World Different"},"auto_excerpt":{"enable":true},"post_url_target":"_self","post_meta":{"date":true,"category":true,"tag":true}},"page":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3},"post":{"banner_img":"/img/default.png","banner_img_height":70,"banner_mask_alpha":0.3,"meta":{"date":{"enable":true,"format":"LL a"},"wordcount":{"enable":true,"format":"{} 字"},"min2read":{"enable":true,"format":"{} 分钟","words":100},"views":{"enable":true,"source":"busuanzi","format":"{} 次"}},"updated":{"enable":false,"content":"本文最后更新于：","relative":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"copyright":{"enable":true,"content":"本博客所有文章除特别声明外，均采用 <a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.zh\" rel=\"nofollow noopener\">CC BY-SA 4.0 协议</a> ，转载请注明出处！"},"prev_next":{"enable":true},"custom":{"enable":false,"content":"<img src=\"https://octodex.github.com/images/jetpacktocat.png\" class=\"rounded mx-auto d-block mt-5\" style=\"width:150px; height:150px;\">"},"image_zoom":{"enable":true},"footnote":{"enable":true,"header":""},"math":{"enable":true,"specific":false,"engine":"mathjax"},"mermaid":{"enable":true,"specific":false,"options":{"theme":"default"}},"comments":{"enable":false,"type":"gitalk"}},"utterances":{"repo":null,"issue_term":null,"label":"utterances","theme":"github-light","crossorigin":"anonymous"},"disqus":{"shortname":null,"disqusjs":false,"apikey":null},"gitalk":{"clientID":"cde2629d6201340c948b","clientSecret":"621727333cc595103f634cf6deaba53bd8784fe6","repo":"blog-comments","owner":"miaochenlu","admin":null,"id":"location.pathname","language":"zh-CN","labels":"['Gitalk']","perPage":15,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true},"valine":{"appid":null,"appkey":null,"placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":null},"changyan":{"appid":"","appkey":""},"livere":{"uid":""},"archive":{"banner_img":"/img/achive.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null},"category":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"post_limit":10,"order_by":"-length"},"tag":{"banner_img":"/img/default.png","banner_img_height":80,"banner_mask_alpha":0.3,"subtitle":null,"tagcloud":{"min_font":15,"max_font":30,"unit":"px","start_color":"#BBBBEE","end_color":"#337ab7"}},"about":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"avatar":"/img/avatar.png","name":"Chenlu Miao","introduce":"李德胜永远滴神","icons":[{"class":"iconfont icon-github-fill","link":"https://github.com/miaochenlu","tip":"GitHub"},{"class":"iconfont icon-mail","link":"mailto:clmiao@zju.edu.cn","tip":"邮箱"}]},"page404":{"banner_img":"/img/default.png","banner_img_height":85,"banner_mask_alpha":0.3,"subtitle":"Page not found"},"links":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"items":[{"title":"Fluid Docs","intro":"主题使用指南","link":"https://hexo.fluid-dev.com/docs/","image":"/img/favicon.png"},{"title":"Fluid Repo","intro":"主题 GitHub 仓库","link":"https://github.com/fluid-dev/hexo-theme-fluid","image":"/img/favicon.png"},{"title":"Fluid Example","intro":"主题操作示例","link":"https://hexo.fluid-dev.com/docs/example/","image":"/img/favicon.png"}]}}}},"excerpt":"","more":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><p>在软件构建过程中，对于某一项任务，它常常有稳定的整体操作结构，但各个子步骤却有很多改变的需求，或者由于固有的原因 （比如框架与应用之间的关系）而无法和任务的整体结构同时实现。</p>\n<p>核心在于在稳定与变化之间求得一个平衡，如果全部稳定或者全部变化都是不需要设计模式的。</p>\n<p>如何在确定<strong>稳定操作结构</strong>的前提下，来灵活应对<strong>各个子步骤的变化</strong>或者<strong>晚期实现需求</strong>？</p>\n<p>假设整个代码的操作结构如下图所示，其中红色是Library开发人员完成的，蓝色部分是Application开发人员完成的</p>\n<img src=\"image-20200710191024075.png\" srcset=\"/img/loading.gif\" alt=\"image-20200710191024075\" style=\"zoom:33%;\" />\n\n\n\n<h2 id=\"结构化软件流程设计\"><a href=\"#结构化软件流程设计\" class=\"headerlink\" title=\"结构化软件流程设计\"></a>结构化软件流程设计</h2><img src=\"image-20200710191212499.png\" srcset=\"/img/loading.gif\" alt=\"image-20200710191212499\" style=\"zoom:50%;\" />\n\n<p>lib.cpp</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Library</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step1</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step3</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step5</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>app.cpp</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//应用程序开发人员</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Application</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">Step2</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step4</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;</code></pre></div>\n\n<p>主程序</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;\n    <span class=\"hljs-function\">Library <span class=\"hljs-title\">lib</span><span class=\"hljs-params\">()</span></span>;\n    <span class=\"hljs-function\">Application <span class=\"hljs-title\">app</span><span class=\"hljs-params\">()</span></span>;\n    \n    lib.Step1();\n    \n    <span class=\"hljs-keyword\">if</span>(app.Step2()) &#123;\n        lib.Step3();\n    &#125;\n    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">4</span>; i++) &#123;\n        app.Step4();\n    &#125;\n    lib.Step5();\n&#125;</code></pre></div>\n\n\n\n<h2 id=\"用模板方法的代码重构为\"><a href=\"#用模板方法的代码重构为\" class=\"headerlink\" title=\"用模板方法的代码重构为\"></a>用模板方法的代码重构为</h2><img src=\"image-20200710191917988.png\" srcset=\"/img/loading.gif\" alt=\"image-20200710191917988\" style=\"zoom:50%;\" />\n\n<p>lib.cpp</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Library</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Run</span><span class=\"hljs-params\">()</span> </span>&#123;\n        Step1();\n        <span class=\"hljs-keyword\">if</span>(Step2()) &#123;\n            Step3();\n        &#125;\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">4</span>; i++) &#123;\n            Step4();\n        &#125;\n        Step5();\n    &#125;\n    \n    <span class=\"hljs-keyword\">virtual</span> ~Library() &#123;&#125;\n<span class=\"hljs-keyword\">protected</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step1</span><span class=\"hljs-params\">()</span> </span>&#123; <span class=\"hljs-comment\">//稳定</span>\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step3</span><span class=\"hljs-params\">()</span> </span>&#123; <span class=\"hljs-comment\">//稳定</span>\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step5</span><span class=\"hljs-params\">()</span> </span>&#123; <span class=\"hljs-comment\">//稳定</span>\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">Step2</span><span class=\"hljs-params\">()</span> </span>= <span class=\"hljs-number\">0</span>; <span class=\"hljs-comment\">//变化</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step4</span><span class=\"hljs-params\">()</span> </span>= <span class=\"hljs-number\">0</span>; <span class=\"hljs-comment\">//变化</span>\n&#125;</code></pre></div>\n\n<p>app.cpp</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//应用程序开发人员</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Application</span>:</span> <span class=\"hljs-keyword\">public</span> Library &#123;\n<span class=\"hljs-keyword\">protected</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">Step2</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Step4</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//...</span>\n    &#125;\n&#125;;</code></pre></div>\n\n<p>主程序</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;\n    Library* pLib = <span class=\"hljs-keyword\">new</span> Application();\n    lib.Run();\n    <span class=\"hljs-keyword\">delete</span> pLib;\n&#125;</code></pre></div>\n\n\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这两者的区别在于早绑定和晚绑定。前者属于早绑定，而template method属于晚绑定</p>\n<img src=\"image-20200710192039991.png\" srcset=\"/img/loading.gif\" alt=\"image-20200710192039991\" style=\"zoom:50%;\" />\n\n<p>定义一个操作中的算法的骨架 (稳定)，而将一些步骤延迟 (变化)到子类中。Template Method使得子类可以不改变 (复用)一个算法的结构即可重定义(override 重写)该算法的某些特定步骤。</p>\n"},{"title":"面向对象设计原则","date":"2020-08-06T07:20:24.000Z","_content":"\n\n\n{% note info%}\n\n变化是复用的天敌！ 面向对象设计最大的优势在于：<u>***抵御变化***</u>\n\n{% endnote %}\n\n\n\n#### 依赖倒置原则 (DIP)\n\n* 高层模块(稳定)不应该依赖于低层模块(变化)，二者都应该依赖于抽象(稳定) 。\n\n* 抽象(稳定)不应该依赖于实现细节(变化) ，实现细节应该依赖于抽象(稳定)。\n\n<br>\n\n#### 开放封闭原则 (OCP)\n\n* 对扩展开放，对更改封闭。\n\n* 类模块应该是可扩展的，但是不可修改。","source":"_posts/Principle.md","raw":"---\ntitle: 面向对象设计原则\ndate: 2020-08-06 15:20:24\ntags: Design Patterns\n---\n\n\n\n{% note info%}\n\n变化是复用的天敌！ 面向对象设计最大的优势在于：<u>***抵御变化***</u>\n\n{% endnote %}\n\n\n\n#### 依赖倒置原则 (DIP)\n\n* 高层模块(稳定)不应该依赖于低层模块(变化)，二者都应该依赖于抽象(稳定) 。\n\n* 抽象(稳定)不应该依赖于实现细节(变化) ，实现细节应该依赖于抽象(稳定)。\n\n<br>\n\n#### 开放封闭原则 (OCP)\n\n* 对扩展开放，对更改封闭。\n\n* 类模块应该是可扩展的，但是不可修改。","slug":"Principle","published":1,"updated":"2020-08-06T07:26:55.389Z","_id":"ckdih3utt0000swufhyr93wu1","comments":1,"layout":"post","photos":[],"link":"","content":"<div class=\"note note-info\">\n            <p>变化是复用的天敌！ 面向对象设计最大的优势在于：<u><strong><em>抵御变化</em></strong></u></p>\n          </div>\n\n\n\n<h4 id=\"依赖倒置原则-DIP\"><a href=\"#依赖倒置原则-DIP\" class=\"headerlink\" title=\"依赖倒置原则 (DIP)\"></a>依赖倒置原则 (DIP)</h4><ul>\n<li><p>高层模块(稳定)不应该依赖于低层模块(变化)，二者都应该依赖于抽象(稳定) 。</p>\n</li>\n<li><p>抽象(稳定)不应该依赖于实现细节(变化) ，实现细节应该依赖于抽象(稳定)。</p>\n</li>\n</ul>\n<br>\n\n<h4 id=\"开放封闭原则-OCP\"><a href=\"#开放封闭原则-OCP\" class=\"headerlink\" title=\"开放封闭原则 (OCP)\"></a>开放封闭原则 (OCP)</h4><ul>\n<li><p>对扩展开放，对更改封闭。</p>\n</li>\n<li><p>类模块应该是可扩展的，但是不可修改。</p>\n</li>\n</ul>\n","site":{"data":{"fluid_config":{"favicon":"/img/favicon.png","apple_touch_icon":"/img/favicon.png","title_join_string":" - ","force_https":false,"highlight":{"enable":true,"style":"Atom One Dark","bg_color":true,"copy_btn":true},"fun_features":{"typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"mouse_click":{"enable":false,"style":"values"}},"color":{"body_bg_color":"#eee","navbar_bg_color":"black","navbar_text_color":"white","text_color":"#3c4858","sec_text_color":"#718096","post_text_color":"#2c3e50","post_heading_color":"#1a202c","link_color":"#3c4858","link_hover_color":"#1abc9c","link_hover_bg_color":"#f8f9fa","board_color":"#fff"},"font":{"font_size":"16px","font_family":null,"code_font_size":"85%"},"custom_js":null,"custom_css":null,"custom_html":"","web_analytics":{"enable":false,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"tajs":null,"woyaola":null,"cnzz":null,"leancloud":{"app_id":"6ojk1lVz9eq7GQnBo6Q8zR5d-gzGzoHsz","app_key":"bOrBPlujAz77Ma6N5tY9wWJN","server_url":null}},"lazyload":{"enable":true,"onlypost":false},"daovoice":{"enable":false,"appid":""},"aplayer":{"enable":false,"autoplay":false,"loop":"all","order":"random","theme":"#b7daff","songs":[{"name":"name","artist":"artist","url":"/songs/test.mp3","cover":"/img/cover.jpg"},{"name":"name","artist":"artist","url":"https://...url.mp3","cover":"https://...cover.jpg"}]},"version":{"check":false},"navbar":{"blog_title":"Explorer","ground_glass":{"enable":false,"px":3,"alpha":0.7},"menu":[{"key":"home","link":"/","icon":"iconfont icon-home-fill"},{"key":"archive","link":"/archives/","icon":"iconfont icon-archive-fill"},{"key":"category","link":"/categories/","icon":"iconfont icon-category-fill"},{"key":"tag","link":"/tags/","icon":"iconfont icon-tags-fill"},{"key":"about","link":"/about/","icon":"iconfont icon-user-fill"}]},"search":{"enable":true,"path":"/local-search.xml","generate_path":"/local-search.xml","field":"post","content":true},"scroll_down_arrow":{"enable":true,"banner_height_limit":90,"scroll_after_turning_page":true},"banner_parallax":true,"footer":{"statistics":{"enable":false,"source":"busuanzi","pv_format":"总访问量 {} 次","uv_format":"总访客数 {} 人"},"beian":{"enable":false,"icp_text":"京ICP证123456号","police_text":"京公网安备12345678号","police_code":12345678,"police_icon":"/img/police_beian.png"}},"scroll_top_arrow":{"enable":true},"index":{"banner_img":"/img/default.png","banner_img_height":100,"banner_mask_alpha":0.3,"post_default_img":"","slogan":{"enable":true,"text":"It&apos; s Us Make The World Different"},"auto_excerpt":{"enable":true},"post_url_target":"_self","post_meta":{"date":true,"category":true,"tag":true}},"page":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3},"post":{"banner_img":"/img/default.png","banner_img_height":70,"banner_mask_alpha":0.3,"meta":{"date":{"enable":true,"format":"LL a"},"wordcount":{"enable":true,"format":"{} 字"},"min2read":{"enable":true,"format":"{} 分钟","words":100},"views":{"enable":true,"source":"busuanzi","format":"{} 次"}},"updated":{"enable":false,"content":"本文最后更新于：","relative":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"copyright":{"enable":true,"content":"本博客所有文章除特别声明外，均采用 <a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.zh\" rel=\"nofollow noopener\">CC BY-SA 4.0 协议</a> ，转载请注明出处！"},"prev_next":{"enable":true},"custom":{"enable":false,"content":"<img src=\"https://octodex.github.com/images/jetpacktocat.png\" class=\"rounded mx-auto d-block mt-5\" style=\"width:150px; height:150px;\">"},"image_zoom":{"enable":true},"footnote":{"enable":true,"header":""},"math":{"enable":true,"specific":false,"engine":"mathjax"},"mermaid":{"enable":true,"specific":false,"options":{"theme":"default"}},"comments":{"enable":false,"type":"gitalk"}},"utterances":{"repo":null,"issue_term":null,"label":"utterances","theme":"github-light","crossorigin":"anonymous"},"disqus":{"shortname":null,"disqusjs":false,"apikey":null},"gitalk":{"clientID":"cde2629d6201340c948b","clientSecret":"621727333cc595103f634cf6deaba53bd8784fe6","repo":"blog-comments","owner":"miaochenlu","admin":null,"id":"location.pathname","language":"zh-CN","labels":"['Gitalk']","perPage":15,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true},"valine":{"appid":null,"appkey":null,"placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":null},"changyan":{"appid":"","appkey":""},"livere":{"uid":""},"archive":{"banner_img":"/img/achive.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null},"category":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"post_limit":10,"order_by":"-length"},"tag":{"banner_img":"/img/default.png","banner_img_height":80,"banner_mask_alpha":0.3,"subtitle":null,"tagcloud":{"min_font":15,"max_font":30,"unit":"px","start_color":"#BBBBEE","end_color":"#337ab7"}},"about":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"avatar":"/img/avatar.png","name":"Chenlu Miao","introduce":"李德胜永远滴神","icons":[{"class":"iconfont icon-github-fill","link":"https://github.com/miaochenlu","tip":"GitHub"},{"class":"iconfont icon-mail","link":"mailto:clmiao@zju.edu.cn","tip":"邮箱"}]},"page404":{"banner_img":"/img/default.png","banner_img_height":85,"banner_mask_alpha":0.3,"subtitle":"Page not found"},"links":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"items":[{"title":"Fluid Docs","intro":"主题使用指南","link":"https://hexo.fluid-dev.com/docs/","image":"/img/favicon.png"},{"title":"Fluid Repo","intro":"主题 GitHub 仓库","link":"https://github.com/fluid-dev/hexo-theme-fluid","image":"/img/favicon.png"},{"title":"Fluid Example","intro":"主题操作示例","link":"https://hexo.fluid-dev.com/docs/example/","image":"/img/favicon.png"}]}}}},"excerpt":"","more":"<div class=\"note note-info\">\n            <p>变化是复用的天敌！ 面向对象设计最大的优势在于：<u><strong><em>抵御变化</em></strong></u></p>\n          </div>\n\n\n\n<h4 id=\"依赖倒置原则-DIP\"><a href=\"#依赖倒置原则-DIP\" class=\"headerlink\" title=\"依赖倒置原则 (DIP)\"></a>依赖倒置原则 (DIP)</h4><ul>\n<li><p>高层模块(稳定)不应该依赖于低层模块(变化)，二者都应该依赖于抽象(稳定) 。</p>\n</li>\n<li><p>抽象(稳定)不应该依赖于实现细节(变化) ，实现细节应该依赖于抽象(稳定)。</p>\n</li>\n</ul>\n<br>\n\n<h4 id=\"开放封闭原则-OCP\"><a href=\"#开放封闭原则-OCP\" class=\"headerlink\" title=\"开放封闭原则 (OCP)\"></a>开放封闭原则 (OCP)</h4><ul>\n<li><p>对扩展开放，对更改封闭。</p>\n</li>\n<li><p>类模块应该是可扩展的，但是不可修改。</p>\n</li>\n</ul>\n"},{"title":"Decorator","date":"2020-08-07T06:15:57.000Z","index_img":"/img/image-20200807160507597.png","_content":"\n## 动机\n\n在某些情况下我们可能会\"过度地使用继承来扩展对象的功能\"， 由于继承为类型引入的**静态特质**，使得这种扩展方式缺乏灵活性； 并且随着子类的增多（扩展功能的增多），各种子类的组合（扩展功能的组合）会导致更多子类的膨胀。\n\n如何使\"对象功能的扩展\"能够根据需要来动态地实现？同时避免\"扩展功能的增多\"带来的子类膨胀问题？从而使得任何\"功能扩展变化\"所导致的影响将为最低？\n\n所谓静态特质, 比如在CryptoNetworkStream的Read函数中定死了调用NetworkStream::Read(), 而我们重构后的CryptoStream中的Read函数调用stream->Read(), 支持多态，可以产生变化。\n\n\n\n## 模式定义\n\n动态（组合）地给一个对象增加一些额外的职责。就增加功能而言，Decorator模式比生成子类（继承）更为灵活（消除重复代码 & 减少子类个数）。\n\n\n\n## 代码示例\n\n下面给出一个Stream代码示例，其继承关系如下所示\n\n<img src=\"image-20200807143722316.png\" alt=\"image-20200807143722316\" style=\"zoom:30%;\" />\n\n```cpp\n//业务操作\nclass Stream {\npublic:\n    virtual char Read(int number) = 0;\n    virtual void Seek(int position) = 0;\n    virtual void Write(char data) = 0;\n    \n    virtual ~Stream() {}\n};\n\n//主体类\nclass FileStream: public Stream {\npublic:\n    virtual char Read(int number) {\n        //读文件流\n\t}\n    \n    virtual void Seek(int position) {\n        //定位文件流\n    }\n    \n    virtual void Write(char data) {\n        //写文件流\n    }\n};\n\nclass NetworkStream: public Stream {\npublic:\n    virtual char Read(int number) {\n        //读网络流\n\t}\n    \n    virtual void Seek(int position) {\n        //定位网络流\n    }\n    \n    virtual void Write(char data) {\n        //写网络流\n    }\n};\n\nclass MemoryStream: public Stream {\npublic:\n    virtual char Read(int number) {\n        //读内存流\n\t}\n    \n    virtual void Seek(int position) {\n        //定位内存流\n    }\n    \n    virtual void Write(char data) {\n        //写内存流\n    }\n};\n\n//扩展操作\nclass CryptoFileStream: public FileStream {\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        FileStream::Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        FileStream::Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        FileStream::Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass CryptoNetworkStream: public NetworkStream {\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        NetworkStream::Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        NetworkStream::Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        NetworkStream::Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass CryptoMemoryStream: public MemoryStream {\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        MemoryStream::Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        MemoryStream::Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        MemoryStream::Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass BufferedFileStream: public FileStream {\n    //...\n};\n\nclass BufferedNetworkStream: public NetworkStream {\n    //...\n};\n\nclass BufferedMemoryStream: public MemoryStream {\n    //...\n};\n\nclass CryptoBufferedFileStream: public FileStream {\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        //额外的缓冲操作...\n        FileStream::Read(number);//读文件流\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        //额外的缓冲操作...\n        FileStream::Seek(position);//定位文件流\n        //额外的加密操作...\n        //额外的缓冲操作...\n    }\n    \n    virtual void Write(int position) {\n        //额外的加密操作...\n        //额外的缓冲操作...\n        FileStream::Write(position);//写文件流\n        //额外的加密操作...\n        //额外的缓冲操作...\n    }\n};\n\nvoid Process() {\n    //编译时装配\n    CryptoFileStream* fs1 = new CryptoFileStream();\n    \n    BufferedFileStream* fs2 = new BufferedFileStream();\n    \n    CryptoBufferedFileStream* fs3 = new CryptoBufferedFileStream();\n}\n```\n\n这样设计的代码存在大量的冗余，比如对于不同的stream, 无论是FileStream还是NetworkStream还是MemoryStream, 他们的加密操作都是一样的。\n\n\n\n* 重构\n\n```cpp\n//扩展操作\nclass CryptoFileStream {\n    FileStream* stream;//=new FileStream()\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass CryptoNetworkStream {\n    NetworkStream* stream;\t//=new NetworkStream();\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass CryptoMemoryStream {\n    MemoryStream* stream;\t//=new MemoryStream();\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n```\n\n* 继续重构\n\n```cpp\n//扩展操作\nclass CryptoStream: public Stream {\n    Stream* stream;//...\npublic:\n    CryptoStream(Stream* stm): stream(stm) {\n        \n    }\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass BufferedStream: public Stream {\n    Stream* stream; //...\n    //...\n};\n\nvoid Process() {\n    //运行时装配\n    FileStream* s1 = new FileStream();\n    CryptoStream* s2 = new CryptoStream(s1);\n    BufferedStream* s3 = new BufferedStream(s1);\n    BufferedStream* s4 = new BufferedStream(s2);\n}\n```\n\n很神奇，CryptoStream既有Stream基类，也有Stream字段。这里还需要继承Stream是因为他定义了基类的接口规范\n\n\n\n* 继续重构\n\nCryptoStream, BufferedStream都有Stream这个字段，把他们提到一个中间类中，\n\n设置一个DecoratorStream中间类\n\n```cpp\n//扩展操作\nclass DecoratorStream: public Stream {\nprotected:\n    Stream* stream; //...\n    DecoratorStream(Stream* stm): DecoratorStream(stm) {\n        \n    }\n}\nclass CryptoStream: public DecoratorStream {\npublic:\n    CryptoStream(Stream* stm): DecoratorStream(stm) {}\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass BufferedStream: public DecoratorStream {\n    //...\n};\n\nvoid Process() {\n    //运行时装配\n    FileStream* s1 = new FileStream();\n    CryptoStream* s2 = new CryptoStream(s1);\n    BufferedStream* s3 = new BufferedStream(s1);\n    BufferedStream* s4 = new BufferedStream(s2);\n}\n```\n\n新的类关系\n\n<img src=\"image-20200807143823919.png\" alt=\"image-20200807143823919\" style=\"zoom:30%;\" />\n\n\n\n## 结构\n\n<img src=\"image-20200807160507597.png\" alt=\"image-20200807160507597\" style=\"zoom:50%;\" />\n\n\n\n## 总结\n\n* 通过采用组合而非继承的手法， Decorator模式实现了在运行时动态扩展对象功能的能力，而且可以根据需要扩展多个功能。避免 了使用继承带来的\"灵活性差\"和\"多子类衍生问题\"。\n\n* Decorator类在接口上表现为is-a Component的继承关系，即Decorator类继承了Component类所具有的接口。但在实现上又 表现为has-a Component的组合关系，即Decorator类又使用了 另外一个Component类。\n\n* Decorator模式的目的并非解决\"多子类衍生的多继承\"问题，Decorator模式应用的要点在于解决\"主体类在多个方向上的扩展 功能\"——是为\"装饰\"的含义。\n\n## Decorator属于单一职责模式\n\n在软件组件的设计中，如果责任划分的不清晰，使用继承得到的结果往往是随着需求的变化，子类急剧膨胀，同时充斥着重复代码， 这时候的关键是划清责任。\n\n* 典型模式\n\n  • Decorator\n\n  • Bridge","source":"_posts/Decorator.md","raw":"---\ntitle: Decorator\ndate: 2020-08-07 14:15:57\nindex_img: /img/image-20200807160507597.png\ntags: Design Patterns\ncategories: Design Patterns\n---\n\n## 动机\n\n在某些情况下我们可能会\"过度地使用继承来扩展对象的功能\"， 由于继承为类型引入的**静态特质**，使得这种扩展方式缺乏灵活性； 并且随着子类的增多（扩展功能的增多），各种子类的组合（扩展功能的组合）会导致更多子类的膨胀。\n\n如何使\"对象功能的扩展\"能够根据需要来动态地实现？同时避免\"扩展功能的增多\"带来的子类膨胀问题？从而使得任何\"功能扩展变化\"所导致的影响将为最低？\n\n所谓静态特质, 比如在CryptoNetworkStream的Read函数中定死了调用NetworkStream::Read(), 而我们重构后的CryptoStream中的Read函数调用stream->Read(), 支持多态，可以产生变化。\n\n\n\n## 模式定义\n\n动态（组合）地给一个对象增加一些额外的职责。就增加功能而言，Decorator模式比生成子类（继承）更为灵活（消除重复代码 & 减少子类个数）。\n\n\n\n## 代码示例\n\n下面给出一个Stream代码示例，其继承关系如下所示\n\n<img src=\"image-20200807143722316.png\" alt=\"image-20200807143722316\" style=\"zoom:30%;\" />\n\n```cpp\n//业务操作\nclass Stream {\npublic:\n    virtual char Read(int number) = 0;\n    virtual void Seek(int position) = 0;\n    virtual void Write(char data) = 0;\n    \n    virtual ~Stream() {}\n};\n\n//主体类\nclass FileStream: public Stream {\npublic:\n    virtual char Read(int number) {\n        //读文件流\n\t}\n    \n    virtual void Seek(int position) {\n        //定位文件流\n    }\n    \n    virtual void Write(char data) {\n        //写文件流\n    }\n};\n\nclass NetworkStream: public Stream {\npublic:\n    virtual char Read(int number) {\n        //读网络流\n\t}\n    \n    virtual void Seek(int position) {\n        //定位网络流\n    }\n    \n    virtual void Write(char data) {\n        //写网络流\n    }\n};\n\nclass MemoryStream: public Stream {\npublic:\n    virtual char Read(int number) {\n        //读内存流\n\t}\n    \n    virtual void Seek(int position) {\n        //定位内存流\n    }\n    \n    virtual void Write(char data) {\n        //写内存流\n    }\n};\n\n//扩展操作\nclass CryptoFileStream: public FileStream {\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        FileStream::Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        FileStream::Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        FileStream::Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass CryptoNetworkStream: public NetworkStream {\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        NetworkStream::Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        NetworkStream::Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        NetworkStream::Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass CryptoMemoryStream: public MemoryStream {\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        MemoryStream::Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        MemoryStream::Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        MemoryStream::Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass BufferedFileStream: public FileStream {\n    //...\n};\n\nclass BufferedNetworkStream: public NetworkStream {\n    //...\n};\n\nclass BufferedMemoryStream: public MemoryStream {\n    //...\n};\n\nclass CryptoBufferedFileStream: public FileStream {\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        //额外的缓冲操作...\n        FileStream::Read(number);//读文件流\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        //额外的缓冲操作...\n        FileStream::Seek(position);//定位文件流\n        //额外的加密操作...\n        //额外的缓冲操作...\n    }\n    \n    virtual void Write(int position) {\n        //额外的加密操作...\n        //额外的缓冲操作...\n        FileStream::Write(position);//写文件流\n        //额外的加密操作...\n        //额外的缓冲操作...\n    }\n};\n\nvoid Process() {\n    //编译时装配\n    CryptoFileStream* fs1 = new CryptoFileStream();\n    \n    BufferedFileStream* fs2 = new BufferedFileStream();\n    \n    CryptoBufferedFileStream* fs3 = new CryptoBufferedFileStream();\n}\n```\n\n这样设计的代码存在大量的冗余，比如对于不同的stream, 无论是FileStream还是NetworkStream还是MemoryStream, 他们的加密操作都是一样的。\n\n\n\n* 重构\n\n```cpp\n//扩展操作\nclass CryptoFileStream {\n    FileStream* stream;//=new FileStream()\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass CryptoNetworkStream {\n    NetworkStream* stream;\t//=new NetworkStream();\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass CryptoMemoryStream {\n    MemoryStream* stream;\t//=new MemoryStream();\npublic:\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n```\n\n* 继续重构\n\n```cpp\n//扩展操作\nclass CryptoStream: public Stream {\n    Stream* stream;//...\npublic:\n    CryptoStream(Stream* stm): stream(stm) {\n        \n    }\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass BufferedStream: public Stream {\n    Stream* stream; //...\n    //...\n};\n\nvoid Process() {\n    //运行时装配\n    FileStream* s1 = new FileStream();\n    CryptoStream* s2 = new CryptoStream(s1);\n    BufferedStream* s3 = new BufferedStream(s1);\n    BufferedStream* s4 = new BufferedStream(s2);\n}\n```\n\n很神奇，CryptoStream既有Stream基类，也有Stream字段。这里还需要继承Stream是因为他定义了基类的接口规范\n\n\n\n* 继续重构\n\nCryptoStream, BufferedStream都有Stream这个字段，把他们提到一个中间类中，\n\n设置一个DecoratorStream中间类\n\n```cpp\n//扩展操作\nclass DecoratorStream: public Stream {\nprotected:\n    Stream* stream; //...\n    DecoratorStream(Stream* stm): DecoratorStream(stm) {\n        \n    }\n}\nclass CryptoStream: public DecoratorStream {\npublic:\n    CryptoStream(Stream* stm): DecoratorStream(stm) {}\n    virtual char Read(int number) {\n        //额外的加密操作...\n        stream->Read(number);\n    }\n    \n    virtual void Seek(int position) {\n        //额外的加密操作...\n        stream->Seek(position);\n        //额外的加密操作\n    }\n    \n    virtual void Write(byte data) {\n        //额外的加密操作...\n        stream->Write(data);\n        //额外的加密操作...\n    }\n};\n\nclass BufferedStream: public DecoratorStream {\n    //...\n};\n\nvoid Process() {\n    //运行时装配\n    FileStream* s1 = new FileStream();\n    CryptoStream* s2 = new CryptoStream(s1);\n    BufferedStream* s3 = new BufferedStream(s1);\n    BufferedStream* s4 = new BufferedStream(s2);\n}\n```\n\n新的类关系\n\n<img src=\"image-20200807143823919.png\" alt=\"image-20200807143823919\" style=\"zoom:30%;\" />\n\n\n\n## 结构\n\n<img src=\"image-20200807160507597.png\" alt=\"image-20200807160507597\" style=\"zoom:50%;\" />\n\n\n\n## 总结\n\n* 通过采用组合而非继承的手法， Decorator模式实现了在运行时动态扩展对象功能的能力，而且可以根据需要扩展多个功能。避免 了使用继承带来的\"灵活性差\"和\"多子类衍生问题\"。\n\n* Decorator类在接口上表现为is-a Component的继承关系，即Decorator类继承了Component类所具有的接口。但在实现上又 表现为has-a Component的组合关系，即Decorator类又使用了 另外一个Component类。\n\n* Decorator模式的目的并非解决\"多子类衍生的多继承\"问题，Decorator模式应用的要点在于解决\"主体类在多个方向上的扩展 功能\"——是为\"装饰\"的含义。\n\n## Decorator属于单一职责模式\n\n在软件组件的设计中，如果责任划分的不清晰，使用继承得到的结果往往是随着需求的变化，子类急剧膨胀，同时充斥着重复代码， 这时候的关键是划清责任。\n\n* 典型模式\n\n  • Decorator\n\n  • Bridge","slug":"Decorator","published":1,"updated":"2020-08-07T08:13:58.950Z","_id":"ckdjycntp0000iuufex6h2zsd","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><p>在某些情况下我们可能会”过度地使用继承来扩展对象的功能”， 由于继承为类型引入的<strong>静态特质</strong>，使得这种扩展方式缺乏灵活性； 并且随着子类的增多（扩展功能的增多），各种子类的组合（扩展功能的组合）会导致更多子类的膨胀。</p>\n<p>如何使”对象功能的扩展”能够根据需要来动态地实现？同时避免”扩展功能的增多”带来的子类膨胀问题？从而使得任何”功能扩展变化”所导致的影响将为最低？</p>\n<p>所谓静态特质, 比如在CryptoNetworkStream的Read函数中定死了调用NetworkStream::Read(), 而我们重构后的CryptoStream中的Read函数调用stream-&gt;Read(), 支持多态，可以产生变化。</p>\n<h2 id=\"模式定义\"><a href=\"#模式定义\" class=\"headerlink\" title=\"模式定义\"></a>模式定义</h2><p>动态（组合）地给一个对象增加一些额外的职责。就增加功能而言，Decorator模式比生成子类（继承）更为灵活（消除重复代码 &amp; 减少子类个数）。</p>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>下面给出一个Stream代码示例，其继承关系如下所示</p>\n<img src=\"image-20200807143722316.png\" srcset=\"/img/loading.gif\" alt=\"image-20200807143722316\" style=\"zoom:30%;\" />\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//业务操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Stream</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">char</span> data)</span> </span>= <span class=\"hljs-number\">0</span>;\n    \n    <span class=\"hljs-keyword\">virtual</span> ~Stream() &#123;&#125;\n&#125;;\n\n<span class=\"hljs-comment\">//主体类</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//读文件流</span>\n\t&#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//定位文件流</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">char</span> data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//写文件流</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">NetworkStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//读网络流</span>\n\t&#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//定位网络流</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">char</span> data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//写网络流</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MemoryStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//读内存流</span>\n\t&#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//定位内存流</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">char</span> data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//写内存流</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-comment\">//扩展操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoFileStream</span>:</span> <span class=\"hljs-keyword\">public</span> FileStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        FileStream::Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        FileStream::Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        FileStream::Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoNetworkStream</span>:</span> <span class=\"hljs-keyword\">public</span> NetworkStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        NetworkStream::Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        NetworkStream::Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        NetworkStream::Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoMemoryStream</span>:</span> <span class=\"hljs-keyword\">public</span> MemoryStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        MemoryStream::Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        MemoryStream::Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        MemoryStream::Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedFileStream</span>:</span> <span class=\"hljs-keyword\">public</span> FileStream &#123;\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedNetworkStream</span>:</span> <span class=\"hljs-keyword\">public</span> NetworkStream &#123;\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedMemoryStream</span>:</span> <span class=\"hljs-keyword\">public</span> MemoryStream &#123;\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoBufferedFileStream</span>:</span> <span class=\"hljs-keyword\">public</span> FileStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n        FileStream::Read(number);<span class=\"hljs-comment\">//读文件流</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n        FileStream::Seek(position);<span class=\"hljs-comment\">//定位文件流</span>\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n        FileStream::Write(position);<span class=\"hljs-comment\">//写文件流</span>\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Process</span><span class=\"hljs-params\">()</span> </span>&#123;\n    <span class=\"hljs-comment\">//编译时装配</span>\n    CryptoFileStream* fs1 = <span class=\"hljs-keyword\">new</span> CryptoFileStream();\n    \n    BufferedFileStream* fs2 = <span class=\"hljs-keyword\">new</span> BufferedFileStream();\n    \n    CryptoBufferedFileStream* fs3 = <span class=\"hljs-keyword\">new</span> CryptoBufferedFileStream();\n&#125;</code></pre></div>\n\n<p>这样设计的代码存在大量的冗余，比如对于不同的stream, 无论是FileStream还是NetworkStream还是MemoryStream, 他们的加密操作都是一样的。</p>\n<ul>\n<li>重构</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//扩展操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoFileStream</span> &#123;</span>\n    FileStream* stream;<span class=\"hljs-comment\">//=new FileStream()</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoNetworkStream</span> &#123;</span>\n    NetworkStream* stream;\t<span class=\"hljs-comment\">//=new NetworkStream();</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoMemoryStream</span> &#123;</span>\n    MemoryStream* stream;\t<span class=\"hljs-comment\">//=new MemoryStream();</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;</code></pre></div>\n\n<ul>\n<li>继续重构</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//扩展操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n    Stream* stream;<span class=\"hljs-comment\">//...</span>\n<span class=\"hljs-keyword\">public</span>:\n    CryptoStream(Stream* stm): stream(stm) &#123;\n        \n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n    Stream* stream; <span class=\"hljs-comment\">//...</span>\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Process</span><span class=\"hljs-params\">()</span> </span>&#123;\n    <span class=\"hljs-comment\">//运行时装配</span>\n    FileStream* s1 = <span class=\"hljs-keyword\">new</span> FileStream();\n    CryptoStream* s2 = <span class=\"hljs-keyword\">new</span> CryptoStream(s1);\n    BufferedStream* s3 = <span class=\"hljs-keyword\">new</span> BufferedStream(s1);\n    BufferedStream* s4 = <span class=\"hljs-keyword\">new</span> BufferedStream(s2);\n&#125;</code></pre></div>\n\n<p>很神奇，CryptoStream既有Stream基类，也有Stream字段。这里还需要继承Stream是因为他定义了基类的接口规范</p>\n<ul>\n<li>继续重构</li>\n</ul>\n<p>CryptoStream, BufferedStream都有Stream这个字段，把他们提到一个中间类中，</p>\n<p>设置一个DecoratorStream中间类</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//扩展操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DecoratorStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n<span class=\"hljs-keyword\">protected</span>:\n    Stream* stream; <span class=\"hljs-comment\">//...</span>\n    DecoratorStream(Stream* stm): DecoratorStream(stm) &#123;\n        \n    &#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoStream</span>:</span> <span class=\"hljs-keyword\">public</span> DecoratorStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    CryptoStream(Stream* stm): DecoratorStream(stm) &#123;&#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedStream</span>:</span> <span class=\"hljs-keyword\">public</span> DecoratorStream &#123;\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Process</span><span class=\"hljs-params\">()</span> </span>&#123;\n    <span class=\"hljs-comment\">//运行时装配</span>\n    FileStream* s1 = <span class=\"hljs-keyword\">new</span> FileStream();\n    CryptoStream* s2 = <span class=\"hljs-keyword\">new</span> CryptoStream(s1);\n    BufferedStream* s3 = <span class=\"hljs-keyword\">new</span> BufferedStream(s1);\n    BufferedStream* s4 = <span class=\"hljs-keyword\">new</span> BufferedStream(s2);\n&#125;</code></pre></div>\n\n<p>新的类关系</p>\n<img src=\"image-20200807143823919.png\" srcset=\"/img/loading.gif\" alt=\"image-20200807143823919\" style=\"zoom:30%;\" />\n\n\n\n<h2 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h2><img src=\"image-20200807160507597.png\" srcset=\"/img/loading.gif\" alt=\"image-20200807160507597\" style=\"zoom:50%;\" />\n\n\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li><p>通过采用组合而非继承的手法， Decorator模式实现了在运行时动态扩展对象功能的能力，而且可以根据需要扩展多个功能。避免 了使用继承带来的”灵活性差”和”多子类衍生问题”。</p>\n</li>\n<li><p>Decorator类在接口上表现为is-a Component的继承关系，即Decorator类继承了Component类所具有的接口。但在实现上又 表现为has-a Component的组合关系，即Decorator类又使用了 另外一个Component类。</p>\n</li>\n<li><p>Decorator模式的目的并非解决”多子类衍生的多继承”问题，Decorator模式应用的要点在于解决”主体类在多个方向上的扩展 功能”——是为”装饰”的含义。</p>\n</li>\n</ul>\n<h2 id=\"Decorator属于单一职责模式\"><a href=\"#Decorator属于单一职责模式\" class=\"headerlink\" title=\"Decorator属于单一职责模式\"></a>Decorator属于单一职责模式</h2><p>在软件组件的设计中，如果责任划分的不清晰，使用继承得到的结果往往是随着需求的变化，子类急剧膨胀，同时充斥着重复代码， 这时候的关键是划清责任。</p>\n<ul>\n<li><p>典型模式</p>\n<p>• Decorator</p>\n<p>• Bridge</p>\n</li>\n</ul>\n","site":{"data":{"fluid_config":{"favicon":"/img/favicon.png","apple_touch_icon":"/img/favicon.png","title_join_string":" - ","force_https":false,"highlight":{"enable":true,"style":"Atom One Dark","bg_color":true,"copy_btn":true},"fun_features":{"typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"mouse_click":{"enable":false,"style":"values"}},"color":{"body_bg_color":"#eee","navbar_bg_color":"black","navbar_text_color":"white","text_color":"#3c4858","sec_text_color":"#718096","post_text_color":"#2c3e50","post_heading_color":"#1a202c","link_color":"#3c4858","link_hover_color":"#1abc9c","link_hover_bg_color":"#f8f9fa","board_color":"#fff"},"font":{"font_size":"16px","font_family":null,"code_font_size":"85%"},"custom_js":null,"custom_css":null,"custom_html":"","web_analytics":{"enable":false,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"tajs":null,"woyaola":null,"cnzz":null,"leancloud":{"app_id":"6ojk1lVz9eq7GQnBo6Q8zR5d-gzGzoHsz","app_key":"bOrBPlujAz77Ma6N5tY9wWJN","server_url":null}},"lazyload":{"enable":true,"onlypost":false},"daovoice":{"enable":false,"appid":""},"aplayer":{"enable":false,"autoplay":false,"loop":"all","order":"random","theme":"#b7daff","songs":[{"name":"name","artist":"artist","url":"/songs/test.mp3","cover":"/img/cover.jpg"},{"name":"name","artist":"artist","url":"https://...url.mp3","cover":"https://...cover.jpg"}]},"version":{"check":false},"navbar":{"blog_title":"Explorer","ground_glass":{"enable":false,"px":3,"alpha":0.7},"menu":[{"key":"home","link":"/","icon":"iconfont icon-home-fill"},{"key":"archive","link":"/archives/","icon":"iconfont icon-archive-fill"},{"key":"category","link":"/categories/","icon":"iconfont icon-category-fill"},{"key":"tag","link":"/tags/","icon":"iconfont icon-tags-fill"},{"key":"about","link":"/about/","icon":"iconfont icon-user-fill"}]},"search":{"enable":true,"path":"/local-search.xml","generate_path":"/local-search.xml","field":"post","content":true},"scroll_down_arrow":{"enable":true,"banner_height_limit":90,"scroll_after_turning_page":true},"banner_parallax":true,"footer":{"statistics":{"enable":false,"source":"busuanzi","pv_format":"总访问量 {} 次","uv_format":"总访客数 {} 人"},"beian":{"enable":false,"icp_text":"京ICP证123456号","police_text":"京公网安备12345678号","police_code":12345678,"police_icon":"/img/police_beian.png"}},"scroll_top_arrow":{"enable":true},"index":{"banner_img":"/img/default.png","banner_img_height":100,"banner_mask_alpha":0.3,"post_default_img":"","slogan":{"enable":true,"text":"It&apos; s Us Make The World Different"},"auto_excerpt":{"enable":true},"post_url_target":"_self","post_meta":{"date":true,"category":true,"tag":true}},"page":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3},"post":{"banner_img":"/img/default.png","banner_img_height":70,"banner_mask_alpha":0.3,"meta":{"date":{"enable":true,"format":"LL a"},"wordcount":{"enable":true,"format":"{} 字"},"min2read":{"enable":true,"format":"{} 分钟","words":100},"views":{"enable":true,"source":"busuanzi","format":"{} 次"}},"updated":{"enable":false,"content":"本文最后更新于：","relative":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"copyright":{"enable":true,"content":"本博客所有文章除特别声明外，均采用 <a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.zh\" rel=\"nofollow noopener\">CC BY-SA 4.0 协议</a> ，转载请注明出处！"},"prev_next":{"enable":true},"custom":{"enable":false,"content":"<img src=\"https://octodex.github.com/images/jetpacktocat.png\" class=\"rounded mx-auto d-block mt-5\" style=\"width:150px; height:150px;\">"},"image_zoom":{"enable":true},"footnote":{"enable":true,"header":""},"math":{"enable":true,"specific":false,"engine":"mathjax"},"mermaid":{"enable":true,"specific":false,"options":{"theme":"default"}},"comments":{"enable":false,"type":"gitalk"}},"utterances":{"repo":null,"issue_term":null,"label":"utterances","theme":"github-light","crossorigin":"anonymous"},"disqus":{"shortname":null,"disqusjs":false,"apikey":null},"gitalk":{"clientID":"cde2629d6201340c948b","clientSecret":"621727333cc595103f634cf6deaba53bd8784fe6","repo":"blog-comments","owner":"miaochenlu","admin":null,"id":"location.pathname","language":"zh-CN","labels":"['Gitalk']","perPage":15,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true},"valine":{"appid":null,"appkey":null,"placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":null},"changyan":{"appid":"","appkey":""},"livere":{"uid":""},"archive":{"banner_img":"/img/achive.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null},"category":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"post_limit":10,"order_by":"-length"},"tag":{"banner_img":"/img/default.png","banner_img_height":80,"banner_mask_alpha":0.3,"subtitle":null,"tagcloud":{"min_font":15,"max_font":30,"unit":"px","start_color":"#BBBBEE","end_color":"#337ab7"}},"about":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"avatar":"/img/avatar.png","name":"Chenlu Miao","introduce":"李德胜永远滴神","icons":[{"class":"iconfont icon-github-fill","link":"https://github.com/miaochenlu","tip":"GitHub"},{"class":"iconfont icon-mail","link":"mailto:clmiao@zju.edu.cn","tip":"邮箱"}]},"page404":{"banner_img":"/img/default.png","banner_img_height":85,"banner_mask_alpha":0.3,"subtitle":"Page not found"},"links":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"items":[{"title":"Fluid Docs","intro":"主题使用指南","link":"https://hexo.fluid-dev.com/docs/","image":"/img/favicon.png"},{"title":"Fluid Repo","intro":"主题 GitHub 仓库","link":"https://github.com/fluid-dev/hexo-theme-fluid","image":"/img/favicon.png"},{"title":"Fluid Example","intro":"主题操作示例","link":"https://hexo.fluid-dev.com/docs/example/","image":"/img/favicon.png"}]}}}},"excerpt":"","more":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><p>在某些情况下我们可能会”过度地使用继承来扩展对象的功能”， 由于继承为类型引入的<strong>静态特质</strong>，使得这种扩展方式缺乏灵活性； 并且随着子类的增多（扩展功能的增多），各种子类的组合（扩展功能的组合）会导致更多子类的膨胀。</p>\n<p>如何使”对象功能的扩展”能够根据需要来动态地实现？同时避免”扩展功能的增多”带来的子类膨胀问题？从而使得任何”功能扩展变化”所导致的影响将为最低？</p>\n<p>所谓静态特质, 比如在CryptoNetworkStream的Read函数中定死了调用NetworkStream::Read(), 而我们重构后的CryptoStream中的Read函数调用stream-&gt;Read(), 支持多态，可以产生变化。</p>\n<h2 id=\"模式定义\"><a href=\"#模式定义\" class=\"headerlink\" title=\"模式定义\"></a>模式定义</h2><p>动态（组合）地给一个对象增加一些额外的职责。就增加功能而言，Decorator模式比生成子类（继承）更为灵活（消除重复代码 &amp; 减少子类个数）。</p>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>下面给出一个Stream代码示例，其继承关系如下所示</p>\n<img src=\"image-20200807143722316.png\" srcset=\"/img/loading.gif\" alt=\"image-20200807143722316\" style=\"zoom:30%;\" />\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//业务操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Stream</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">char</span> data)</span> </span>= <span class=\"hljs-number\">0</span>;\n    \n    <span class=\"hljs-keyword\">virtual</span> ~Stream() &#123;&#125;\n&#125;;\n\n<span class=\"hljs-comment\">//主体类</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//读文件流</span>\n\t&#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//定位文件流</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">char</span> data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//写文件流</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">NetworkStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//读网络流</span>\n\t&#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//定位网络流</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">char</span> data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//写网络流</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MemoryStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//读内存流</span>\n\t&#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//定位内存流</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">char</span> data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//写内存流</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-comment\">//扩展操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoFileStream</span>:</span> <span class=\"hljs-keyword\">public</span> FileStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        FileStream::Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        FileStream::Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        FileStream::Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoNetworkStream</span>:</span> <span class=\"hljs-keyword\">public</span> NetworkStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        NetworkStream::Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        NetworkStream::Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        NetworkStream::Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoMemoryStream</span>:</span> <span class=\"hljs-keyword\">public</span> MemoryStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        MemoryStream::Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        MemoryStream::Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        MemoryStream::Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedFileStream</span>:</span> <span class=\"hljs-keyword\">public</span> FileStream &#123;\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedNetworkStream</span>:</span> <span class=\"hljs-keyword\">public</span> NetworkStream &#123;\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedMemoryStream</span>:</span> <span class=\"hljs-keyword\">public</span> MemoryStream &#123;\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoBufferedFileStream</span>:</span> <span class=\"hljs-keyword\">public</span> FileStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n        FileStream::Read(number);<span class=\"hljs-comment\">//读文件流</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n        FileStream::Seek(position);<span class=\"hljs-comment\">//定位文件流</span>\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n        FileStream::Write(position);<span class=\"hljs-comment\">//写文件流</span>\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        <span class=\"hljs-comment\">//额外的缓冲操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Process</span><span class=\"hljs-params\">()</span> </span>&#123;\n    <span class=\"hljs-comment\">//编译时装配</span>\n    CryptoFileStream* fs1 = <span class=\"hljs-keyword\">new</span> CryptoFileStream();\n    \n    BufferedFileStream* fs2 = <span class=\"hljs-keyword\">new</span> BufferedFileStream();\n    \n    CryptoBufferedFileStream* fs3 = <span class=\"hljs-keyword\">new</span> CryptoBufferedFileStream();\n&#125;</code></pre></div>\n\n<p>这样设计的代码存在大量的冗余，比如对于不同的stream, 无论是FileStream还是NetworkStream还是MemoryStream, 他们的加密操作都是一样的。</p>\n<ul>\n<li>重构</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//扩展操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoFileStream</span> &#123;</span>\n    FileStream* stream;<span class=\"hljs-comment\">//=new FileStream()</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoNetworkStream</span> &#123;</span>\n    NetworkStream* stream;\t<span class=\"hljs-comment\">//=new NetworkStream();</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoMemoryStream</span> &#123;</span>\n    MemoryStream* stream;\t<span class=\"hljs-comment\">//=new MemoryStream();</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;</code></pre></div>\n\n<ul>\n<li>继续重构</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//扩展操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n    Stream* stream;<span class=\"hljs-comment\">//...</span>\n<span class=\"hljs-keyword\">public</span>:\n    CryptoStream(Stream* stm): stream(stm) &#123;\n        \n    &#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n    Stream* stream; <span class=\"hljs-comment\">//...</span>\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Process</span><span class=\"hljs-params\">()</span> </span>&#123;\n    <span class=\"hljs-comment\">//运行时装配</span>\n    FileStream* s1 = <span class=\"hljs-keyword\">new</span> FileStream();\n    CryptoStream* s2 = <span class=\"hljs-keyword\">new</span> CryptoStream(s1);\n    BufferedStream* s3 = <span class=\"hljs-keyword\">new</span> BufferedStream(s1);\n    BufferedStream* s4 = <span class=\"hljs-keyword\">new</span> BufferedStream(s2);\n&#125;</code></pre></div>\n\n<p>很神奇，CryptoStream既有Stream基类，也有Stream字段。这里还需要继承Stream是因为他定义了基类的接口规范</p>\n<ul>\n<li>继续重构</li>\n</ul>\n<p>CryptoStream, BufferedStream都有Stream这个字段，把他们提到一个中间类中，</p>\n<p>设置一个DecoratorStream中间类</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">//扩展操作</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DecoratorStream</span>:</span> <span class=\"hljs-keyword\">public</span> Stream &#123;\n<span class=\"hljs-keyword\">protected</span>:\n    Stream* stream; <span class=\"hljs-comment\">//...</span>\n    DecoratorStream(Stream* stm): DecoratorStream(stm) &#123;\n        \n    &#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CryptoStream</span>:</span> <span class=\"hljs-keyword\">public</span> DecoratorStream &#123;\n<span class=\"hljs-keyword\">public</span>:\n    CryptoStream(Stream* stm): DecoratorStream(stm) &#123;&#125;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">char</span> <span class=\"hljs-title\">Read</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> number)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Read(number);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Seek</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> position)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Seek(position);\n        <span class=\"hljs-comment\">//额外的加密操作</span>\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Write</span><span class=\"hljs-params\">(byte data)</span> </span>&#123;\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n        stream-&gt;Write(data);\n        <span class=\"hljs-comment\">//额外的加密操作...</span>\n    &#125;\n&#125;;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BufferedStream</span>:</span> <span class=\"hljs-keyword\">public</span> DecoratorStream &#123;\n    <span class=\"hljs-comment\">//...</span>\n&#125;;\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Process</span><span class=\"hljs-params\">()</span> </span>&#123;\n    <span class=\"hljs-comment\">//运行时装配</span>\n    FileStream* s1 = <span class=\"hljs-keyword\">new</span> FileStream();\n    CryptoStream* s2 = <span class=\"hljs-keyword\">new</span> CryptoStream(s1);\n    BufferedStream* s3 = <span class=\"hljs-keyword\">new</span> BufferedStream(s1);\n    BufferedStream* s4 = <span class=\"hljs-keyword\">new</span> BufferedStream(s2);\n&#125;</code></pre></div>\n\n<p>新的类关系</p>\n<img src=\"image-20200807143823919.png\" srcset=\"/img/loading.gif\" alt=\"image-20200807143823919\" style=\"zoom:30%;\" />\n\n\n\n<h2 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h2><img src=\"image-20200807160507597.png\" srcset=\"/img/loading.gif\" alt=\"image-20200807160507597\" style=\"zoom:50%;\" />\n\n\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li><p>通过采用组合而非继承的手法， Decorator模式实现了在运行时动态扩展对象功能的能力，而且可以根据需要扩展多个功能。避免 了使用继承带来的”灵活性差”和”多子类衍生问题”。</p>\n</li>\n<li><p>Decorator类在接口上表现为is-a Component的继承关系，即Decorator类继承了Component类所具有的接口。但在实现上又 表现为has-a Component的组合关系，即Decorator类又使用了 另外一个Component类。</p>\n</li>\n<li><p>Decorator模式的目的并非解决”多子类衍生的多继承”问题，Decorator模式应用的要点在于解决”主体类在多个方向上的扩展 功能”——是为”装饰”的含义。</p>\n</li>\n</ul>\n<h2 id=\"Decorator属于单一职责模式\"><a href=\"#Decorator属于单一职责模式\" class=\"headerlink\" title=\"Decorator属于单一职责模式\"></a>Decorator属于单一职责模式</h2><p>在软件组件的设计中，如果责任划分的不清晰，使用继承得到的结果往往是随着需求的变化，子类急剧膨胀，同时充斥着重复代码， 这时候的关键是划清责任。</p>\n<ul>\n<li><p>典型模式</p>\n<p>• Decorator</p>\n<p>• Bridge</p>\n</li>\n</ul>\n"},{"title":"Observer 观察者模式","date":"2020-08-06T06:22:25.000Z","index_img":"/img/image-20200806160700160.png","_content":"\n\n\n## 动机\n\n在软件构建过程中，我们需要为某些对象建立一种\"通知依赖关系\" \n\n<u>一个对象（目标对象）的状态发生改变，所有的依赖对象（观察者对象）都将得到通知。如果这样的依赖关系过于紧密， 将使软件不能很好地抵御变化</u>。\n\n使用面向对象技术，可以将这种依赖关系弱化，并形成一种稳定的依赖关系。从而实现软件体系结构的松耦合。\n\n\n\n## 模式定义\n\n定义对象间的一种<u>***一对多***</u>（变化）的依赖关系，以便当一个 对象(Subject)的状态发生改变时，所有依赖于它的对象都得到通知并<u>***自动更新***</u>。\n\n\n\n## 代码示例\n\n考虑一个文件分割器程序，将一个大文件分割成几个小文件。\n\n我们有一个主界面MainForm (在这里是一个观察者), 里面有两个对象，一个是文件路径，一个是分割成的文件都个数。当button click时就会调用filesplitter将文件分割\n\n代码如下\n\n```cpp\nclass MainForm: public Form {\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\npublic:\n    void Button1_Click() {\n        string filePath = txtFilePath->getText();\n        int number = atoi(txtFileNumber->getText().c_str());\n        \n        FileSplitter splitter(filePath, number);\n        splitter.split();\n    }\n}\n```\n\n```cpp\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\npublic:\n    FileSplitter(const strign& filePath, int fileNumber):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) {\n            \n    }\n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n        }\n    }\n}\n```\n\n\n\n#### 需求1：文件分割进度条\n\n* 第一种实现方式\n\n```cpp\nclass MainForm: public Form {\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n/***增加progress bar***/\n    ProgressBar* progressBar;\npublic:\n    void Button1_Click() {\n        string filePath = txtFilePath->getText();\n        int number = atoi(txtFileNumber->getText().c_str());\n        \n        FileSplitter splitter(filePath, number);\n        splitter.split();\n    }\n}\n```\n\n\n\n```cpp\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\n/***增加progres bar***/\n    ProgressBar* m_progressBar;\npublic:\n/***增加初始化参数***/\n    FileSplitter(const strign& filePath, int fileNumber, ProgressBar* progressBar):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_progressBar(progressBar){\n            \n    }\n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n/***更新progress bar***/\n            if(m_progressBar != NULL) {\n                m_progressBar->setValue((i + 1) / m_fileNumber);\n            }\n        }\n    }\n}\n```\n\n{% note warning%}\n\n但是这种实现方式违反了<u>依赖倒置原则</u>。FileSplitter依赖ProgressBar 这样一种具体的实现细节，但是进度条的种类和展现形式是变化的，如果我们想将进度条换一种展现形式，比如不断打点，那么就会面临需求变更的困扰。\n\n{% endnote %}\n\n\n\n* 第二种实现方式\n\n```cpp\nclass IProgress {\npublic:\n    virtual void DoProgresss(float value) = 0;\n    virtual ~IProgress() {}\n}\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\n    //ProgressBar* m_progressBar; 这是一个通知控件\n    IProgress* m_iprogress; //抽象通知机制\npublic:\n    FileSplitter(const strign& filePath, int fileNumber, IProgress* iprogress):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_iprogress(iprogress){\n            \n    }\n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n\t\t\t\n            if(m_iprogress != NULL) {\n                float progressValue = m_fileNumber;\n                progressValue = (i + 1) / progressValue;\n                m_iprogress->DoProgress(progressValue); //更新进度条\n            }\n        }\n    }\n}\n```\n\n```cpp\nclass MainForm: public Form, public IProgress{\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n    ProgressBar* progressbar;\npublic:\n    void Button1_Click() {\n        string filePath = txtFilePath->getText();\n        int number = atoi(txtFileNumber->getText().c_str());\n        \n        FileSplitter splitter(filePath, number);\n        splitter.split();\n    }\n    \n    virtual void DoProgress(float value) {\n        progressBar->setValue(value);\n    }\n}\n```\n\nC++支持多继承，但是不推荐使用多继承，因为会带来很多耦合的问题。但是有一种情况是推荐使用多继承的，一个主的继承类，其他都是接口  (单继承多实现), 这里就属于这种情况\n\n* 再修改一下\n\n```cpp\nclass IProgress {\npublic:\n    virtual void DoProgresss(float value) = 0;\n    virtual ~IProgress() {}\n}\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\n    //ProgressBar* m_progressBar; 这是一个通知控件\n    IProgress* m_iprogress; //抽象通知机制\npublic:\n    FileSplitter(const strign& filePath, int fileNumber, IProgress* iprogress):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_iprogress(iprogress){\n            \n    }\n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n\t\t\t\n            float progressValue = m_fileNumber;\n            progressValue = (i + 1) / progressValue;\n            onProgress(progressValue);\n        }\n    }\nprotected:\n    void onProgress(float value) {\n        if(m_iprogress != NULL) {\n\t        m_iprogress->DoProgress(value);\t//更新进度条\n        }\n    }\n}\n```\n\n\n\n\n\n#### 需求2: 多观察者\n\n```cpp\nclass IProgress {\npublic:\n    virtual void DoProgresss(float value) = 0;\n    virtual ~IProgress() {}\n}\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\n    List<IProgress*> m_iprogressList; //抽象通知机制, 支持多个观察者\npublic:\n    FileSplitter(const strign& filePath, int fileNumber):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) {\n            \n    }\n    \n    void addIProgress(IProgress* iprogress) {\n        m_iprogressList.add(iprogress);\n    }\n    \n    void removeIProgress(IProgress* iprogress) {\n        m_iprogressList.remove(iprogress);\n    }\n    \n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n\t\t\t\n            float progressValue = m_fileNumber;\n            progressValue = (i + 1) / progressValue;\n            onProgress(progressValue);\n        }\n    }\nprotected:\n    void onProgress(float value) {\n        List<IProgress*>::iterator it = m_iprogressList.begin();\n        \n\t\twhile(it != m_iprogressList.end()) {\n            (*it)->DoProgress(value);\n            it++;\n        }\n    }\n}\n```\n\n```cpp\nclass MainForm: public Form, public IProgress{\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n    ProgressBar* progressbar;\npublic:\n    void Button1_Click() {\n        string filePath = txtFilePath->getText();\n        int number = atoi(txtFileNumber->getText().c_str());\n        \n        ConsoleNotifier cn;\n        FileSplitter splitter(filePath, number);\n        \n        splitter.addIprogress(this);\n        splitter.addIprogress(&cn);\n        \n        splitter.split();\n    }\n    \n    virtual void DoProgress(float value) {\n        progressBar->setValue(value);\n    }\n}\n\nclass ConsoleNotifier: public IProgress {\npublic:\n    virtual void DoProgress(float value) {\n        cout << \".\";\n    }\n}\n```\n\n\n\n## 结构\n\n<img src=\"image-20200806160700160.png\" alt=\"image-20200806160700160\" style=\"zoom: 50%;\" />\n\n\n\n## 总结\n\n* 使用面向对象的抽象，Observer模式使得我们可以独立地改变目标与观察者，从而使二者之间的依赖关系达致松耦合。 \n\n* 目标发送通知时，无需指定观察者，通知（可以携带通知信息作为参数）会自动传播。\n\n* 观察者自己决定是否需要订阅通知，目标对象对此一无所知。 \n* Observer模式是基于事件的UI框架中非常常用的设计模式，也是 MVC模式的一个重要组成部分。","source":"_posts/DesignPatterns/Observer.md","raw":"---\ntitle: Observer 观察者模式\ndate: 2020-08-06 14:22:25\nindex_img: /img/image-20200806160700160.png\ntags: Design Patterns\ncategories: Design Patterns\n---\n\n\n\n## 动机\n\n在软件构建过程中，我们需要为某些对象建立一种\"通知依赖关系\" \n\n<u>一个对象（目标对象）的状态发生改变，所有的依赖对象（观察者对象）都将得到通知。如果这样的依赖关系过于紧密， 将使软件不能很好地抵御变化</u>。\n\n使用面向对象技术，可以将这种依赖关系弱化，并形成一种稳定的依赖关系。从而实现软件体系结构的松耦合。\n\n\n\n## 模式定义\n\n定义对象间的一种<u>***一对多***</u>（变化）的依赖关系，以便当一个 对象(Subject)的状态发生改变时，所有依赖于它的对象都得到通知并<u>***自动更新***</u>。\n\n\n\n## 代码示例\n\n考虑一个文件分割器程序，将一个大文件分割成几个小文件。\n\n我们有一个主界面MainForm (在这里是一个观察者), 里面有两个对象，一个是文件路径，一个是分割成的文件都个数。当button click时就会调用filesplitter将文件分割\n\n代码如下\n\n```cpp\nclass MainForm: public Form {\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\npublic:\n    void Button1_Click() {\n        string filePath = txtFilePath->getText();\n        int number = atoi(txtFileNumber->getText().c_str());\n        \n        FileSplitter splitter(filePath, number);\n        splitter.split();\n    }\n}\n```\n\n```cpp\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\npublic:\n    FileSplitter(const strign& filePath, int fileNumber):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) {\n            \n    }\n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n        }\n    }\n}\n```\n\n\n\n#### 需求1：文件分割进度条\n\n* 第一种实现方式\n\n```cpp\nclass MainForm: public Form {\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n/***增加progress bar***/\n    ProgressBar* progressBar;\npublic:\n    void Button1_Click() {\n        string filePath = txtFilePath->getText();\n        int number = atoi(txtFileNumber->getText().c_str());\n        \n        FileSplitter splitter(filePath, number);\n        splitter.split();\n    }\n}\n```\n\n\n\n```cpp\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\n/***增加progres bar***/\n    ProgressBar* m_progressBar;\npublic:\n/***增加初始化参数***/\n    FileSplitter(const strign& filePath, int fileNumber, ProgressBar* progressBar):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_progressBar(progressBar){\n            \n    }\n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n/***更新progress bar***/\n            if(m_progressBar != NULL) {\n                m_progressBar->setValue((i + 1) / m_fileNumber);\n            }\n        }\n    }\n}\n```\n\n{% note warning%}\n\n但是这种实现方式违反了<u>依赖倒置原则</u>。FileSplitter依赖ProgressBar 这样一种具体的实现细节，但是进度条的种类和展现形式是变化的，如果我们想将进度条换一种展现形式，比如不断打点，那么就会面临需求变更的困扰。\n\n{% endnote %}\n\n\n\n* 第二种实现方式\n\n```cpp\nclass IProgress {\npublic:\n    virtual void DoProgresss(float value) = 0;\n    virtual ~IProgress() {}\n}\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\n    //ProgressBar* m_progressBar; 这是一个通知控件\n    IProgress* m_iprogress; //抽象通知机制\npublic:\n    FileSplitter(const strign& filePath, int fileNumber, IProgress* iprogress):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_iprogress(iprogress){\n            \n    }\n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n\t\t\t\n            if(m_iprogress != NULL) {\n                float progressValue = m_fileNumber;\n                progressValue = (i + 1) / progressValue;\n                m_iprogress->DoProgress(progressValue); //更新进度条\n            }\n        }\n    }\n}\n```\n\n```cpp\nclass MainForm: public Form, public IProgress{\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n    ProgressBar* progressbar;\npublic:\n    void Button1_Click() {\n        string filePath = txtFilePath->getText();\n        int number = atoi(txtFileNumber->getText().c_str());\n        \n        FileSplitter splitter(filePath, number);\n        splitter.split();\n    }\n    \n    virtual void DoProgress(float value) {\n        progressBar->setValue(value);\n    }\n}\n```\n\nC++支持多继承，但是不推荐使用多继承，因为会带来很多耦合的问题。但是有一种情况是推荐使用多继承的，一个主的继承类，其他都是接口  (单继承多实现), 这里就属于这种情况\n\n* 再修改一下\n\n```cpp\nclass IProgress {\npublic:\n    virtual void DoProgresss(float value) = 0;\n    virtual ~IProgress() {}\n}\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\n    //ProgressBar* m_progressBar; 这是一个通知控件\n    IProgress* m_iprogress; //抽象通知机制\npublic:\n    FileSplitter(const strign& filePath, int fileNumber, IProgress* iprogress):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_iprogress(iprogress){\n            \n    }\n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n\t\t\t\n            float progressValue = m_fileNumber;\n            progressValue = (i + 1) / progressValue;\n            onProgress(progressValue);\n        }\n    }\nprotected:\n    void onProgress(float value) {\n        if(m_iprogress != NULL) {\n\t        m_iprogress->DoProgress(value);\t//更新进度条\n        }\n    }\n}\n```\n\n\n\n\n\n#### 需求2: 多观察者\n\n```cpp\nclass IProgress {\npublic:\n    virtual void DoProgresss(float value) = 0;\n    virtual ~IProgress() {}\n}\nclass FileSplitter {\n    string m_filePath;\n    int m_fileNumber;\n    List<IProgress*> m_iprogressList; //抽象通知机制, 支持多个观察者\npublic:\n    FileSplitter(const strign& filePath, int fileNumber):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) {\n            \n    }\n    \n    void addIProgress(IProgress* iprogress) {\n        m_iprogressList.add(iprogress);\n    }\n    \n    void removeIProgress(IProgress* iprogress) {\n        m_iprogressList.remove(iprogress);\n    }\n    \n    \n    void split() {\n        //1. 读取大文件\n        \n        //2. 分批次向小文件中写入\n        for(int i = 0; i < m_fileNumber; i++) {\n            //...\n\t\t\t\n            float progressValue = m_fileNumber;\n            progressValue = (i + 1) / progressValue;\n            onProgress(progressValue);\n        }\n    }\nprotected:\n    void onProgress(float value) {\n        List<IProgress*>::iterator it = m_iprogressList.begin();\n        \n\t\twhile(it != m_iprogressList.end()) {\n            (*it)->DoProgress(value);\n            it++;\n        }\n    }\n}\n```\n\n```cpp\nclass MainForm: public Form, public IProgress{\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n    ProgressBar* progressbar;\npublic:\n    void Button1_Click() {\n        string filePath = txtFilePath->getText();\n        int number = atoi(txtFileNumber->getText().c_str());\n        \n        ConsoleNotifier cn;\n        FileSplitter splitter(filePath, number);\n        \n        splitter.addIprogress(this);\n        splitter.addIprogress(&cn);\n        \n        splitter.split();\n    }\n    \n    virtual void DoProgress(float value) {\n        progressBar->setValue(value);\n    }\n}\n\nclass ConsoleNotifier: public IProgress {\npublic:\n    virtual void DoProgress(float value) {\n        cout << \".\";\n    }\n}\n```\n\n\n\n## 结构\n\n<img src=\"image-20200806160700160.png\" alt=\"image-20200806160700160\" style=\"zoom: 50%;\" />\n\n\n\n## 总结\n\n* 使用面向对象的抽象，Observer模式使得我们可以独立地改变目标与观察者，从而使二者之间的依赖关系达致松耦合。 \n\n* 目标发送通知时，无需指定观察者，通知（可以携带通知信息作为参数）会自动传播。\n\n* 观察者自己决定是否需要订阅通知，目标对象对此一无所知。 \n* Observer模式是基于事件的UI框架中非常常用的设计模式，也是 MVC模式的一个重要组成部分。","slug":"DesignPatterns/Observer","published":1,"updated":"2020-08-06T08:29:54.267Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckdjycnun0004iuufhngofylt","content":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><p>在软件构建过程中，我们需要为某些对象建立一种”通知依赖关系” </p>\n<p><u>一个对象（目标对象）的状态发生改变，所有的依赖对象（观察者对象）都将得到通知。如果这样的依赖关系过于紧密， 将使软件不能很好地抵御变化</u>。</p>\n<p>使用面向对象技术，可以将这种依赖关系弱化，并形成一种稳定的依赖关系。从而实现软件体系结构的松耦合。</p>\n<h2 id=\"模式定义\"><a href=\"#模式定义\" class=\"headerlink\" title=\"模式定义\"></a>模式定义</h2><p>定义对象间的一种<u><strong><em>一对多</em></strong></u>（变化）的依赖关系，以便当一个 对象(Subject)的状态发生改变时，所有依赖于它的对象都得到通知并<u><strong><em>自动更新</em></strong></u>。</p>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>考虑一个文件分割器程序，将一个大文件分割成几个小文件。</p>\n<p>我们有一个主界面MainForm (在这里是一个观察者), 里面有两个对象，一个是文件路径，一个是分割成的文件都个数。当button click时就会调用filesplitter将文件分割</p>\n<p>代码如下</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainForm</span>:</span> <span class=\"hljs-keyword\">public</span> Form &#123;\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Button1_Click</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-built_in\">string</span> filePath = txtFilePath-&gt;getText();\n        <span class=\"hljs-keyword\">int</span> number = atoi(txtFileNumber-&gt;getText().c_str());\n        \n        <span class=\"hljs-function\">FileSplitter <span class=\"hljs-title\">splitter</span><span class=\"hljs-params\">(filePath, number)</span></span>;\n        splitter.split();\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n<span class=\"hljs-keyword\">public</span>:\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) &#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n\n\n<h4 id=\"需求1：文件分割进度条\"><a href=\"#需求1：文件分割进度条\" class=\"headerlink\" title=\"需求1：文件分割进度条\"></a>需求1：文件分割进度条</h4><ul>\n<li>第一种实现方式</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainForm</span>:</span> <span class=\"hljs-keyword\">public</span> Form &#123;\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n<span class=\"hljs-comment\">/***增加progress bar***/</span>\n    ProgressBar* progressBar;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Button1_Click</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-built_in\">string</span> filePath = txtFilePath-&gt;getText();\n        <span class=\"hljs-keyword\">int</span> number = atoi(txtFileNumber-&gt;getText().c_str());\n        \n        <span class=\"hljs-function\">FileSplitter <span class=\"hljs-title\">splitter</span><span class=\"hljs-params\">(filePath, number)</span></span>;\n        splitter.split();\n    &#125;\n&#125;</code></pre></div>\n\n\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n<span class=\"hljs-comment\">/***增加progres bar***/</span>\n    ProgressBar* m_progressBar;\n<span class=\"hljs-keyword\">public</span>:\n<span class=\"hljs-comment\">/***增加初始化参数***/</span>\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber, ProgressBar* progressBar):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_progressBar(progressBar)&#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n<span class=\"hljs-comment\">/***更新progress bar***/</span>\n            <span class=\"hljs-keyword\">if</span>(m_progressBar != <span class=\"hljs-literal\">NULL</span>) &#123;\n                m_progressBar-&gt;setValue((i + <span class=\"hljs-number\">1</span>) / m_fileNumber);\n            &#125;\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"note note-warning\">\n            <p>但是这种实现方式违反了<u>依赖倒置原则</u>。FileSplitter依赖ProgressBar 这样一种具体的实现细节，但是进度条的种类和展现形式是变化的，如果我们想将进度条换一种展现形式，比如不断打点，那么就会面临需求变更的困扰。</p>\n          </div>\n\n\n\n<ul>\n<li>第二种实现方式</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IProgress</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgresss</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">virtual</span> ~IProgress() &#123;&#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n    <span class=\"hljs-comment\">//ProgressBar* m_progressBar; 这是一个通知控件</span>\n    IProgress* m_iprogress; <span class=\"hljs-comment\">//抽象通知机制</span>\n<span class=\"hljs-keyword\">public</span>:\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber, IProgress* iprogress):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_iprogress(iprogress)&#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n\t\t\t\n            <span class=\"hljs-keyword\">if</span>(m_iprogress != <span class=\"hljs-literal\">NULL</span>) &#123;\n                <span class=\"hljs-keyword\">float</span> progressValue = m_fileNumber;\n                progressValue = (i + <span class=\"hljs-number\">1</span>) / progressValue;\n                m_iprogress-&gt;DoProgress(progressValue); <span class=\"hljs-comment\">//更新进度条</span>\n            &#125;\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainForm</span>:</span> <span class=\"hljs-keyword\">public</span> Form, <span class=\"hljs-keyword\">public</span> IProgress&#123;\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n    ProgressBar* progressbar;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Button1_Click</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-built_in\">string</span> filePath = txtFilePath-&gt;getText();\n        <span class=\"hljs-keyword\">int</span> number = atoi(txtFileNumber-&gt;getText().c_str());\n        \n        <span class=\"hljs-function\">FileSplitter <span class=\"hljs-title\">splitter</span><span class=\"hljs-params\">(filePath, number)</span></span>;\n        splitter.split();\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        progressBar-&gt;setValue(value);\n    &#125;\n&#125;</code></pre></div>\n\n<p>C++支持多继承，但是不推荐使用多继承，因为会带来很多耦合的问题。但是有一种情况是推荐使用多继承的，一个主的继承类，其他都是接口  (单继承多实现), 这里就属于这种情况</p>\n<ul>\n<li>再修改一下</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IProgress</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgresss</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">virtual</span> ~IProgress() &#123;&#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n    <span class=\"hljs-comment\">//ProgressBar* m_progressBar; 这是一个通知控件</span>\n    IProgress* m_iprogress; <span class=\"hljs-comment\">//抽象通知机制</span>\n<span class=\"hljs-keyword\">public</span>:\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber, IProgress* iprogress):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_iprogress(iprogress)&#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n\t\t\t\n            <span class=\"hljs-keyword\">float</span> progressValue = m_fileNumber;\n            progressValue = (i + <span class=\"hljs-number\">1</span>) / progressValue;\n            onProgress(progressValue);\n        &#125;\n    &#125;\n<span class=\"hljs-keyword\">protected</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        <span class=\"hljs-keyword\">if</span>(m_iprogress != <span class=\"hljs-literal\">NULL</span>) &#123;\n\t        m_iprogress-&gt;DoProgress(value);\t<span class=\"hljs-comment\">//更新进度条</span>\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n\n\n\n\n<h4 id=\"需求2-多观察者\"><a href=\"#需求2-多观察者\" class=\"headerlink\" title=\"需求2: 多观察者\"></a>需求2: 多观察者</h4><div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IProgress</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgresss</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">virtual</span> ~IProgress() &#123;&#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n    List&lt;IProgress*&gt; m_iprogressList; <span class=\"hljs-comment\">//抽象通知机制, 支持多个观察者</span>\n<span class=\"hljs-keyword\">public</span>:\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) &#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addIProgress</span><span class=\"hljs-params\">(IProgress* iprogress)</span> </span>&#123;\n        m_iprogressList.add(iprogress);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">removeIProgress</span><span class=\"hljs-params\">(IProgress* iprogress)</span> </span>&#123;\n        m_iprogressList.remove(iprogress);\n    &#125;\n    \n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n\t\t\t\n            <span class=\"hljs-keyword\">float</span> progressValue = m_fileNumber;\n            progressValue = (i + <span class=\"hljs-number\">1</span>) / progressValue;\n            onProgress(progressValue);\n        &#125;\n    &#125;\n<span class=\"hljs-keyword\">protected</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        List&lt;IProgress*&gt;::iterator it = m_iprogressList.begin();\n        \n\t\t<span class=\"hljs-keyword\">while</span>(it != m_iprogressList.end()) &#123;\n            (*it)-&gt;DoProgress(value);\n            it++;\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainForm</span>:</span> <span class=\"hljs-keyword\">public</span> Form, <span class=\"hljs-keyword\">public</span> IProgress&#123;\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n    ProgressBar* progressbar;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Button1_Click</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-built_in\">string</span> filePath = txtFilePath-&gt;getText();\n        <span class=\"hljs-keyword\">int</span> number = atoi(txtFileNumber-&gt;getText().c_str());\n        \n        ConsoleNotifier cn;\n        <span class=\"hljs-function\">FileSplitter <span class=\"hljs-title\">splitter</span><span class=\"hljs-params\">(filePath, number)</span></span>;\n        \n        splitter.addIprogress(<span class=\"hljs-keyword\">this</span>);\n        splitter.addIprogress(&amp;cn);\n        \n        splitter.split();\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        progressBar-&gt;setValue(value);\n    &#125;\n&#125;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ConsoleNotifier</span>:</span> <span class=\"hljs-keyword\">public</span> IProgress &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\".\"</span>;\n    &#125;\n&#125;</code></pre></div>\n\n\n\n<h2 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h2><img src=\"image-20200806160700160.png\" srcset=\"/img/loading.gif\" alt=\"image-20200806160700160\" style=\"zoom: 50%;\" />\n\n\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li><p>使用面向对象的抽象，Observer模式使得我们可以独立地改变目标与观察者，从而使二者之间的依赖关系达致松耦合。 </p>\n</li>\n<li><p>目标发送通知时，无需指定观察者，通知（可以携带通知信息作为参数）会自动传播。</p>\n</li>\n<li><p>观察者自己决定是否需要订阅通知，目标对象对此一无所知。 </p>\n</li>\n<li><p>Observer模式是基于事件的UI框架中非常常用的设计模式，也是 MVC模式的一个重要组成部分。</p>\n</li>\n</ul>\n","site":{"data":{"fluid_config":{"favicon":"/img/favicon.png","apple_touch_icon":"/img/favicon.png","title_join_string":" - ","force_https":false,"highlight":{"enable":true,"style":"Atom One Dark","bg_color":true,"copy_btn":true},"fun_features":{"typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"mouse_click":{"enable":false,"style":"values"}},"color":{"body_bg_color":"#eee","navbar_bg_color":"black","navbar_text_color":"white","text_color":"#3c4858","sec_text_color":"#718096","post_text_color":"#2c3e50","post_heading_color":"#1a202c","link_color":"#3c4858","link_hover_color":"#1abc9c","link_hover_bg_color":"#f8f9fa","board_color":"#fff"},"font":{"font_size":"16px","font_family":null,"code_font_size":"85%"},"custom_js":null,"custom_css":null,"custom_html":"","web_analytics":{"enable":false,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"tajs":null,"woyaola":null,"cnzz":null,"leancloud":{"app_id":"6ojk1lVz9eq7GQnBo6Q8zR5d-gzGzoHsz","app_key":"bOrBPlujAz77Ma6N5tY9wWJN","server_url":null}},"lazyload":{"enable":true,"onlypost":false},"daovoice":{"enable":false,"appid":""},"aplayer":{"enable":false,"autoplay":false,"loop":"all","order":"random","theme":"#b7daff","songs":[{"name":"name","artist":"artist","url":"/songs/test.mp3","cover":"/img/cover.jpg"},{"name":"name","artist":"artist","url":"https://...url.mp3","cover":"https://...cover.jpg"}]},"version":{"check":false},"navbar":{"blog_title":"Explorer","ground_glass":{"enable":false,"px":3,"alpha":0.7},"menu":[{"key":"home","link":"/","icon":"iconfont icon-home-fill"},{"key":"archive","link":"/archives/","icon":"iconfont icon-archive-fill"},{"key":"category","link":"/categories/","icon":"iconfont icon-category-fill"},{"key":"tag","link":"/tags/","icon":"iconfont icon-tags-fill"},{"key":"about","link":"/about/","icon":"iconfont icon-user-fill"}]},"search":{"enable":true,"path":"/local-search.xml","generate_path":"/local-search.xml","field":"post","content":true},"scroll_down_arrow":{"enable":true,"banner_height_limit":90,"scroll_after_turning_page":true},"banner_parallax":true,"footer":{"statistics":{"enable":false,"source":"busuanzi","pv_format":"总访问量 {} 次","uv_format":"总访客数 {} 人"},"beian":{"enable":false,"icp_text":"京ICP证123456号","police_text":"京公网安备12345678号","police_code":12345678,"police_icon":"/img/police_beian.png"}},"scroll_top_arrow":{"enable":true},"index":{"banner_img":"/img/default.png","banner_img_height":100,"banner_mask_alpha":0.3,"post_default_img":"","slogan":{"enable":true,"text":"It&apos; s Us Make The World Different"},"auto_excerpt":{"enable":true},"post_url_target":"_self","post_meta":{"date":true,"category":true,"tag":true}},"page":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3},"post":{"banner_img":"/img/default.png","banner_img_height":70,"banner_mask_alpha":0.3,"meta":{"date":{"enable":true,"format":"LL a"},"wordcount":{"enable":true,"format":"{} 字"},"min2read":{"enable":true,"format":"{} 分钟","words":100},"views":{"enable":true,"source":"busuanzi","format":"{} 次"}},"updated":{"enable":false,"content":"本文最后更新于：","relative":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"copyright":{"enable":true,"content":"本博客所有文章除特别声明外，均采用 <a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.zh\" rel=\"nofollow noopener\">CC BY-SA 4.0 协议</a> ，转载请注明出处！"},"prev_next":{"enable":true},"custom":{"enable":false,"content":"<img src=\"https://octodex.github.com/images/jetpacktocat.png\" class=\"rounded mx-auto d-block mt-5\" style=\"width:150px; height:150px;\">"},"image_zoom":{"enable":true},"footnote":{"enable":true,"header":""},"math":{"enable":true,"specific":false,"engine":"mathjax"},"mermaid":{"enable":true,"specific":false,"options":{"theme":"default"}},"comments":{"enable":false,"type":"gitalk"}},"utterances":{"repo":null,"issue_term":null,"label":"utterances","theme":"github-light","crossorigin":"anonymous"},"disqus":{"shortname":null,"disqusjs":false,"apikey":null},"gitalk":{"clientID":"cde2629d6201340c948b","clientSecret":"621727333cc595103f634cf6deaba53bd8784fe6","repo":"blog-comments","owner":"miaochenlu","admin":null,"id":"location.pathname","language":"zh-CN","labels":"['Gitalk']","perPage":15,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true},"valine":{"appid":null,"appkey":null,"placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":null},"changyan":{"appid":"","appkey":""},"livere":{"uid":""},"archive":{"banner_img":"/img/achive.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null},"category":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"post_limit":10,"order_by":"-length"},"tag":{"banner_img":"/img/default.png","banner_img_height":80,"banner_mask_alpha":0.3,"subtitle":null,"tagcloud":{"min_font":15,"max_font":30,"unit":"px","start_color":"#BBBBEE","end_color":"#337ab7"}},"about":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"avatar":"/img/avatar.png","name":"Chenlu Miao","introduce":"李德胜永远滴神","icons":[{"class":"iconfont icon-github-fill","link":"https://github.com/miaochenlu","tip":"GitHub"},{"class":"iconfont icon-mail","link":"mailto:clmiao@zju.edu.cn","tip":"邮箱"}]},"page404":{"banner_img":"/img/default.png","banner_img_height":85,"banner_mask_alpha":0.3,"subtitle":"Page not found"},"links":{"banner_img":"/img/default.png","banner_img_height":60,"banner_mask_alpha":0.3,"subtitle":null,"items":[{"title":"Fluid Docs","intro":"主题使用指南","link":"https://hexo.fluid-dev.com/docs/","image":"/img/favicon.png"},{"title":"Fluid Repo","intro":"主题 GitHub 仓库","link":"https://github.com/fluid-dev/hexo-theme-fluid","image":"/img/favicon.png"},{"title":"Fluid Example","intro":"主题操作示例","link":"https://hexo.fluid-dev.com/docs/example/","image":"/img/favicon.png"}]}}}},"excerpt":"","more":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><p>在软件构建过程中，我们需要为某些对象建立一种”通知依赖关系” </p>\n<p><u>一个对象（目标对象）的状态发生改变，所有的依赖对象（观察者对象）都将得到通知。如果这样的依赖关系过于紧密， 将使软件不能很好地抵御变化</u>。</p>\n<p>使用面向对象技术，可以将这种依赖关系弱化，并形成一种稳定的依赖关系。从而实现软件体系结构的松耦合。</p>\n<h2 id=\"模式定义\"><a href=\"#模式定义\" class=\"headerlink\" title=\"模式定义\"></a>模式定义</h2><p>定义对象间的一种<u><strong><em>一对多</em></strong></u>（变化）的依赖关系，以便当一个 对象(Subject)的状态发生改变时，所有依赖于它的对象都得到通知并<u><strong><em>自动更新</em></strong></u>。</p>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>考虑一个文件分割器程序，将一个大文件分割成几个小文件。</p>\n<p>我们有一个主界面MainForm (在这里是一个观察者), 里面有两个对象，一个是文件路径，一个是分割成的文件都个数。当button click时就会调用filesplitter将文件分割</p>\n<p>代码如下</p>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainForm</span>:</span> <span class=\"hljs-keyword\">public</span> Form &#123;\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Button1_Click</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-built_in\">string</span> filePath = txtFilePath-&gt;getText();\n        <span class=\"hljs-keyword\">int</span> number = atoi(txtFileNumber-&gt;getText().c_str());\n        \n        <span class=\"hljs-function\">FileSplitter <span class=\"hljs-title\">splitter</span><span class=\"hljs-params\">(filePath, number)</span></span>;\n        splitter.split();\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n<span class=\"hljs-keyword\">public</span>:\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) &#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n\n\n<h4 id=\"需求1：文件分割进度条\"><a href=\"#需求1：文件分割进度条\" class=\"headerlink\" title=\"需求1：文件分割进度条\"></a>需求1：文件分割进度条</h4><ul>\n<li>第一种实现方式</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainForm</span>:</span> <span class=\"hljs-keyword\">public</span> Form &#123;\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n<span class=\"hljs-comment\">/***增加progress bar***/</span>\n    ProgressBar* progressBar;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Button1_Click</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-built_in\">string</span> filePath = txtFilePath-&gt;getText();\n        <span class=\"hljs-keyword\">int</span> number = atoi(txtFileNumber-&gt;getText().c_str());\n        \n        <span class=\"hljs-function\">FileSplitter <span class=\"hljs-title\">splitter</span><span class=\"hljs-params\">(filePath, number)</span></span>;\n        splitter.split();\n    &#125;\n&#125;</code></pre></div>\n\n\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n<span class=\"hljs-comment\">/***增加progres bar***/</span>\n    ProgressBar* m_progressBar;\n<span class=\"hljs-keyword\">public</span>:\n<span class=\"hljs-comment\">/***增加初始化参数***/</span>\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber, ProgressBar* progressBar):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_progressBar(progressBar)&#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n<span class=\"hljs-comment\">/***更新progress bar***/</span>\n            <span class=\"hljs-keyword\">if</span>(m_progressBar != <span class=\"hljs-literal\">NULL</span>) &#123;\n                m_progressBar-&gt;setValue((i + <span class=\"hljs-number\">1</span>) / m_fileNumber);\n            &#125;\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"note note-warning\">\n            <p>但是这种实现方式违反了<u>依赖倒置原则</u>。FileSplitter依赖ProgressBar 这样一种具体的实现细节，但是进度条的种类和展现形式是变化的，如果我们想将进度条换一种展现形式，比如不断打点，那么就会面临需求变更的困扰。</p>\n          </div>\n\n\n\n<ul>\n<li>第二种实现方式</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IProgress</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgresss</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">virtual</span> ~IProgress() &#123;&#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n    <span class=\"hljs-comment\">//ProgressBar* m_progressBar; 这是一个通知控件</span>\n    IProgress* m_iprogress; <span class=\"hljs-comment\">//抽象通知机制</span>\n<span class=\"hljs-keyword\">public</span>:\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber, IProgress* iprogress):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_iprogress(iprogress)&#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n\t\t\t\n            <span class=\"hljs-keyword\">if</span>(m_iprogress != <span class=\"hljs-literal\">NULL</span>) &#123;\n                <span class=\"hljs-keyword\">float</span> progressValue = m_fileNumber;\n                progressValue = (i + <span class=\"hljs-number\">1</span>) / progressValue;\n                m_iprogress-&gt;DoProgress(progressValue); <span class=\"hljs-comment\">//更新进度条</span>\n            &#125;\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainForm</span>:</span> <span class=\"hljs-keyword\">public</span> Form, <span class=\"hljs-keyword\">public</span> IProgress&#123;\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n    ProgressBar* progressbar;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Button1_Click</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-built_in\">string</span> filePath = txtFilePath-&gt;getText();\n        <span class=\"hljs-keyword\">int</span> number = atoi(txtFileNumber-&gt;getText().c_str());\n        \n        <span class=\"hljs-function\">FileSplitter <span class=\"hljs-title\">splitter</span><span class=\"hljs-params\">(filePath, number)</span></span>;\n        splitter.split();\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        progressBar-&gt;setValue(value);\n    &#125;\n&#125;</code></pre></div>\n\n<p>C++支持多继承，但是不推荐使用多继承，因为会带来很多耦合的问题。但是有一种情况是推荐使用多继承的，一个主的继承类，其他都是接口  (单继承多实现), 这里就属于这种情况</p>\n<ul>\n<li>再修改一下</li>\n</ul>\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IProgress</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgresss</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">virtual</span> ~IProgress() &#123;&#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n    <span class=\"hljs-comment\">//ProgressBar* m_progressBar; 这是一个通知控件</span>\n    IProgress* m_iprogress; <span class=\"hljs-comment\">//抽象通知机制</span>\n<span class=\"hljs-keyword\">public</span>:\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber, IProgress* iprogress):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) \n        m_iprogress(iprogress)&#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n\t\t\t\n            <span class=\"hljs-keyword\">float</span> progressValue = m_fileNumber;\n            progressValue = (i + <span class=\"hljs-number\">1</span>) / progressValue;\n            onProgress(progressValue);\n        &#125;\n    &#125;\n<span class=\"hljs-keyword\">protected</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        <span class=\"hljs-keyword\">if</span>(m_iprogress != <span class=\"hljs-literal\">NULL</span>) &#123;\n\t        m_iprogress-&gt;DoProgress(value);\t<span class=\"hljs-comment\">//更新进度条</span>\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n\n\n\n\n<h4 id=\"需求2-多观察者\"><a href=\"#需求2-多观察者\" class=\"headerlink\" title=\"需求2: 多观察者\"></a>需求2: 多观察者</h4><div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IProgress</span> &#123;</span>\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgresss</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>= <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">virtual</span> ~IProgress() &#123;&#125;\n&#125;\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FileSplitter</span> &#123;</span>\n    <span class=\"hljs-built_in\">string</span> m_filePath;\n    <span class=\"hljs-keyword\">int</span> m_fileNumber;\n    List&lt;IProgress*&gt; m_iprogressList; <span class=\"hljs-comment\">//抽象通知机制, 支持多个观察者</span>\n<span class=\"hljs-keyword\">public</span>:\n    FileSplitter(<span class=\"hljs-keyword\">const</span> strign&amp; filePath, <span class=\"hljs-keyword\">int</span> fileNumber):\n    \tm_filePath(filePath),\n    \tm_fileNumber(fileNumber) &#123;\n            \n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addIProgress</span><span class=\"hljs-params\">(IProgress* iprogress)</span> </span>&#123;\n        m_iprogressList.add(iprogress);\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">removeIProgress</span><span class=\"hljs-params\">(IProgress* iprogress)</span> </span>&#123;\n        m_iprogressList.remove(iprogress);\n    &#125;\n    \n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">split</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-comment\">//1. 读取大文件</span>\n        \n        <span class=\"hljs-comment\">//2. 分批次向小文件中写入</span>\n        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m_fileNumber; i++) &#123;\n            <span class=\"hljs-comment\">//...</span>\n\t\t\t\n            <span class=\"hljs-keyword\">float</span> progressValue = m_fileNumber;\n            progressValue = (i + <span class=\"hljs-number\">1</span>) / progressValue;\n            onProgress(progressValue);\n        &#125;\n    &#125;\n<span class=\"hljs-keyword\">protected</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        List&lt;IProgress*&gt;::iterator it = m_iprogressList.begin();\n        \n\t\t<span class=\"hljs-keyword\">while</span>(it != m_iprogressList.end()) &#123;\n            (*it)-&gt;DoProgress(value);\n            it++;\n        &#125;\n    &#125;\n&#125;</code></pre></div>\n\n<div class=\"hljs\"><pre><code class=\"hljs cpp\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainForm</span>:</span> <span class=\"hljs-keyword\">public</span> Form, <span class=\"hljs-keyword\">public</span> IProgress&#123;\n    TextBox* txtFilePath;\n    TextBox* txtFileNumber;\n    ProgressBar* progressbar;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Button1_Click</span><span class=\"hljs-params\">()</span> </span>&#123;\n        <span class=\"hljs-built_in\">string</span> filePath = txtFilePath-&gt;getText();\n        <span class=\"hljs-keyword\">int</span> number = atoi(txtFileNumber-&gt;getText().c_str());\n        \n        ConsoleNotifier cn;\n        <span class=\"hljs-function\">FileSplitter <span class=\"hljs-title\">splitter</span><span class=\"hljs-params\">(filePath, number)</span></span>;\n        \n        splitter.addIprogress(<span class=\"hljs-keyword\">this</span>);\n        splitter.addIprogress(&amp;cn);\n        \n        splitter.split();\n    &#125;\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        progressBar-&gt;setValue(value);\n    &#125;\n&#125;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ConsoleNotifier</span>:</span> <span class=\"hljs-keyword\">public</span> IProgress &#123;\n<span class=\"hljs-keyword\">public</span>:\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">virtual</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DoProgress</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> value)</span> </span>&#123;\n        <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">\".\"</span>;\n    &#125;\n&#125;</code></pre></div>\n\n\n\n<h2 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h2><img src=\"image-20200806160700160.png\" srcset=\"/img/loading.gif\" alt=\"image-20200806160700160\" style=\"zoom: 50%;\" />\n\n\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li><p>使用面向对象的抽象，Observer模式使得我们可以独立地改变目标与观察者，从而使二者之间的依赖关系达致松耦合。 </p>\n</li>\n<li><p>目标发送通知时，无需指定观察者，通知（可以携带通知信息作为参数）会自动传播。</p>\n</li>\n<li><p>观察者自己决定是否需要订阅通知，目标对象对此一无所知。 </p>\n</li>\n<li><p>Observer模式是基于事件的UI框架中非常常用的设计模式，也是 MVC模式的一个重要组成部分。</p>\n</li>\n</ul>\n"}],"PostAsset":[{"_id":"source/_posts/DesignPatterns/StrategyMethod/image-20200805135526277.png","slug":"image-20200805135526277.png","post":"ckdh3nd2c00026xufglbcalag","modified":0,"renderable":0},{"_id":"source/_posts/DesignPatterns/TemplateMethod/image-20200710191024075.png","slug":"image-20200710191024075.png","post":"ckdh3nmky00046xufa4pw5hqd","modified":0,"renderable":0},{"_id":"source/_posts/DesignPatterns/TemplateMethod/image-20200710191917988.png","slug":"image-20200710191917988.png","post":"ckdh3nmky00046xufa4pw5hqd","modified":0,"renderable":0},{"_id":"source/_posts/DesignPatterns/TemplateMethod/image-20200710192039991.png","slug":"image-20200710192039991.png","post":"ckdh3nmky00046xufa4pw5hqd","modified":0,"renderable":0},{"_id":"source/_posts/DesignPatterns/TemplateMethod/image-20200710191212499.png","slug":"image-20200710191212499.png","post":"ckdh3nmky00046xufa4pw5hqd","modified":0,"renderable":0},{"_id":"source/_posts/Decorator/image-20200807160507597.png","slug":"image-20200807160507597.png","post":"ckdjycntp0000iuufex6h2zsd","modified":0,"renderable":0},{"_id":"source/_posts/Decorator/image-20200807142228605.png","slug":"image-20200807142228605.png","post":"ckdjycntp0000iuufex6h2zsd","modified":0,"renderable":0},{"_id":"source/_posts/Decorator/image-20200807143722316.png","slug":"image-20200807143722316.png","post":"ckdjycntp0000iuufex6h2zsd","modified":0,"renderable":0},{"_id":"source/_posts/Decorator/image-20200807143823919.png","slug":"image-20200807143823919.png","post":"ckdjycntp0000iuufex6h2zsd","modified":0,"renderable":0},{"_id":"source/_posts/DesignPatterns/Observer/image-20200806160700160.png","slug":"image-20200806160700160.png","post":"ckdjycnun0004iuufhngofylt","modified":0,"renderable":0}],"PostCategory":[{"post_id":"ckdjycntp0000iuufex6h2zsd","category_id":"ckdjycnu00001iuuf2yqza5sa","_id":"ckdjycnu50003iuufce6w1nal"},{"post_id":"ckdjycnun0004iuufhngofylt","category_id":"ckdjycnu00001iuuf2yqza5sa","_id":"ckdjycnup0006iuufb41y0jlu"},{"post_id":"ckdh3nd2c00026xufglbcalag","category_id":"ckdjycnu00001iuuf2yqza5sa","_id":"ckdjycnv20007iuufdnoran3l"},{"post_id":"ckdh3nmky00046xufa4pw5hqd","category_id":"ckdjycnu00001iuuf2yqza5sa","_id":"ckdjycnv20008iuuf9krj0lp5"}],"PostTag":[{"post_id":"ckdh3nd2c00026xufglbcalag","tag_id":"ckdh31rnr0000vcuf2ays2egl","_id":"ckdh3nd2d00036xuf566pc37q"},{"post_id":"ckdh3nmky00046xufa4pw5hqd","tag_id":"ckdh31rnr0000vcuf2ays2egl","_id":"ckdh3nmkz00056xuf1we0h2ri"},{"post_id":"ckdih3utt0000swufhyr93wu1","tag_id":"ckdh31rnr0000vcuf2ays2egl","_id":"ckdih3uu00002swuf62uq2itr"},{"post_id":"ckdjycntp0000iuufex6h2zsd","tag_id":"ckdh31rnr0000vcuf2ays2egl","_id":"ckdjycnu40002iuuf0ngjeu7q"},{"post_id":"ckdjycnun0004iuufhngofylt","tag_id":"ckdh31rnr0000vcuf2ays2egl","_id":"ckdjycnup0005iuuf17kuep2a"}],"Tag":[{"name":"image","_id":"ckd5o08kb0003g5uferykcujq"},{"name":"DesignPatterns","_id":"ckdh1mcqc00010rufbtp9dwfu"},{"name":"Design Patterns","_id":"ckdh31rnr0000vcuf2ays2egl"}]}}