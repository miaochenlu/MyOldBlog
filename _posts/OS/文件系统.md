# 4. 分配方法

## 4.1 连续分配

## 4.2 链接分配[linked allocation]

> 每个文件是磁盘块的链表。目录包括文件第一块的指针和最后一块的指针

如图：一个有5块的文件，从块9开始，然后是块16， 1， 10， 最后是25。

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191207100135972.png" alt="image-20191207100135972" style="zoom:50%;" />

要创建新文件，可以简单地在目录中增加一个entry。

每个directory entry都有一个指向文件首块的指针，这个指针初始化为nil，表示空文件





## 4.3 索引分配[indexed allocation]

连续分配和链接分配的问题

> 链接分配可以解决连续分配的***<u>外部碎片</u>***和***<u>大小声明</u>***问题。但是如果不用FAT，那么链接分配是不能有效支持***<u>直接访问</u>***的，因为块指针和块一起分布在整个磁盘，必须按顺序读取。

索引分配通过把所有文件块的指针放在一个***<u>索引块</u>***，解决了这个问题

* 索引块是一个磁盘块地址的数组，索引块的第i个entry指向文件的第i个块
* directory entry包括索引块的地址

如果要读第i块，通过索引块的第i个

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191207102636309.png" alt="image-20191207102636309" style="zoom:50%;" />





### 如何组织索引块

* Linked scheme

  为了处理大文件，可以将多个***<u>索引块链接</u>***起来

  an index block might contain 

  * a small header giving the name of the file 

  * a set of the first 100 disk-block addresses.

  * The next address (the last word in the index block) is null (for a small file) or is a pointer to another index block (for a large file).



* Multilevel index

  第一层索引块指向一组第二层的索引块，第二层的索引块再指向文件块。

  为了访问一个块，操作系统通过第一层索引查找到第二层索引，再用第二层索引查找所需的数据块。

  





