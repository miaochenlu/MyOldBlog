# 1. 磁盘

![image-20191216133254214](/Users/jones/Desktop/miaochenlu.github.io/picture/image-20191216133254214.png)

# 4. 磁盘调度

## 4.1 Some calculations

The operating system is responsible for using hardware efficiently — for the disk drives, this means having a ***fast access time*** and ***disk bandwidth***  

{:.success}

Access time has three major components

* **Seek time**[寻道时间] 

> the time for the disk are to move the heads to the cylinder containing the desired sector

* **Rotational latency**[旋转延迟]

> the additional time waiting for the disk to rotate the desired sector to the disk head

* **Transfer** **time** [传输时间]

> 传输数据需要的时间

Minimize seek time

**Seek time** $\approx$ **seek distance** **寻道时间** $\approx$ **寻道距离**

* Disk bandwidth 

> the total number of bytes transferred, divided by the total time between the first request for service and the completion of the last transfer

     7200(转／每分钟)的硬盘，每旋转一周所需时间为60×1000（毫秒）÷7200＝8.33毫秒， 
     则平均旋转延迟时间为8.33÷2＝4.17毫秒(平均情况下，需要旋转半圈)  



## 4.2 FCFS[First come first serve]

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191216134616691.png" alt="image-20191216134616691" style="zoom:50%;" />

`缺点`{:.error}

通常不快。FCFS对在上述例子中从122到14再到124的大跨度调度的表现很糟糕。因为122和124一起处理，再处理14的话，磁头移动数量会减少很多



## 4.3 SSTF[shortest-seek-time-first]

{:.info}

method

> Selects the request with the minimum seek time from the current head position
>
> 本质上是一种shortest job first调度, 但是和SJF不同的是，SSTF不是最优的调度



<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191216135623417.png" alt="image-20191216135623417" style="zoom:35%;" />







`优点`{:.success}

* Average Response Time decreases 

* Throughput increases 

`缺点`{:.error}

* 存在starvation的问题
* Overhead to calculate seek time in  advance 
* High variance of response time as SSTF favors only some requests 



## 4.4 SCAN

{:.success}

method

> 磁头像电梯一样。比如先处理向上的所有请求，到头了之后，调换方向，再处理向下的所有请求

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191216140325967.png" alt="image-20191216140325967" style="zoom:50%;" />

`优点`{:.success}

* High throughput 

* Low variance of response time 

* Average response time 

`缺点`{:.error}

* Long waiting time for requests for locations just visited by disk arm 

## 4.5 C-SCAN[circular SCAN]

{:.success}

method

> 磁头从一头A向另一头B移动，到B之后，马上返回到A，再从A向B移动

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191216140956021.png" alt="image-20191216140956021" style="zoom:50%;" />

`优点`{:.success}

* Provides more uniform wait time compared to SCAN 

## 4.6 Look

{:.success}

method

> SCAN和C-SCAN的磁头都是在整个磁盘宽度内移动的。
>
> 但是这个范围可以缩小到两端最远的请求

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191216142054897.png" alt="image-20191216142054897" style="zoom:35%;" />

`优点`{:.success}

* prevents the extra delay which occurred due to unnecessary traversal to the end 

of the disk. 



## 4.7 调度算法的选择

SSTF比FCFS性能好

SCAN和C-SCAN对于磁盘负荷较大的系统会执行的比较好，因为不可能产生starvation问题



# 5. disk management

## 5.1 磁盘格式化

***A. Physical formatting***

divide disk into sectors for controller to read/write 

Each sector can hold header information, plus data, plus error correction code (ECC) 

***B. OS records its own data structures on the disk*** 

* **partition disk** into groups of cylinders, each treated as a logical disk 
* Logical formatting [**逻辑格式化**]or making a file system



## 5.2 Boot block

为了让计算机开始运行，计算机需要运行一个初始化程序[bootstrap]，初始化系统，从CPU寄存器到设备控制器和内存，然后bootstrap寻找磁盘上的操作系统内存，装入内存，并转到起始地址，操作系统开始执行

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191216152849349.png" alt="image-20191216152849349" style="zoom:50%;" />

## 5.3 Bad Block

有坏块是正常的，出厂的时候就有可能有坏块。对于简单磁盘，Format进行逻辑格式化时找到坏块，就在相应的FAT条目上写上特殊值以通知分配程序不要使用该块。如果在正常使用中块变坏，就必须人工的执行chkdsk来搜索坏块。



## 5.4 Swap-Space Management

Used for moving entire processes (swapping), or pages (paging), from DRAM to secondary storage when DRAM not large enough for all processes 

Operating system provides **swap space management** 



Secondary storage slower than DRAM, so important to optimize performance Multiple swap spaces possible – decreasing I/O load on any given device Best to have dedicated devices
 Can be in raw partition or a file within a file system (for convenience of adding) Data structures for swapping on Linux systems: 

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191216153434994.png" alt="image-20191216153434994" style="zoom:50%;" />