# 1. DNS--域名系统

{:.info}

DNS：将主机名映射成IP地址

应用程序调用一个名为resolver的库程序，并将名字作为参数传递给此程序



## 1.1 DNS命名空间

Internet 被划分为超过 250 个顶级域名[top-level domains]，其中每个域涵盖了许多主机。这些域又被进一步划分成子域，这些子域可被再次划分，依此类推。

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191210095855878.png" alt="image-20191210095855878" style="zoom:40%;" />

## 1.2 Resource records

A resource record is a five-tuple

{:.success}

Domain_name, Time_to_live, Class, Type, Value

* Domain_name[域名]

指出这条记录属于哪个域

* Time_to_live[生存期]

指明这条记录的稳定程序。比如，极为稳定的信息会被分配一个很大的值86400，而非常不稳定的信息会被分配一个很小的值

* class[类别]

对于Internet信息，这个字段总是`IN`

* Type[类型]

指出这是什么类型的记录

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191217094323474.png" alt="image-20191217094323474" style="zoom:40%;" />

* Value

该字段的值可以是一个数字、一个域名或者一个 ASCII 字符串，其语义取决于记录的类型

<br/>

来看一个例子

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191217095418085.png" alt="image-20191217095418085" style="zoom:50%;" />

* 第一个非注释行给出了该域的一些基本信息，我们以后将不再关心这些信息。 

* 接下来的两个表项给出了第一个和第二个投递电子邮件给 person@cs.vu.nl 的地点。
  * 首先尝试的是 zephyr （一台特定的机器〉
  * 如果给它发送失败了，则下一个应该尝试给 top 发送
* 下一行标识了该域的名字服务器为star。

* 接下来是一个空白行，加入空白行的目的是为了增加可读性
* 再下面的几行给出了 star、 zephyr 和 top 的IP地址
* 紧跟这些行后面的是别名 www.cs.vu.nl，因此可以使用这个地址而无须指派一台特殊的机器。创建这个别名的好处是允许 cs.vu.nl 改变它的 WWW 服务器， 无须使得人们原来所使用的地址失效
* 类似地， ftp.cs.vu.nl 也是一个别名。

* 有关机器 flits 的信息部分列出了两个 IP 地址和处理发送至 flits.cs.vu.nl 电子邮件的 三种选择。首先选择的是 flits 本身，但是如果它失效， zephyr 和 top 是第二个和第三个 选择。

* 接下来的 3 行包含了一台计算机的典型表项，在这个例子中是 rowboat.cs.vu.nl 。它提供的信息包括 IP 地址、主要邮件存放处和次要邮件存放处。 
* 然后是一个针对一台计算机的表项，这台计算机自己不能接收邮件：
* 紧随其后的一个表项可能是指一台连接到 Internet的打印机。

## 1.3 Name servers

查询一个名字和找出其对应地址的过程称为***域名解析***[name resolution ]。

### A. authoritative record

当解析器需要查询一个域名，它就把该查询传递给一个本地域名服务器。如果需要寻找的域恰好落在该域名服务器管辖下，比如 top.cs.vu.nl 在 cs.vu.nl 的管辖下，则该域名服务器就返回***权威资源记录***。一个权威记录[ authoritative record]由管理该记录的权威部门提供，因此总是正确的。

### B. cached record

权威记录的权威性是相对缓存记录[cached record ]而言的，缓存的记录有可能过时。

### C. root name servers

There are 13 root DNS servers, unimaginatively called a-root-servers.net through m.root-servers.net. They have information about each top-level domain.



### D. name resolution example

如果被查询域在远端，比如 flits.cs.vu.nl 要找到华盛顿大学robot.cs.washington.edu 的 IP 地址，会发生什么？如果本地没有关于相关域的缓存信息，那么域名服务器启动一次远程查询。

1. 显示查询报文被发送到本地域名服务器。查询中包含了被查询的域名、类型[A]和类[IN]。
2. 通过请求其中之一的根域名服务器来启动域名层次结构顶部的查询。这些域名服务器包含每个顶级域名的有关信息。为了与一个根服务器取得联系，每个域名服务器必须有一个或多个根域名服务器的信息。这个信息通常放在一个系统配置文件中，在 DNS 服务器启动时把该文件加载到 DNS 缓存。这个文件很简单，只是列出了关于根服务器的 NS[name server] 记录和相应的 A[IPv4] 记录。
3. 根域名服务器不可能知道在 uw 的一台机器的地址，可能还不知道 uw 的域名服务器。 但是，它必须知道 edu 域的域名服务器，因为 cs.washington.edu 属于 edu 域管辖下。在第 3 步，它返回查询的答案，其中包括了名字和 IP 地址。
4. 然后本地域名服务器继续尽职地执行任务。它将整个查询发给 edu 域名服务器[a.edu­-servers.net]。该域名服务器返回UW的域名服务器。上述过程显示在图中的第 4 步和第 5步。
5. 本地域名服务器把查询发送给UW的域名服务器[第 6 步]。 如果被查询的域名是英语系，则马上能找到答案，因为 uw 域包括了英语系。但是，计算 机科学系选择运行自己的域名服务器，因此该查询返回的是 uw 计算机科学系的域名服务 器和 IP 地址[第 7 步]。
6. 最后，本地域名服务器查询UW计算机科学系的域名服务器[第 8 步]。这台服务器是 cs.washington.edu 的***权威机构***，所以它必定有答案。它返回最终的答案[第 9 步]，即作为响应 flits.cs.vu.nl [第10步]转发的本地域名服务器。至此，查询的域名得到了解析。

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191217100055190.png" alt="image-20191217100055190" style="zoom:50%;" />

### E. Query machanism

#### i. recursive query

> 当主机 flits.cs.vu.nl 将查询发送给本地域名服务器后，该域名服务器就代替该主机处理域名解析工作，直到它返回所需的答案。这里的答案必须是完整的，它不能返回部分答案。这个机制称为递归查询[recursive query ]。
>
> some detailed explanation from stackExchange
>
> > If there are 2 DNS servers, DNS-A is the authority for domain-a, and DNS-B is the authority for domain-b
> >
> > Someone sends a DNS query to DNS-A for a lookup of domain-b. DNS-A would then be recursing by sending a request to DNS-B in order to lookup domain-b. Essentially, a recursive query is when a DNS server, on behalf of the client that sent the query, chase the trail of DNS in order to fulfill the request.

#### ii. iterative query

> 根域名服务器[和每个后续的域名服务器]并不是递归继续查询本地域名服务器。它只是返回一个部分答案，并移动到下一个查询操作。本地域名服务器负责继续解析，具体做法是发出进一步的查询报文。这个机制称为迭代查询[iterative query], 又称作重指引,返回的是最佳的查询点或者主机地址





#### iii. DNS Cache

> 所有的查询答案，包括所有的部分答案都会被缓存。
>
> 这样， 如果另一台 cs.vu.nl 主机需要查询 robot.cs.washington.edu，那么答案早就有了。
>
> 更妙的是， 如果在同一个域中的一台不同主机需要查询另一台主机，比如 galah.cs.washington.edu，那 么此次查询可直接发送到权威的域名服务器。类似地，针对 washington.edu 其他域的查询 也可以从 washington.edu 域名服务器直接开始。这种使用缓存答案的做法可大大降低一次 查询的步骤，并能提高查询性能。

`问题`{:.error}

> 高速缓存的答案不具权威性，因为在 cs.washington.edu 所做的信息变化将不会传播到世界上所有可能知道它的缓存。
>
> 出于这个原因，缓存的表项不应该生存得太长。这 就是为什么在每条资源记录中要包含 Time to live 宇段的原因。它告诉远程域名服务器可缓存本记录多长时间。如果某台机器己经多年使用相同的 IP 地址，将它的信息缓存 1 天可 能是安全的。而对于波动比较大的信息，几秒钟或一分钟后清除掉记录的做法或许更安全。



#### iv. UDP

> 域名系统采用的是 UDP
>
>  DNS消息通过 UDP 数据包发送，格式非常简单，只有查询和响应。域名服务器可用此数据包继续进行解析操作。



 Non-Recursive Queries are EnabledDNS cache窥探是一个获取已经被DNS服务器解析的请求的过程。如果我们想检查hostname是否被本地DNS网络解析，这将很有用。这意味着本地网络中的节点近期使用那台DNS服务器请求过hostname。从而可以窥探在某一个时间user访问了哪个页面。 
如果我莫使用一个非递归查询来解析一个已经解析的域名，那么DNS服务器对于cache窥探很敏感。为了检查DNS服务器是否对于DNS窥探敏感，我们可以尝试用非递归请求来查找一个域名：如果DNS服务器不知道那么它也不请求其他DNS服务器。 

# 3. World wide web

## 3.1 客户端







### cookies

 A cookie may contain up to 5 fields 

* **Domain**: where the cookie came from 

- **Path**: which parts of the server’s file tree may use it 
- **Content**: *name=value* lists 
- **Expires**: when the cookie expires. 
- **Secure**: can be set to indicate that the browser may only return the cookie to a server using a secure transport. 



### Static Web Pages: HTML

















