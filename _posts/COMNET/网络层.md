---
title: "Computer network--网络层"
tags: Computer-network
key: page-COMNET5
---



# 1. 网络层的设计问题

## 1.1 存储转发数据包交换

阴影椭圆中的是网络服务提供商(ISP)的设备

如果一台主机想要发送一个数据包，他就将数据包传输给最近的路由器。

在该数据包到达路由器，并且路由器的链路层完成了对它校验和的验证之后，它先被存储在路由器上；然后沿着路径被转发到下一个路由器，直至到达目标主机



<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191119095439198.png" alt="image-20191119095439198" style="zoom: 25%;" />

## 1.2 提供给传输层的服务

1. 向上提供的服务应该独立于路由器技术。
2. 应该向传输层屏蔽路由器的数量、类型和拓扑关系。 
3. 传输层可用的网络地址应该有一个统一编址方案，甚至可以跨越 LAN 和 WAN。



## 1.3 无连接服务的实现





# 2. 路由算法

路由算法是网络层软件的一部分，负责确定一个入境数据包应该被发送到哪一条输出线路上。



路由和转发这两个功能的区别

> * 路由
>
>   涉及一个网络的**所有路由器**，经由路由选择协议共同交互，来决定分组从源到目的地结点所采取的路径
>
> * 转发
>
>   分组在**单一的路由器**从一条入链路到一条出链路到传送



路由算法可以分成两类

> * 非自适应算法
>
>   
>
> * 自适应算法





## 2.4 距离矢量算法

<a href="https://blog.csdn.net/u013007900/article/details/45565389">距离矢量算法详解</a>







# 6

## 6.1 IPv4协议

IP数据包包含：

* 一个头[20bytes的定长部分和可选的变长部分组成]
* 一个正文

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126085207750.png" alt="image-20191126085207750" style="zoom:50%;" />

* version: 数据报属于协议的哪个版本, IPv4该字段总是4

* IHL: 由于头的长度不固定，IHL字段指明头到底有多长，以32bits长度为单位。

  IHL的最小值为5，5words=160bits=20bytes, 这表明头没有options字段。

  IHL的最大值为5

* Differentiated services: 
  - **Type of service** (past): 3 for priority, 3 for Delay, Throughput, and Reliability, and 2 unused. 
  -  **Differentiated services** (now): 6 for service class, 2 for congestion (e.g. ECN). 
* Total length: the length of header and data. 最大值为65535bytes
* Identification: 让目标主机确定一个新到达的分段属于哪一个数据报。同一个数据报的所有段包含同样的表示值

* 灰色的部分是一个未使用的位
* DF： Don't fragment。不分段标志位
* MF：more fragment。除了最后一个段，其他段都必须设置这一位
* Fragment: 指明该段在数据报中的位置。除了数据报的最后一个段，其他所有段的长度必须是8bytes的倍数
* Time to live: 限制数据报生存期的计数器。计数单位被设置为秒。在每一跳上该计数器必须被递减。实际上是***跳计数器***，当他递减到0时，数据报就被丢弃。
* Protocol: 指明该将它交给哪个传输进程[TCP UDP ...]
* Header checksum: 
* Source address: 源IP地址
* Destination address： 目标IP地址
* options

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126090914574.png" alt="image-20191126090914574" style="zoom:50%;" />

<a href="https://blog.csdn.net/ztguang/article/details/70949781">OSPF protocol</a>



## 6.2 IP地址

一个IP地址并不真正指向一台主机，而是指向一个网络接口，所以如果一台主机在两个网络上，它必须有两个IP地址。然而大多数主机都连在一个网络，因而只有一个IP地址。

路由器有多个接口，从而有多个IP地址



### A.前缀

IP地址具有层次性，可以将IP地址分成两部分

* 高位可变长网络
* 地位的主机

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126091437663.png" alt="image-20191126091437663" style="zoom:50%;" />



**子网掩码**可以与一个IP地址进行AND操作，提取出IP地址的network部分

如上图，子网掩码为255.255.255.0



### B.子网

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126091938551.png" alt="image-20191126091938551" style="zoom:50%;" />



### C. CIDR 无类域间路由

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126113616524.png" alt="image-20191126113616524" style="zoom: 33%;" />



Question:

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126113649618.png" alt="image-20191126113649618" style="zoom: 33%;" />

***对于A:***

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126114956080.png" alt="image-20191126114956080" style="zoom:50%;" />

因为需要1024个地址，所以host有10位，子网掩码是22位

202.101.0.0/22

***对于B:***

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126115309939.png" alt="image-20191126115309939" style="zoom:50%;" />

host有11位，子网掩码是21位

202.101.8.0/21

***对于C:***

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126115323260.png" alt="image-20191126115323260" style="zoom:50%;" />

host有11位，子网掩码是21位

202.101.16.0/21

### E. NAT





## 6.4 IPv6 Protocol

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191126120754968.png" alt="image-20191126120754968" style="zoom: 40%;" />

