---
title: "Computer network--MAC子层"
tags: Computer-network
key: page-COMNET4


---

# 介质访问控制子层

网络链路可以分成两类

* 点到点连接[PPP协议]
* 广播信道



# 1. 信道分配问题

## 1.1静态信道分配

在多个竞争用户之间分配单个信道的传统做法是把信道容量拆开分给多个用户使用



## 1.2 动态信道分配

### 1.2.1 关键假设

* 流量独立

  模型由N个独立的站组成，每个站都有一个程序或者用户要传输的帧。在长度为$\Delta t$的间隔内，期望产生的帧数是$\lambda \Delta t$。这里的$\lambda$为常数(新帧的到达率)。

* **单信道**

  所有的通信都用这一个信道

* 冲突可观察

  如果两帧同时传输，则他们在时间上就有重叠，产生混乱的信号，这就是冲突。所有的站都能检测到冲突。冲突的帧必须在以后再次被发送

  [冲突的话会发送站点会检测到增强的信号

* 时间连续或分槽

  时间可以假设连续：任意时刻都可以开始传输帧

  时间可以分槽（离散）：帧的传输只能从

* 载波侦听或不听



### 1.2.2 多路访问协议

#### i. 纯ALOHA

思想:

> 有数据要发就发送
>
> 如果帧破坏了，则发送方等待一个随机时间后再次发送

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115204112604.png" alt="image-20191115204112604" style="zoom:50%;" />

帧时[frame time]

> 传输一个标准的、固定长度的帧需要的时间[帧的长度/比特率]

假定站产生的新帧可以模型化为一个平均每“帧时”产生 N 个帧的泊松分布

出了新生成的帧外，每个站还会产生由于先前遭受冲突而重传的那些帧

进一步假设在每个“帧时”中，老帧和新帧合起来也符合泊松分布，每个帧时的平均帧数是G，显然$G\geq N$



参数定义

* 帧时T：发送一个标准长的帧所需的时间
* 吞吐率S：在一个帧时T内发送成功的平均帧数（0<S<1，S=1时信道利用率100%）
* 运载负载G：一个帧时T内所有通信站总共发送的帧平均值（包括原发和重发帧）（G≥S，G=S表示无冲突）
* P0：一帧发送成功（未发生冲突）的概率，发送成功的分组在已发送分组的总数中所占的比例；公式：$S = G\times P0$



如何计算P0

冲突危险期：2T[2个帧时]

在这个危险期，生成帧的均值为2G



<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115204525493.png" alt="image-20191115204525493" style="zoom:50%;" />

<img src="/Users/jones/Downloads/IMG_2DF27CD714C6-1.jpeg" alt="IMG_2DF27CD714C6-1" style="zoom: 33%;" />

在2T时间内发送成功的概率=2T时间内没有其他帧生成的概率

$P_0=\frac{(G\cdot 2)^0e^{-G\cdot 2}}{0!}=e^{-2G}$

$S=GP_0=Ge^{-2G}$



#### ii. 分槽ALOHA

思想

> 时间离散化
>
> 必须要等到一个时间槽点开始时刻才能发送帧

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115210524429.png" alt="image-20191115210524429" style="zoom:50%;" />

性能如何？

只需要在当前帧时没有其他站发送帧就可以保证一个帧发送成功

$P_0=\frac{(G\cdot 1)^0e^{-G\cdot 1}}{0!}=e^{-G}$

$S=GP_0=Ge^{-G}$

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115210722147.png" alt="image-20191115210722147" style="zoom:50%;" />

### 1.2.3 载波侦听多路访问协议

上面两种属于不听就说

下面我们可以尝试先听再说的方式[发送帧之前检测信道中是否有数据在发送]

#### i. CSMA[Carrier sense multiple access] without CD[collision detection]

A. Persistent CSMA[1-p]

*  If the channel is **idle**, the station **transmits** a frame. 
* If the channel is **busy**, the station **waits** until it becomes idle. Then the station transmits a frame. 
* If a **collision occurs**, the station **waits a random** **amount of time** and starts all over again. 

这个协议也叫1-persistent，因为**不停地去sense信道**，只要信道空闲就能发现，也就是说一个station能以1的概率发现信道空闲

问题是，如果两个station都在等待信道，那么当信道空闲时，他们同时发送，这必然产生冲突

<br/>

B. Non-persistent CSMA

- If the channel is **idle**, the station **transmits** a frame. 

- If the channel is **in use**, the station **does not** continually sense it. Instead, it **waits a random** 

  **period of time** and then repeats the algorithm. 

- If a **collision occurs**, the station **waits a random** **amount of time** and starts all over again. 

这种方式信道利用率比1-persistent高，但是比1-persistent的delay时间长

<br/>

C. p-persistent CSMA

 **Applied to slotted channels**

- If the channel is **idle**, it **transmits with a probability** **p**. With a probability *q=1-p*, it defers until the next slot. 
- If that slot is also idle, it either transmits or defers again, with probabilities *p* and *q*. 
- This process is repeated until either the frame has been transmitted or another station has begun transmitting. 
- If the channel is **busy**, it **waits until the next slot** and applies the above algorithm.

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115220004447.png" alt="image-20191115220004447" style="zoom:50%;" />

 

#### ii. CSMA with CD

思想

> As soon as stations detect a collision, they stop their transmissions

CSMA/CD可以出于以下几种状态

* contention
* transmission
* idle

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115220550462.png" alt="image-20191115220550462" style="zoom:50%;" />

竞争算法：

> 假设两个站同时在t0时刻开始传送数据，他们需要多长时间才能意识到发生冲突呢？ 2$\tau$
>
> 因此，将CSMA/CD竞争看成一个分槽ALOHA系统，时间槽宽度为$2\tau$
>
> CSMA/CD 和分槽 ALOHA 的区别在于， 只有一个站能用来传输的时间槽（即信道被抓住了）后面紧跟的那些时间槽被用来传输该 帧的其余部分。如果帧时相比传播时间长很多，这种差异将能大大提高协议的性能。



<img src="/Users/jones/Downloads/IMG_D9933EA1BF2A-1.jpeg" alt="IMG_D9933EA1BF2A-1" style="zoom: 33%;" />

### 1.2.4 无冲突协议

#### i. 位图协议

一共有N个station，每个竞争期包含N个槽。如果0号station有一帧要发送，那么他在0号槽中传输1位。这个槽不允许其他station发送。

当所有N个槽都经过后，每个站都知道哪些站希望传送数据。

这是，按照数字顺序开始传送数据

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115224154892.png" alt="image-20191115224154892" style="zoom:50%;" />

每个站都同意下一个是谁传输，所以永远不会发生冲突

当最后一个就绪站传送完它的帧后，另一个N位竞争期又开始了



Notations

* The time unit is one contention bit 
*  *N*: contention period
* *d*: data frame length 

性能分析

* low load

> * for low-numbered stations ,比如0，1
>
> 如果当这个station做好发送数据的准备时，当前槽出于位图中间的某个地方，那么这个station需要等待完成当前扫描的N/2个槽，在等待完成下一次扫描的另外N个槽，然后才能开始传输数据
>
> 等待时间为1.5N
>
> * for high-numbered stations, 比如上图6,7
>
> 平均等待0.5N个槽

平均而言，delay for all stations is N

信道利用率为: $\frac{d}{N+d}$ 每一帧的额外开销是N位，数据长度为d位

* high load

> the 𝑁 bit contention period is distributed over 𝑁 frames, yielding an overhead of only 1 bit per frame, 

the efficiency: $\frac{𝑑}{d + 1}$ 



#### ii. token passing

令牌代表发送权限，令牌以预定义的顺序从一个站传到下一个站

如果站有个等待传输的帧队列，当他接收到令牌就可以发送帧，然后再把令牌传递到下一站；如果没有帧要传，则只是简单把令牌传递下去

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115233333760.png" alt="image-20191115233333760" style="zoom:50%;" />

#### iii. Binary Countdown 



### 1.2.5 有限竞争协议

目前为止

*  Methods with contention 
  * **Under** **low** **load**, the contention method (i.e., pure or slotted ALOHA, CSMA) is preferable due to its low delay.  
  * **Under** **high** **load**, the contention method becomes increasingly less efficient. 
* Methodswithoutcontention 
  *  Under low load, the collision-free method has high delay. 
  *   Under high load, the collision-free method becomes increasingly more efficient. 

综合他们的优点缺点，提出limited-contention protocols

有限竞争协议在低负载下来用竞争的做法而提供较短的延迟，但在高负载下来用无冲突技术， 从而获得良好的信道效率

#### Adaptive Tree Walk

把站看作二叉树的**叶节点**

在一次成功传送之后的第一个竞争槽，即 0 号槽中，允许所有的站尝试获取信道。

如果它们之中的某一个获得了信道，则很好；如果发生了冲突，则在1号槽中， 只有位于树中 2 号节点之下的那些站才可以参与竞争。

如果其中的某个站获得了信道，则 在该站发送完一帧之后的那个槽被保留给位于节点 3 下面的那些站。

另一方面，如果节点 2 下面的两个或者多个站都要传输数据，则在 1 号槽中就会发生冲突，此时，下一个槽， 即 2 号槽就由位于节点 4 下面的站来竞争。

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191115234633276.png" alt="image-20191115234633276" style="zoom:50%;" />

### 1.2.6 无限局域网协议

假设每个无线电发射器有某个固定的传播范围，用一个圆形覆盖区域表示，在这区域内的另一个站可以侦听并接收该站的传输

#### 隐藏终端问题

> 假设有3无线通信站ABC如下所示：
> A        B         - C 
>
> 其中B在C的无线电波范围内，但A不在C的无线电波范围内。此时C正在向B传送数据，而A也试图向B传送数据。此时，A不能够监听到B正在忙（因为A在监听信道的时候什么也听不到，所以它会错误的认为此时可以向B传送数据了）。如果A向B传送数据，则将导致错误。此即隐藏站问题。其中C是A的隐藏站。

#### 暴露终端问题

> 假设有3无线通信站ABC如下所示：
> -A        B          C 
>
> 其中B在A的无线电波范围内，但C不在A的无线电波范围内。此时A正在传送数据（向除B以外的某通信站），而B希望给C发送数据，但是错误地认为该传送过程将会失败（因为B会监听到一次传输，所以它会错误地认为此时不能向C发送数据）。此即暴露站问题。其中A是B的暴露站
> 

#### 冲突避免多路访问（MACA, Multiple Access with Collision Avoidance) 

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191116001108257.png" alt="image-20191116001108257" style="zoom:50%;" />

考虑A如何向B发送一帧。 

> * A首先给B发送一 个 RTS (Request To Send帧)，这个短帧 (30 字节）包含了随后将要发送的数据帧的长度
>
> * 然后， B 用一个 CTS (Cle缸 to Send ）作为应答， 此 CTS 帧也包含了数据长度（从 RTS 帧中复制过来）。 A 在收到了CTS 帧之后便开始传输。



现在我们来看，如果其他站也听到了这些帧，它们会如何反应。

> * 如果一个站听到了 RTS 帧，那么它一定离 A 很近，它必须保持沉默，至少等待足够长的时间以便在无冲突情况下 CTS 被返回给 A
> * 如果一个站昕到了 CTS ，则它一定离 B 很近，在接下来的数据传送过程 中它必须一直保持沉默，只要检查 CTS 帧，该站就可以知道数据帧的长度（即数据传输要持续多久）。

但是这样仍然可能发生冲突：B 和 C 可能同时给 A 发送 RTS





# 2. 以太网

### 2.1 经典以太网物理层

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191116182110572.png" alt="image-20191116182110572" style="zoom:50%;" />

采用Machester encoding



Differential Manchester encoding :

时钟的频率是比特率的两倍，也就是在一个bit 时间内，时钟会产生一次跳变。时钟XOR bit，产生输出

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191116183235764.png" alt="image-20191116183235764" style="zoom:50%;" />

> 第一个bit时间t内，传输的bit是1，时钟在[0,t/2]内是0，与bit 1异或，编码成1;
>
> 在[t/2, t]内时钟跳变到1，与bit 0异或，编码成0.
>
> 因此我们在第一个bit时间看到的编码先是1后翻转到0

问题：需要两倍于NRZ的带宽，一个bit时间他要传输两个信号



### 2.2 经典以太网MAC子层协议

<img src="/Users/jones/Library/Application Support/typora-user-images/image-20191116183434635.png" alt="image-20191116183434635" style="zoom:50%;" />

<img src="/Users/jones/Downloads/IMG_2710(20191116-184052).JPEG" alt="IMG_2710(20191116-184052)" style="zoom: 33%;" />



这里一个帧的数据段最少要64字节

> 因为争用期为$2\tau$，通常取为51.2us
>
> 对于10Mb/s以太网，在争用期可以发送512bit，也就是64字节
>
> 使用CSMA/MD, 直到信道空闲才会发送帧
>
> 如果两个站同时发送数据，则在$2\tau$时间内会检测到冲突。也就是在前64个字节就可以检测到冲突。如果前64个字节不冲突，则就不会冲突。



#### 二进制指数后退的CSMA/CA

这个协议确定了随机等待时间

一个时间槽为$2\tau$, 基本退避时间为$2\tau$

第一次冲突发生后，每个站随机等待 0 个或者 1 个时间槽，之后再重试发送。如果两个站冲突之后选择了同一个随机数，那么它们将再次冲突。在第二次冲突后，每个站随机选择等待0、1、2或3个时间槽 。如果第三次冲突又发生了（发生的概率为 0.25 ），则下一次等待的时间槽数从 0 到 $2^3-1$ 之间随机选择。

达到 10 次冲突之后，随机数的选择区间被固定在最大值 1023 ，以后不再增加。 在 16 次冲突之后，控制器放弃努力，并给计算机返回一个失败报告 。



refences

[1]https://blog.csdn.net/Jaihk662/article/details/80386620